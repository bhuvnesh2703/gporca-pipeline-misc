Select  cob_date, count(ticket) as failed_trades, stress_scenario, 'FRB adj.' as category, ccc_division, ccar_business_category, product_type, currency_pair, case  when RISK_SYSTEM like '%FXOPT%' then 'FXOPT' else RISK_SYSTEM end as vertical_system, SUM(SCENARIO_PNL) /1000 as pnl FROM dwuser.u_modular_scenarios_ccar WHERE COB_DATE = '2018-02-28'     AND stress_scenario in ( 'FRB2017_SA_FX_ALL')     AND SCENARIO_TYPE = 'GREEK'      AND  (RISK_SYSTEM LIKE '%FXOPT%')      and ticket in ( SELECT distinct ticket FROM DWUSER.U_MODULAR_SCENARIO_DQ WHERE COB_DATE = '2018-02-28' AND FULL_REVAL_SCENARIO_NAME = 'FRB2017_SA_FX_All' ) and risk_system like '%FXOPT%'  and product_type = 'FXOPT' and ccar_business_category <>'NOT_INCLUDED' group by  cob_date, STRESS_SCENARIO, product_type, currency_pair, ccc_division, ccar_business_category, RISK_SYSTEM, ticket