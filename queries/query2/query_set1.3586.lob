select cob_date, ccc_product_line, case when currency_of_measure in ('EUR','GBP','USD','JPY') then currency_of_measure else 'OTHER' end as currency_of_measure, case when product_type_code in ('BONDFUT','GVTBOND','REPO','SWAP','RATEFUT','TRRSWAP') then product_type_code else 'OTHER' end as product_type_code, case when curve_name = 'eurnw_disc' then 'EUR Libor-OIS' when curve_name = 'gbpnw_disc' then 'GBP Libor-OIS' when curve_name = 'cadnw_disc' then 'CAD Libor-OIS' when curve_name = 'gbpnw_6m' then 'GBP 3m-6m' when curve_name = 'jpymu_6m' then 'JPY 3m-6m' when curve_name = 'eurnw_1m' then 'EUR 1m-3m' when curve_name = 'gbpnw_1m' then 'GBP 1m-3m' when curve_name = 'eurnw_6m' then 'EUR 3m-6m' when curve_name = 'czknw_1m' then 'CZK 1m-3m' when curve_name = 'czknw_disc' then 'CZK Libor-OIS' when curve_name = 'hufnw_disc' then 'HUF Libor-OIS' when curve_name = 'plnnw_disc' then 'PLN Libor-OIS' when curve_name = 'zarnw_disc' then 'ZAR Libor-OIS' when curve_name = 'hufnw_1m' then 'HUF 1m-3m' when curve_name = 'plnnw_1m' then 'PLN 1m-3m' when curve_name in ('jpynw_1m','jpymu_1m') then 'JPY 1m-3m' when curve_name in ('usdnw_disc','usdn_disc') then 'USD Libor-OIS' when curve_name in ('jpynw_3m','jpymu_3m') then 'JPY Libor-OIS' when curve_name in ('usdnw_1m','usdn_1m') then 'USD 1m-3m' when curve_name = 'fxusdeur' then 'EUR XCCY' when curve_name = 'fxusdgbp' then 'GBP XCCY' when curve_name = 'fxusdjpy' then 'JPY XCCY' when curve_name = 'fxusdrub' then 'RUB XCCY' else curve_name end as curve_name, case when curve_name in ('eurnw_disc','gbpnw_disc','cadnw_disc','gbpnw_6m','jpymu_6m','eurnw_1m','gbpnw_1m', 'eurnw_6m','czknw_1m','czknw_disc','hufnw_disc','plnnw_disc','zarnw_disc','hufnw_1m','plnnw_1m','jpynw_1m','jpymu_1m', 'usdnw_disc','usdn_disc','jpynw_3m','jpymu_3m','usdnw_1m','usdn_1m') then 'Tenor Basis' when curve_name in ('fxusdeur','fxusdgbp','fxusdjpy','fxusdrub') then 'XCCY Basis' when curve_name in ('ru_gv_tsy','rs_gv_glt','re_gv_de','re_gv_fr','re_gv_be','rj_gv_jgb','re_gv_es','re_gv_pt', 're_gv_it','re_gv_at','re_gv_ir','re_gv_pt','re_gv_gr','re_gv_nl','re_gv_fi') then 'Repo Basis - Sov' when curve_name in ('ru_tier1_p','ru_tier2_p','ru_tier3_p','ru_tier4_p','ru_tier5_p','rs_tier1','rs_tier2','rs_tier3','rs_tier4','rs_tier5','re_tier1','re_tier2','re_tier3','re_tier4','re_tier5','rj_tier1','rj_tier2','rj_tier3','rj_tier4','rj_tier5') then 'Repo Basis - Non Sov' else 'Other' end as basis_risk, country_cd_of_risk, CASE WHEN TERM_OF_MEASURE <= 1 THEN '1d' WHEN (TERM_OF_MEASURE > 1 AND TERM_OF_MEASURE <= 30) THEN '1m' WHEN (TERM_OF_MEASURE > 30 AND TERM_OF_MEASURE <= 60) THEN '2m' WHEN (TERM_OF_MEASURE > 60 AND TERM_OF_MEASURE <= 90) THEN '3m' WHEN (TERM_OF_MEASURE > 90 AND TERM_OF_MEASURE <= 120) THEN '4m' WHEN (TERM_OF_MEASURE > 120 AND TERM_OF_MEASURE <= 150) THEN '5m' WHEN (TERM_OF_MEASURE > 150 AND TERM_OF_MEASURE <= 180) THEN '6m' WHEN (TERM_OF_MEASURE > 180 AND TERM_OF_MEASURE <= 210) THEN '7m' WHEN (TERM_OF_MEASURE > 210 AND TERM_OF_MEASURE <= 240) THEN '8m' WHEN (TERM_OF_MEASURE > 240 AND TERM_OF_MEASURE <= 270) THEN '9m' WHEN (TERM_OF_MEASURE > 270 AND TERM_OF_MEASURE <= 300) THEN '10m' WHEN (TERM_OF_MEASURE > 300 AND TERM_OF_MEASURE <= 330) THEN '11m' WHEN (TERM_OF_MEASURE > 330 AND TERM_OF_MEASURE <= 365) THEN '1y' WHEN (TERM_OF_MEASURE > 365 AND TERM_OF_MEASURE <= 730) THEN '2y' WHEN (TERM_OF_MEASURE > 730 AND TERM_OF_MEASURE <= 1095) THEN '3y' WHEN (TERM_OF_MEASURE > 1095 AND TERM_OF_MEASURE <= 1460) THEN '4y' WHEN TERM_OF_MEASURE > 1460 THEN '5y+' END as term_bucket, sum(usd_ir_unified_pv01) as pv01, sum(usd_irpv01sprd) as spread_pv01 from cdwuser.U_IR_MSR WHERE COB_DATE IN ('2018-02-28','2018-02-27') and ccc_product_line in ('BRM FIRM SECURED FUNDING','BRM FI CLIENT FINANCING') and ccc_pl_reporting_region = 'EMEA' and ((usd_ir_unified_pv01 <> 0 and usd_ir_unified_pv01 is not null) or (usd_irpv01sprd <> 0 and usd_irpv01sprd is not null)) group by cob_date, ccc_product_line, currency_of_measure, curve_name, product_type_code, country_cd_of_risk, term_of_measure