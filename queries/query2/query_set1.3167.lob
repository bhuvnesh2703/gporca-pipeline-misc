With x as ( SELECT CAST(RANK () OVER (ORDER BY SUM (ABS (vega)) desc ) || '.' || 'UK Group ALL' AS VARCHAR(100)) as RankUKALL, CAST(Underlier AS VARCHAR(100)) AS Underlier, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) x GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), x2 as ( SELECT CAST(RANK () OVER (ORDER BY SUM (ABS (vega)) desc ) || '.' || 'UK Group ALL Prev. CoB' AS VARCHAR(100)) as RankUKALL, CAST(Underlier AS VARCHAR(100)) AS Underlier, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-27' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) x GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), y as ( SELECT CAST('x.UK Group CASH EQUITIES' AS VARCHAR(100)) as RankUKCASH, CAST('UK Group CASH EQUITIES' || '.' || Underlier AS VARCHAR(100)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_BUSINESS_AREA = 'CASH EQUITIES' AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) x GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), z as ( SELECT CAST('x.UK Group DERIVATIVES' AS VARCHAR(100)) as RankUKDERIVATIVES, CAST('UK Group DERIVATIVES' || '.' || Underlier AS VARCHAR(100)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_BUSINESS_AREA = 'DERIVATIVES' AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) x GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), w as ( SELECT CAST('x.UK Group OTHER IED' AS VARCHAR(100)) as RankUKOTHERIED, CAST('UK Group OTHER IED' || '.' || Underlier AS VARCHAR(100)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_BUSINESS_AREA = 'OTHER IED' AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) x GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), k as ( SELECT CAST('x.UK Group PRIME BROKERAGE' AS VARCHAR(100)) as RankUKPB, CAST('UK Group PRIME BROKERAGE' || '.' || Underlier AS VARCHAR(100)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_BUSINESS_AREA IN ('PRIME BROKERAGE') AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) x GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), j as ( SELECT CAST('x.UK Group OTHER' AS VARCHAR(100)) as RankUKOTHER, CAST('UK Group OTHER' || '.' || Underlier AS VARCHAR(100)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_BUSINESS_AREA NOT IN ('CASH EQUITIES', 'PRIME BROKERAGE','DERIVATIVES','OTHER IED') AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) x GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ) SELECT * FROM x UNION ALL SELECT * FROM x2 UNION ALL SELECT * FROM y UNION ALL SELECT * FROM z UNION ALL SELECT * FROM w UNION ALL SELECT * FROM j UNION ALL SELECT * FROM k