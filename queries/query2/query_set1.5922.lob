select b.ACCOUNT, b.BOOK, b.COB_DATE, b.PRODUCT_DESCRIPTION, b.PRODUCT_DESCRIPTION_MAPPING, b.PRODUCT_DESCRIPTION_CHARTS, b.Duration, b.Market_Value, b.USD_IR_UNIFIED_PV01, b.USD_Notional, case when b.Duration <=1 then '0-1' when b.Duration <=2 then '1-2' when b.Duration <=3 then '2-3' when b.Duration <=4 then '3-4' when b.Duration <=5 then '4-5' when b.Duration <=6 then '5-6' when b.Duration <=7 then '6-7' else '7+' end as Duration_Buckets from ( SELECT A.COB_DATE, a.ACCOUNT, a.BOOK, a.PRODUCT_DESCRIPTION, case when product_type_code='AGNCMO' AND (PRODUCT_DESCRIPTION like '%GINNIE MAE%' OR PRODUCT_DESCRIPTION like '%GNMA%' OR PRODUCT_DESCRIPTION LIKE '%GOVERNMENT NATIONAL MORTGAGE%') THEN 'GNMA CMO' when product_type_code='AGNCMO' AND (PRODUCT_DESCRIPTION like '%FANNIE MAE%' OR PRODUCT_DESCRIPTION like '%FEDERAL%' OR PRODUCT_DESCRIPTION like '%FREDDIE MAC%') THEN 'FNMA/FHLMC CMO' else a.PRODUCT_DESCRIPTION_MAPPING end as PRODUCT_DESCRIPTION_MAPPING, case when product_type_code='GVTBOND' AND PRODUCT_DESCRIPTION like '%US TREASURY NOTE%' and PRODUCT_DESCRIPTION like '%FLOAT%' THEN 'Treasury Float' when a.PRODUCT_DESCRIPTION_MAPPING in ('FMCC 15 Years', 'FMCC 30 Years', 'FNMA 15 Years', 'FNMA 30 Years') then 'FMCC/FNMA Pass-Throughs' when a.PRODUCT_DESCRIPTION_MAPPING in ('GNMA 15 Years', 'GNMA 30 Years') then 'GNMA Pass-Throughs' when product_type_code='AGNCMO' AND (PRODUCT_DESCRIPTION like '%GINNIE MAE%' OR PRODUCT_DESCRIPTION like '%GNMA%' OR PRODUCT_DESCRIPTION LIKE '%GOVERNMENT NATIONAL MORTGAGE%') THEN 'GNMA CMO' when product_type_code='AGNCMO' AND (PRODUCT_DESCRIPTION like '%FANNIE MAE%' OR PRODUCT_DESCRIPTION like '%FEDERAL%' OR PRODUCT_DESCRIPTION like '%FREDDIE MAC%') THEN 'FNMA/FHLMC CMO' else a.PRODUCT_DESCRIPTION_MAPPING end as Product_Description_Charts, sum(a.USD_NOTIONAL) as USD_Notional, SUM(A.USD_IR_UNIFIED_PV01) AS USD_IR_UNIFIED_PV01, sum(a.USD_MARKET_VALUE) as Market_Value, sum(abs(USD_IR_UNIFIED_PV01))/SUM(USD_NOTIONAL)*10000 as Duration FROM cdwuser.U_DM_TREASURY a where cob_date in ('2018-02-28') AND BOOK in ('TSTPM', 'TSHTM') and ACCOUNT NOT IN ('07000AB27') and a.bu_risk_system not like '%EQUITYSD%' GROUP BY A.COB_DATE, a.ACCOUNT, a.BOOK, a.PRODUCT_DESCRIPTION, A.PRODUCT_TYPE_CODE, case when product_type_code='AGNCMO' AND (PRODUCT_DESCRIPTION like '%GINNIE MAE%' OR PRODUCT_DESCRIPTION like '%GNMA%' OR PRODUCT_DESCRIPTION LIKE '%GOVERNMENT NATIONAL MORTGAGE%') THEN 'GNMA CMO' when product_type_code='AGNCMO' AND (PRODUCT_DESCRIPTION like '%FANNIE MAE%' OR PRODUCT_DESCRIPTION like '%FEDERAL%' OR PRODUCT_DESCRIPTION like '%FREDDIE MAC%') THEN 'FNMA/FHLMC CMO' else a.PRODUCT_DESCRIPTION_MAPPING end, case when product_type_code='GVTBOND' AND PRODUCT_DESCRIPTION like '%US TREASURY NOTE%' and PRODUCT_DESCRIPTION like '%FLOAT%' THEN 'Treasury Float' when a.PRODUCT_DESCRIPTION_MAPPING in ('FMCC 15 Years', 'FMCC 30 Years', 'FNMA 15 Years', 'FNMA 30 Years') then 'FMCC/FNMA Pass-Throughs' when a.PRODUCT_DESCRIPTION_MAPPING in ('GNMA 15 Years', 'GNMA 30 Years') then 'GNMA Pass-Throughs' when product_type_code='AGNCMO' AND (PRODUCT_DESCRIPTION like '%GINNIE MAE%' OR PRODUCT_DESCRIPTION like '%GNMA%' OR PRODUCT_DESCRIPTION LIKE '%GOVERNMENT NATIONAL MORTGAGE%') THEN 'GNMA CMO' when product_type_code='AGNCMO' AND (PRODUCT_DESCRIPTION like '%FANNIE MAE%' OR PRODUCT_DESCRIPTION like '%FEDERAL%' OR PRODUCT_DESCRIPTION like '%FREDDIE MAC%') THEN 'FNMA/FHLMC CMO' else a.PRODUCT_DESCRIPTION_MAPPING end ) b