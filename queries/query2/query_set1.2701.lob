With x As ( select c.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, sum(c.USD_EXPOSURE) as USD_EXPOSURE, sum(coalesce(USD_PV10_BENCH, 0)) as USD_PV10, CASE WHEN c.product_type_code IN('BOND','CONVBOND','DEFSWA','CONVRT') THEN 1 ELSE 0 END AS TopNetFlag, CASE WHEN lower(c.CURVE_NAME) in ('hy17v4','itrx17_snr') THEN 1 ELSE 0 END As CreditCurveFlag from CDWUSER.U_CR_MSR c where c.COB_DATE = '2018-02-28' and CCC_BANKING_TRADING <> 'BANKING' and c.DIVISION = 'IED' Group by POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, CASE WHEN c.product_type_code IN('BOND','CONVBOND','DEFSWA','CONVRT')THEN 1 ELSE 0 END , CASE WHEN lower(c.CURVE_NAME) in ('hy17v4','itrx17_snr') THEN 1 ELSE 0 END) select * from(Select 'TopNetExp' as Concentration , POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, sum(USD_EXPOSURE) as Measure from x where TopNetFlag = 1 and POSITION_ULT_ISSUER_PARTY_DARWIN_NAME not in ('BERKSHIRE HATHAWAY INC.','MORGAN STANLEY','REPUBLIC OF INDONESIA','UNKNOWN', 'UNDEFINED') group by POSITION_ULT_ISSUER_PARTY_DARWIN_NAME order by abs(sum(USD_EXPOSURE)) desc fetch first 1 rows only) a Union All select * from (Select 'TopPV10' as Concentration, POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, sum(USD_PV10) as Measure from x where CreditCurveFlag = 0 and POSITION_ULT_ISSUER_PARTY_DARWIN_NAME not in ('MORGAN STANLEY','N/A','UNKNOWN','UNDEFINED', 'BERKSHIRE HATHAWAY INC.') group by POSITION_ULT_ISSUER_PARTY_DARWIN_NAME order by abs(sum(USD_PV10)) desc fetch first 1 rows only) a Union All Select * from(Select 'BHNetExp' as Concentration, POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, sum(USD_EXPOSURE) as Measure from x where POSITION_ULT_ISSUER_PARTY_DARWIN_NAME = 'BERKSHIRE HATHAWAY INC.' group by POSITION_ULT_ISSUER_PARTY_DARWIN_NAME order by abs(sum(USD_EXPOSURE)) desc fetch first 1 rows only) a Union All select * from(Select 'MSPV10' as Concentration, POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, sum(USD_PV10) as Measure from x where CreditCurveFlag = 0 and POSITION_ULT_ISSUER_PARTY_DARWIN_NAME like '%MORGAN STANLEY%' group by POSITION_ULT_ISSUER_PARTY_DARWIN_NAME order by abs(sum(USD_PV10)) desc fetch first 1 rows only) a Union All select * from(Select 'MSNetExp' as Concentration, POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, sum(USD_EXPOSURE) as Measure from x where TopNetFlag = 1 and POSITION_ULT_ISSUER_PARTY_DARWIN_NAME like '%MORGAN STANLEY%' group by POSITION_ULT_ISSUER_PARTY_DARWIN_NAME order by abs(sum(USD_EXPOSURE)) desc fetch first 1 rows only) a