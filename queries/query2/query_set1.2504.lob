select B.COB_DATE,B.CM_Category,TYPE_FLAG, sum( case when B.CM_Category ='OTHER' then abs(B.CM) else B.CM end) as CM, sum(B.CM) CM2 from (SELECT     a.COB_date,a.prod_pos_name_description,a.CURVE_NAME,TYPE_FLAG,     CASE WHEN prod_pos_name_description IN ('ERCOT N-O', 'ERCOT N-P', 'ERCOT RRS-O', 'ERCOT RRS-P', 'ERCOT S-O', 'ERCOT S-P',                                                  'ERCOT URS-O', 'ERCOT URS-P', 'ERCOTW-O', 'ERCOTW-P', 'GITS-O', 'GITS-P', 'MIDCO-O',                                                  'MIDCO-P', 'NEPOOL-MAHB-O', 'NEPOOL-MAHB-P', 'NOB-O', 'NOB-P', 'NP15-O', 'NP15-P',                                                  'NYZNA-O', 'NYZNA-P', 'NYZND-O', 'NYZND-P', 'NYZNG-O', 'NYZNG-P', 'PALO-P', 'PJMW-O',                                                  'PJMW-P', 'SP15-O', 'SP15-P', 'SPP-O', 'SPP-P', 'AEP-P', 'AEP-O', 'ALTW-O', 'ALTW-P',                                                  'ARA COAL', 'COAL NYMEX', 'CINERGY-P', 'CINHUB-O', 'EUA P2', 'EUA P3', 'FOB NEWCASTLE',                                                  'FOB NEWCASTLE COAL', 'NEWCASTLE COAL', 'FOB RICH COAL', 'GER BASE', 'GER PEAK',                                                  'HOTS-P', 'HOTS-O', 'HOTS-P', 'MICH HUB-P', 'MICHHUB-O', 'MINNHUB-O', 'MINNHUB-P',                                                  'PPA WEST-O', 'PPA WEST-P', 'SOUTHERN CO-O', 'SOUTHERN CO-P', 'UK BASE-GBP', 'UK PEAK',                                                  'RGGI', 'NIHUB-O', 'NIHUB-P', 'NYZNJ-O', 'MEAD-O', 'MEAD-P') THEN 'POWER' WHEN          prod_pos_name_description IN ('DAWN', 'AECO', 'DOMTRANS', 'HENRY HUB', 'MICHCON', 'NYMEX', 'SOCAL', 'SONAT', 'TETCO2', 'TETCO3',                                            'TGP6', 'TTF', 'UKNG', 'NORTH EAST PENN', 'IROQUOISZ2', 'TRANSCO6', 'TRANSCO6 EX NY') THEN          'NATGAS' WHEN prod_pos_name_description IN ('BRENT', 'WTI', 'BRENT', 'CHI ETHANOL', 'DTD BRENT', 'DUBAI', 'GC 3%FO', 'GC 74HO',                                                          'GC C3TET', 'GC C5+XTET', 'GC NC4XTET', 'IPE GO', 'LLS', 'NWE 1%FO',                                                          'NWE 3.5%FO', 'NWE JET', 'NWE NAP', 'NWE ULSD', 'NWE UNL', 'NYM HO', 'NYM RBOB',                                                          'SING 180FO', 'SING 380FO', 'US C2', 'WTI', 'NYM WTI') THEN 'OIL' WHEN          prod_pos_name_description IN ('AH', 'CA', 'NI', 'PB', 'SN', 'ZS', 'IRON ORE') THEN 'BASE METAL' WHEN prod_pos_name_description          IN ('GOLD FORWARD', 'GOLD FUTURE', 'PALLADIUM FOR', 'PALLADIUM FORWARD', 'PALLADIUM FUTURE', 'PLATINUM FORW', 'PLATINUM FORWARD'         , 'PLATINUM FUTURE', 'SILVER FORWAR', 'SILVER FORWARD', 'XAU', 'XPD') THEN 'PRECIOUS METAL' WHEN prod_pos_name_description IN (                                                                                                                                            'COCOA'         , 'COFFEE', 'CORN', 'COTTON', 'KANSASWHEAT', 'LIFFE SUGAR', 'RAST-CHIBA VL', 'RAST-CHIBA VLCC', 'SOYBEANS', 'SUGAR', 'WHEAT',                                                                                                                                             'AMST-NY 37MM'         , 'BDI', 'SOYBEAN MEAL', 'SOYBEAN OIL') THEN 'OTHER'     ELSE 'NOT IN' END AS CM_Category,     sum(a.USD_CM_DELTA) as CM      FROM cdwuser.U_DM_CVA a where (a.COB_DATE = '2018-02-28' or a.COB_DATE = '2018-01-01') and IS_UK_GROUP = 'Y' AND  a.CCC_PRODUCT_LINE = 'XVA HEDGING' and a.USD_CM_DELTA IS NOT NULL GROUP BY     a.COB_date,prod_pos_name_description,a.CURVE_NAME,TYPE_FLAG) as B group by  B.COB_DATE,B.CM_Category,TYPE_FLAG