SELECT PRODUCT_DESCRIPTION, CASE WHEN RevLEVERAGE = -1 THEN CAST(-(USD_DELTA * 0.5) AS DECIMAL(20,2)) ELSE CAST(-(least(RevLEVERAGE + 0.5,0)*USD_DELTA + USD_MARKET_VALUE) AS DECIMAL(20,2)) END AS SLIDE_MIN_50_USD, CASE WHEN RevLEVERAGE = -1 THEN CAST(-(USD_DELTA * 0.75) AS DECIMAL(20,2)) ELSE CAST(-(least(RevLEVERAGE + 0.75,0)*USD_DELTA + USD_MARKET_VALUE) AS DECIMAL(20,2)) END AS SLIDE_MIN_75_USD, CASE WHEN RevLEVERAGE = -1 THEN CAST(-(USD_DELTA * 1) AS DECIMAL (20,2)) ELSE CAST(-(least(RevLEVERAGE + 1,0)*USD_DELTA + USD_MARKET_VALUE) AS DECIMAL(20,2)) END AS SLIDE_MIN_100_USD FROM ( SELECT a.CCC_BOOK_DETAIL, a.UNDERLIER_PRODUCT_DESCRIPTION, a.PRODUCT_DESCRIPTION, a.EXECUTIVE_MODEL, a.CASH_ISSUE_TYPE, a.UNDERLIER_PRICE, a.STRIKE, CASE WHEN a.EXECUTIVE_MODEL = 'CONSTANTLEVERAGECERTIFICATE' AND POSITION(' ' IN SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,LENGTH(a.PRODUCT_DESCRIPTION)-POSITION('X' IN a.PRODUCT_DESCRIPTION)+1)) = 0 THEN -1/SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,LENGTH(a.PRODUCT_DESCRIPTION)-POSITION('X' IN a.PRODUCT_DESCRIPTION)+1)::decimal WHEN a.EXECUTIVE_MODEL = 'CONSTANTLEVERAGECERTIFICATE' AND POSITION(' ' IN SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,LENGTH(a.PRODUCT_DESCRIPTION)-POSITION('X' IN a.PRODUCT_DESCRIPTION)+1)) <> 0 THEN -1/ SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,POSITION(' ' IN SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,LENGTH(a.PRODUCT_DESCRIPTION)-POSITION('X' IN a.PRODUCT_DESCRIPTION)+1))-1)::decimal ELSE -1/ROUND(ABS(a.UNDERLIER_PRICE/(a.STRIKE-a.UNDERLIER_PRICE)),2) END as RevLEVERAGE, sum(a.USD_DELTA) as USD_DELTA, sum(a.SLIDE_EQ_MIN_30_USD) as SLIDE_EQ_MIN_30_USD, sum(a.SLIDE_EQ_MIN_50_USD) as SLIDE_EQ_MIN_50_USD, sum(a.USD_MARKET_VALUE) as USD_MARKET_VALUE FROM CDWUSER.U_EXP_MSR a WHERE a.COB_DATE ='2018-02-28' AND a.UNDERLIER_PRODUCT_DESCRIPTION = 'FINGERPRINT CARDS B' AND a.CCC_HIERARCHY_LEVEL10 = 'ETP MAIN' GROUP BY a.CCC_BOOK_DETAIL, a.UNDERLIER_PRODUCT_DESCRIPTION, a.PRODUCT_DESCRIPTION, a.EXECUTIVE_MODEL, a.CASH_ISSUE_TYPE, a.UNDERLIER_PRICE, a.STRIKE, CASE WHEN a.EXECUTIVE_MODEL = 'CONSTANTLEVERAGECERTIFICATE' AND POSITION(' ' IN SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,LENGTH(a.PRODUCT_DESCRIPTION)-POSITION('X' IN a.PRODUCT_DESCRIPTION)+1)) = 0 THEN -1/SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,LENGTH(a.PRODUCT_DESCRIPTION)-POSITION('X' IN a.PRODUCT_DESCRIPTION)+1)::decimal WHEN a.EXECUTIVE_MODEL = 'CONSTANTLEVERAGECERTIFICATE' AND POSITION(' ' IN SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,LENGTH(a.PRODUCT_DESCRIPTION)-POSITION('X' IN a.PRODUCT_DESCRIPTION)+1)) <> 0 THEN -1/ SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,POSITION(' ' IN SUBSTR(a.PRODUCT_DESCRIPTION, POSITION('X' IN a.PRODUCT_DESCRIPTION)+1,LENGTH(a.PRODUCT_DESCRIPTION)-POSITION('X' IN a.PRODUCT_DESCRIPTION)+1))-1)::decimal ELSE -1/ROUND(ABS(a.UNDERLIER_PRICE/(a.STRIKE-a.UNDERLIER_PRICE)),2) END ) a GROUP BY PRODUCT_DESCRIPTION, RevLEVERAGE, USD_DELTA, USD_MARKET_VALUE