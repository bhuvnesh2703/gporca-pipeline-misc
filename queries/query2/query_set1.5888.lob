SELECT COB_DATE, CASE WHEN term_of_measure/365 < 0.5 THEN '01. 3M' WHEN term_of_measure/365 < 1 THEN '02. 6M' WHEN term_of_measure/365 < 2 THEN '03. 1Y' WHEN term_of_measure/365 < 3 THEN '04. 2Y' WHEN term_of_measure/365 < 4 THEN '05. 3Y' WHEN term_of_measure/365 < 5 THEN '06. 4Y' WHEN term_of_measure/365 < 7 THEN '07. 5Y' WHEN term_of_measure/365 < 10 THEN '08. 7Y' WHEN term_of_measure/365 < 15 THEN '09. 10Y' WHEN term_of_measure/365 < 20 THEN '10. 15Y' ELSE '11. 20Y' END term0, case when curve_name = 'eurnw_disc' then 'EUR 3sFF' when curve_name in ('usdn_disc', 'usdnw_3m', 'usdnw_disc') then 'USD 3sFF' WHEN curve_name = 'gbpnw_disc' THEN 'GBP 3sFF' when curve_name = 'usdn_1m' then 'USD 3s1s' when curve_name= 'eurnw_6m' then 'EUR 6s3s' else 'Other' end type0, CASE WHEN term_of_measure/365 < 0.25 THEN SUM (USD_IRPV01SPRD) WHEN term_of_measure/365 < 0.5 THEN SUM (USD_IRPV01SPRD) * (0.5 - term_of_measure/365) / 0.25 WHEN term_of_measure/365 < 1 THEN SUM(USD_IRPV01SPRD) * (1 - term_of_measure/365) / 0.5 WHEN term_of_measure/365 < 2 THEN SUM(USD_IRPV01SPRD) * (2 - term_of_measure/365) / 1 WHEN term_of_measure/365 < 3 THEN SUM (USD_IRPV01SPRD) * (3 - term_of_measure/365) /1 WHEN term_of_measure/365 < 4 THEN SUM (USD_IRPV01SPRD) * (4 - term_of_measure/365) / 1 WHEN term_of_measure/365 < 5 THEN SUM (USD_IRPV01SPRD) * (5 - term_of_measure/365) / 1 WHEN term_of_measure/365 < 7 THEN SUM (USD_IRPV01SPRD) * (7 - term_of_measure/365) / 2 WHEN term_of_measure/365 < 10 THEN SUM (USD_IRPV01SPRD) * (10 - term_of_measure/365) / 3 WHEN term_of_measure/365 < 15 THEN SUM (USD_IRPV01SPRD) * (15 - term_of_measure/365) / 5 WHEN term_of_measure/365 < 20 THEN SUM (USD_IRPV01SPRD) * (20 - term_of_measure/365) / 5 WHEN term_of_measure/365 < 30 THEN SUM (USD_IRPV01SPRD) * (30 - term_of_measure/365) / 10 ELSE SUM (USD_IRPV01SPRD) END term_irpv01sprd from cdwuser.U_DM_TREASURY WHERE cob_date in ('2018-02-28', '2018-02-21', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31','2017-09-29','2017-08-31', '2017-12-29') and CCC_DIVISION = 'TREASURY CAPITAL MARKETS' AND USD_IRPV01SPRD IS NOT NULL AND term_of_measure/365 < 30 AND CURVE_NAME NOT LIKE 'fxusd%' and CCC_BUSINESS_AREA NOT IN ('MS BANK - PRIVATE BANK1') AND CCC_STRATEGY NOT IN ('STRUCTURED N', 'L-TERM DEBT SN', 'L-TERM DEBT SN ALLOC') AND book NOT IN ('AEOEQ', 'LIABB', 'TRPFD', 'PRFEQ', 'TDET2', 'TDET4', 'TDET5', 'TDET6', 'TDET7', 'TDET8', 'LHRO1', 'LHRO2','TSYGLRCSH') GROUP BY cob_date, CASE WHEN term_of_measure/365 < 0.5 THEN '01. 3M' WHEN term_of_measure/365 < 1 THEN '02. 6M' WHEN term_of_measure/365 < 2 THEN '03. 1Y' WHEN term_of_measure/365 < 3 THEN '04. 2Y' WHEN term_of_measure/365 < 4 THEN '05. 3Y' WHEN term_of_measure/365 < 5 THEN '06. 4Y' WHEN term_of_measure/365 < 7 THEN '07. 5Y' WHEN term_of_measure/365 < 10 THEN '08. 7Y' WHEN term_of_measure/365 < 15 THEN '09. 10Y' WHEN term_of_measure/365 < 20 THEN '10. 15Y' ELSE '11. 20Y' END, case when curve_name = 'eurnw_disc' then 'EUR 3sFF' when curve_name in ('usdn_disc', 'usdnw_3m', 'usdnw_disc') then 'USD 3sFF' WHEN curve_name = 'gbpnw_disc' THEN 'GBP 3sFF' when curve_name = 'usdn_1m' then 'USD 3s1s' when curve_name= 'eurnw_6m' then 'EUR 6s3s' else 'Other' end, term_of_measure/365 HAVING ABS (SUM (USD_IRPV01SPRD)) > 0 UNION ALL SELECT COB_DATE, case when term_of_measure/365 < 0.5 then '02. 6M' when term_of_measure/365 < 1 then '03. 1Y' when term_of_measure/365 < 2 then '04. 2Y' when term_of_measure/365 < 3 then '05. 3Y' when term_of_measure/365 < 4 then '06. 4Y' when term_of_measure/365 < 5 then '07. 5Y' when term_of_measure/365 < 7 then '08. 7Y' when term_of_measure/365 < 10 then '09. 10Y' when term_of_measure/365 < 15 then '10. 15Y' when term_of_measure/365 < 20 then '11. 20Y' else '12. 30Y' end term0, case when curve_name = 'eurnw_disc' then 'EUR 3sFF' when curve_name in ('usdn_disc', 'usdnw_3m', 'usdnw_disc') then 'USD 3sFF' WHEN curve_name = 'gbpnw_disc' THEN 'GBP 3sFF' when curve_name = 'usdn_1m' then 'USD 3s1s' when curve_name= 'eurnw_6m' then 'EUR 6s3s' else 'Other' end type0, case when term_of_measure/365 < 0.5 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 0.25)/0.25 when term_of_measure/365 < 1 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 0.5)/0.5 when term_of_measure/365 < 2 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 1)/1 when term_of_measure/365 < 3 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 2)/1 when term_of_measure/365 < 4 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 3)/1 when term_of_measure/365 < 5 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 4)/1 when term_of_measure/365 < 7 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 5)/2 when term_of_measure/365 < 10 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 7)/3 when term_of_measure/365 < 15 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 10)/5 when term_of_measure/365 < 20 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 15)/5 when term_of_measure/365 < 30 then sum(USD_IRPV01SPRD) * (term_of_measure/365 - 20)/10 else sum(USD_IRPV01SPRD) end term_irpv01sprd from cdwuser.U_DM_TREASURY WHERE cob_date in ('2018-02-28', '2018-02-21', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31','2017-09-29','2017-08-31', '2017-12-29') and CCC_DIVISION = 'TREASURY CAPITAL MARKETS' AND USD_IRPV01SPRD IS NOT NULL AND term_of_measure/365 >=0.25 and CURVE_NAME NOT LIKE 'fxusd%' and CCC_BUSINESS_AREA NOT IN ('MS BANK - PRIVATE BANK1') AND CCC_STRATEGY NOT IN ('STRUCTURED N', 'L-TERM DEBT SN', 'L-TERM DEBT SN ALLOC') AND book NOT IN ('AEOEQ', 'LIABB', 'TRPFD', 'PRFEQ', 'TDET2', 'TDET4', 'TDET5', 'TDET6', 'TDET7', 'TDET8', 'LHRO1', 'LHRO2','TSYGLRCSH') group by COB_DATE, case when term_of_measure/365 < 0.5 then '02. 6M' when term_of_measure/365 < 1 then '03. 1Y' when term_of_measure/365 < 2 then '04. 2Y' when term_of_measure/365 < 3 then '05. 3Y' when term_of_measure/365 < 4 then '06. 4Y' when term_of_measure/365 < 5 then '07. 5Y' when term_of_measure/365 < 7 then '08. 7Y' when term_of_measure/365 < 10 then '09. 10Y' when term_of_measure/365 < 15 then '10. 15Y' when term_of_measure/365 < 20 then '11. 20Y' else '12. 30Y' end, case when curve_name = 'eurnw_disc' then 'EUR 3sFF' when curve_name in ('usdn_disc', 'usdnw_3m', 'usdnw_disc') then 'USD 3sFF' WHEN curve_name = 'gbpnw_disc' THEN 'GBP 3sFF' when curve_name = 'usdn_1m' then 'USD 3s1s' when curve_name= 'eurnw_6m' then 'EUR 6s3s' else 'Other' end, term_of_measure/365 HAVING ABS (SUM (USD_IRPV01SPRD)) > 0