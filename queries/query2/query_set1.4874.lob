Select 'CCAR' as src, PVT.COB_DATE, case when book='2860' then 'INVESTOR BUSINESS' else PVT.CCC_BUSINESS_AREA end as CCC_BUSINESS_AREA, PVT.attribution, Case when CCC_BUSINESS_AREA='INVESTOR BUSINESS' then CCC_STRATEGY else CCC_PRODUCT_LINE end as CCC_PRODUCT_LINE, SUM(case when SCENARIO_TYPE='FULL_REVAL' then PVT.SCENARIO_PNL else 0 end) AS FULL_REVAL_SCN_PNL_INCLUDED, SUM(case when SCENARIO_TYPE='GREEK' then PVT.SCENARIO_PNL else 0 end) AS GREEK_SCN_PNL, SUM(case when SCENARIO_TYPE = 'GREEK' and is_included = 'YES' then PVT.SCENARIO_PNL else 0 end) AS GREEK_INCLUDED_SCN_PNL, SUM(case when SCENARIO_TYPE = 'GREEK' and is_included = 'NO' then PVT.SCENARIO_PNL else 0 end) AS GREEK_NOT_INCLUDED_SCN_PNL, SUM(case when IS_INCLUDED='YES' then PVT.SCENARIO_PNL else 0 end) AS IS_INCLUDED_PNL, SUM(case when ( ( SCENARIO_TYPE='FULL_REVAL' and ATTRIBUTION = 'CM PRICE') or ( SCENARIO_TYPE='GREEK' and IS_INCLUDED='YES' and ATTRIBUTION in ('CM DELTA','CM GAMMA'))) then PVT.SCENARIO_PNL else 0 end) AS SPOT_SLIDE_PNL, SUM(case when SCENARIO_TYPE='FULL_REVAL' and ATTRIBUTION = 'CM PRICE' then PVT.SCENARIO_PNL else 0 end) AS SPOT_SLIDE_PNL_FULL_REVAL, SUM(case when SCENARIO_TYPE='GREEK' and IS_INCLUDED='YES' and ATTRIBUTION in ('CM DELTA','CM GAMMA') then PVT.SCENARIO_PNL else 0 end) AS SPOT_SLIDE_PNL_GREEK, SUM(case when ( ( SCENARIO_TYPE='FULL_REVAL' and ATTRIBUTION = 'CM VOLATILITY') or ( SCENARIO_TYPE='GREEK' and IS_INCLUDED='YES' and ATTRIBUTION = 'CM VEGA')) then PVT.SCENARIO_PNL else 0 end) AS VOL_SLIDE_PNL, SUM(case when SCENARIO_TYPE='FULL_REVAL' and ATTRIBUTION = 'CM VOLATILITY' then PVT.SCENARIO_PNL else 0 end) AS VOL_SLIDE_PNL_FULL_REVAL, SUM(case when SCENARIO_TYPE='GREEK' and IS_INCLUDED='YES' and ATTRIBUTION = 'CM VEGA' then PVT.SCENARIO_PNL else 0 end) AS VOL_SLIDE_PNL_GREEK, CASE WHEN (ATTRIBUTION = 'CM GAMMA' AND HAS_CROSSGAMMA = 'Y') THEN 'EXCLUDE' ELSE 'INCLUDE' END AS EXCLUDE_INCLUDE from DWUSER.U_MODULAR_SCENARIOS PVT where COB_DATE in ('2018-02-28','2018-02-21') and Run_profile = 'CCAR_CM' and Stress_Scenario = 'CCAR_CM_2013_SEV' and PVT.CCC_DIVISION = 'COMMODITIES' and coalesce(pvt.subprod_product_type,'null') not in ('ERROR','CASH','CREDIT', 'INTEREST RATE', 'CURRENCY','INFLATION','EURO GAS SPREAD','EURO PWR SPREAD', 'AUS PWR SPREAD' ) and coalesce(PVT.RISK_SYSTEM,'null') not in ('CRR_STORAGE', 'CRR_STORAGE_LN') and Include_in_reg_cap = 'Y' and (ccc_business_area not in ('COMMODS FINANCING') or book='2860') GROUP BY PVT.COB_DATE, case when book='2860' then 'INVESTOR BUSINESS' else PVT.CCC_BUSINESS_AREA end, PVT.attribution, Case when CCC_BUSINESS_AREA='INVESTOR BUSINESS' then CCC_STRATEGY else CCC_PRODUCT_LINE end, CCC_STRATEGY, HAS_CROSSGAMMA union Select 'CM_MOD' as src, PVT.COB_DATE, case when book='2860' then 'INVESTOR BUSINESS' else PVT.CCC_BUSINESS_AREA end as CCC_BUSINESS_AREA, PVT.attribution, Case when CCC_BUSINESS_AREA='INVESTOR BUSINESS' then CCC_STRATEGY else CCC_PRODUCT_LINE end as CCC_PRODUCT_LINE, SUM(case when SCENARIO_TYPE='FULL_REVAL' then PVT.SCENARIO_PNL else 0 end) AS FULL_REVAL_SCN_PNL_INCLUDED, SUM(case when SCENARIO_TYPE='GREEK' then PVT.SCENARIO_PNL else 0 end) AS GREEK_SCN_PNL, SUM(case when SCENARIO_TYPE = 'GREEK' and is_included = 'YES' then PVT.SCENARIO_PNL else 0 end) AS GREEK_INCLUDED_SCN_PNL, SUM(case when SCENARIO_TYPE = 'GREEK' and is_included = 'NO' then PVT.SCENARIO_PNL else 0 end) AS GREEK_NOT_INCLUDED_SCN_PNL, SUM(case when IS_INCLUDED='YES' then PVT.SCENARIO_PNL else 0 end) AS IS_INCLUDED_PNL, SUM(case when ( ( SCENARIO_TYPE='FULL_REVAL' and ATTRIBUTION = 'CM PRICE') or ( SCENARIO_TYPE='GREEK' and IS_INCLUDED='YES' and ATTRIBUTION in ('CM DELTA','CM GAMMA'))) then PVT.SCENARIO_PNL else 0 end) AS SPOT_SLIDE_PNL, SUM(case when SCENARIO_TYPE='FULL_REVAL' and ATTRIBUTION = 'CM PRICE' then PVT.SCENARIO_PNL else 0 end) AS SPOT_SLIDE_PNL_FULL_REVAL, SUM(case when SCENARIO_TYPE='GREEK' and IS_INCLUDED='YES' and ATTRIBUTION in ('CM DELTA','CM GAMMA') then PVT.SCENARIO_PNL else 0 end) AS SPOT_SLIDE_PNL_GREEK, SUM(case when ( ( SCENARIO_TYPE='FULL_REVAL' and ATTRIBUTION = 'CM VOLATILITY') or ( SCENARIO_TYPE='GREEK' and IS_INCLUDED='YES' and ATTRIBUTION = 'CM VEGA')) then PVT.SCENARIO_PNL else 0 end) AS VOL_SLIDE_PNL, SUM(case when SCENARIO_TYPE='FULL_REVAL' and ATTRIBUTION = 'CM VOLATILITY' then PVT.SCENARIO_PNL else 0 end) AS VOL_SLIDE_PNL_FULL_REVAL, SUM(case when SCENARIO_TYPE='GREEK' and IS_INCLUDED='YES' and ATTRIBUTION = 'CM VEGA' then PVT.SCENARIO_PNL else 0 end) AS VOL_SLIDE_PNL_GREEK, CASE WHEN (ATTRIBUTION = 'CM GAMMA' AND HAS_CROSSGAMMA = 'Y') THEN 'EXCLUDE' ELSE 'INCLUDE' END AS EXCLUDE_INCLUDE from DWUSER.U_MODULAR_SCENARIOS PVT where COB_DATE in ('2018-02-28','2018-02-21') and Run_profile = 'CM_MOD_SCN_RUN' and Stress_Scenario = 'CM_PRICE_DOWN40_VOL_UP50' and PVT.CCC_DIVISION = 'COMMODITIES' and coalesce(pvt.subprod_product_type,'null') not in ('ERROR','CASH','CREDIT', 'INTEREST RATE', 'CURRENCY','INFLATION','EURO GAS SPREAD','EURO PWR SPREAD', 'AUS PWR SPREAD' ) and coalesce(PVT.RISK_SYSTEM,'null') not in ('CRR_STORAGE', 'CRR_STORAGE_LN') and Include_in_reg_cap = 'Y' and (ccc_business_area not in ('COMMODS FINANCING') or book='2860') GROUP BY PVT.COB_DATE, case when book='2860' then 'INVESTOR BUSINESS' else PVT.CCC_BUSINESS_AREA end, PVT.attribution, Case when CCC_BUSINESS_AREA='INVESTOR BUSINESS' then CCC_STRATEGY else CCC_PRODUCT_LINE end, CCC_STRATEGY, HAS_CROSSGAMMA