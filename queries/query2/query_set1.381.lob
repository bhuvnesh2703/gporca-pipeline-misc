SELECT B.COB_DATE, CASE WHEN ( CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND CCC_PRODUCT_LINE IN ('INV GRADE TRADING - EU','HIGH YIELD - EU', 'EUROPEAN CREDIT FLOW') ) THEN 'EUROPEAN CREDIT FLOW' WHEN CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND ( CCC_PRODUCT_LINE LIKE 'INV GRADE TRADING%' OR CCC_STRATEGY LIKE 'INV GRADE TRADING%' ) THEN 'IG' WHEN CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND CCC_PRODUCT_LINE LIKE 'HIGH YIELD%' THEN 'HY' WHEN ( CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND ( CCC_PRODUCT_LINE != 'DISTRESSED TRADING' OR CCC_STRATEGY = 'PAR LOANS TRADING' ) AND CCC_PRODUCT_LINE NOT LIKE '%PRIMARY%' ) OR ( CCC_BUSINESS_AREA IN ('DSP - CREDIT') AND CCC_PRODUCT_LINE IN ('DSP INDEX PRODUCTS TRADING','DSP INDEX PRODUCTS') ) THEN 'OTHER' ELSE 'N/A' END AS CC_TYPE, SUM(cast(B.BPV10 as numeric(15,5))) AS BPV10 FROM ( SELECT A.COB_DATE, SUM(cast (A.USD_PV10_BENCH as numeric(15,5))) AS BPV10, A.FID1_SENIORITY, A.CCC_PRODUCT_LINE, A.CCC_STRATEGY, CASE WHEN A.PRODUCT_TYPE_CODE IN ('BANKDEBT') THEN 'BANKDEBT' WHEN A.PRODUCT_TYPE_CODE IN ( 'BOND','CASH','EQUITY','FEE','FLOOR','FX','GVTBOND','PREF','TRS - BOND', 'TRS - GVTBOND', 'TRD_CLAIM','BOND ETF','BONDFUT','BONDIL','CONVRT' ) THEN 'CASH' WHEN A.PRODUCT_TYPE_CODE IN ('CRDINDEX','LOANINDEX','MUNICDX','CDSOPTIDX') THEN 'INDEX' ELSE 'CDS / OTHER SYNTHETIC' END AS SECTYPE2, A.CCC_BUSINESS_AREA, A.ISSUER_COUNTRY_CODE FROM CDWUSER.U_DM_CC A WHERE a.COB_DATE = '2018-02-28' AND ( A.CCC_BUSINESS_AREA IN ('CREDIT-CORPORATES') OR ( CCC_BUSINESS_AREA IN ('DSP - CREDIT') AND CCC_PRODUCT_LINE IN ('DSP INDEX PRODUCTS TRADING','DSP INDEX PRODUCTS') ) ) AND NOT ( A.FID1_SENIORITY IN ('SUBT1', 'SUBUT2','AT1') AND PRODUCT_TYPE_CODE IN ('BOND','PREF') AND ( A.CCC_BUSINESS_AREA IN ('CREDIT-CORPORATES') ) ) GROUP BY A.COB_DATE, A.FID1_SENIORITY, A.CCC_PRODUCT_LINE, A.CCC_STRATEGY, CASE WHEN A.PRODUCT_TYPE_CODE IN ('BANKDEBT') THEN 'BANKDEBT' WHEN A.PRODUCT_TYPE_CODE IN ( 'BOND','CASH','EQUITY','FEE','FLOOR','FX','GVTBOND','PREF','TRS - BOND', 'TRS - GVTBOND', 'TRD_CLAIM','BOND ETF','BONDFUT','BONDIL','CONVRT' ) THEN 'CASH' WHEN A.PRODUCT_TYPE_CODE IN ('CRDINDEX','LOANINDEX','MUNICDX','CDSOPTIDX') THEN 'INDEX' ELSE 'CDS / OTHER SYNTHETIC' END, A.CCC_BUSINESS_AREA, A.ISSUER_COUNTRY_CODE ) B GROUP BY B.COB_DATE, CASE WHEN ( CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND CCC_PRODUCT_LINE IN ('INV GRADE TRADING - EU','HIGH YIELD - EU', 'EUROPEAN CREDIT FLOW') ) THEN 'EUROPEAN CREDIT FLOW' WHEN CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND ( CCC_PRODUCT_LINE LIKE 'INV GRADE TRADING%' OR CCC_STRATEGY LIKE 'INV GRADE TRADING%' ) THEN 'IG' WHEN CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND CCC_PRODUCT_LINE LIKE 'HIGH YIELD%' THEN 'HY' WHEN ( CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND ( CCC_PRODUCT_LINE != 'DISTRESSED TRADING' OR CCC_STRATEGY = 'PAR LOANS TRADING' ) AND CCC_PRODUCT_LINE NOT LIKE '%PRIMARY%' ) OR ( CCC_BUSINESS_AREA IN ('DSP - CREDIT') AND CCC_PRODUCT_LINE IN ('DSP INDEX PRODUCTS TRADING','DSP INDEX PRODUCTS') ) THEN 'OTHER' ELSE 'N/A' END