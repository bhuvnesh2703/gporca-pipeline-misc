SELECT CASE WHEN ROW_NUMBER() OVER() < 7 THEN RANK ELSE 7 END AS RANK, CASE WHEN ROW_NUMBER() OVER() < 7 THEN SECTYPE2 ELSE 'OTHER' END AS PRODUCT, USD_KAPPA_COB, USD_KAPPA_CHANGE FROM ( SELECT RANK() OVER(ORDER BY PRODUCT_GROUP, ABS(USD_KAPPA_COB) DESC) AS RANK, SECTYPE2, USD_KAPPA_COB/10 AS USD_KAPPA_COB, USD_KAPPA_CHANGE/10 AS USD_KAPPA_CHANGE FROM ( SELECT CASE WHEN SECTYPE2 = 'OTHER' THEN 2 ELSE 1 END AS PRODUCT_GROUP, Z.* FROM ( SELECT CASE WHEN UPPER(CURVE_NAME) = 'KRWKTB' THEN 'GOVTS' WHEN SECTYPE2 = 'UNDEFINED' THEN 'OTHER' ELSE SECTYPE2 END SECTYPE2, SUM(CASE WHEN cob_date = '2018-02-28' THEN coalesce(usd_ir_kappa, 0) ELSE 0 END) AS usd_kappa_cob, SUM(CASE WHEN cob_date = '2018-02-28' THEN coalesce(usd_ir_kappa, 0) ELSE -coalesce(usd_ir_kappa, 0) END) AS usd_kappa_change FROM CDWUSER.U_EXP_MSR WHERE cob_date IN ('2018-02-28', '2018-02-21') AND PARENT_LEGAL_ENTITY = '0517(G)' AND VAR_EXCL_FL <> 'Y' AND ccc_banking_trading = 'TRADING' GROUP BY CASE WHEN UPPER(CURVE_NAME) = 'KRWKTB' THEN 'GOVTS' WHEN SECTYPE2 = 'UNDEFINED' THEN 'OTHER' ELSE SECTYPE2 END ) Z ORDER BY PRODUCT_GROUP ) H ORDER BY RANK ) T