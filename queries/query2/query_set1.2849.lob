select Rank() Over(order by abs(sum(case when cob_date = '2018-02-28' then coalesce(e.SLIDE_PAL_STK_JTD_USD,0) else 0 end)) desc) as Rank, e.SRC_TICK||'.'||e.SRC_EXCHANGE as ticker, src_product_description as UNDERLIER_PRODUCT_DESCRIPTION, sum(case when cob_date = '2018-02-28' then coalesce(e.SLIDE_PAL_STK_JTD_USD,0) else 0 end) as JTD_COB, sum(case when cob_date = '2018-02-28' then coalesce(e.SLIDE_PAL_STK_JTD_USD,0) else -coalesce(e.SLIDE_PAL_STK_JTD_USD,0) end) as JTD_DOD, sum(case when cob_date = '2018-02-28' then coalesce(e.SLIDE_PAL_STK_30_DOWN_USD,0) else 0 end) as D30_COB from cdwuser.U_EQ_EXT_MSR e where e.COB_DATE in ('2018-02-28','2018-02-21') and e.DIVISION = 'IED' and e.SLIDE_TYPE_FL = 'D' and e.CCC_BANKING_TRADING = 'TRADING' and e.CCC_BUSINESS_AREA NOT IN ('EQUITY FINANCING PRODUCTS', 'PRIME BROKERAGE') group by e.SRC_TICK||'.'||e.SRC_EXCHANGE, src_product_description fetch first 4 rows only