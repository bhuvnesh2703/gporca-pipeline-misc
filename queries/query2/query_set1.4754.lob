SELECT a.CCC_DIVISION,a.COB_DATE, a.CURRENCY_OF_MEASURE, a.PRODUCT_TYPE_CODE, CASE WHEN COB_DATE = '2017-11-15' THEN 0 ELSE sum(a.USD_DELTA) END as EQdelta, CASE WHEN COB_DATE = '2017-11-15' THEN 0 WHEN COB_DATE = '2017-12-01' THEN 0 ELSE sum((case when currency_of_measure not in ('EUR','USD','UDB') then coalesce(a.usd_fx,0) else 0 end)) END as USD_FX_DELTA, sum(coalesce(a.USD_IR_UNIFIED_PV01,0)) as USD_IR_UNIFIED_PV01 FROM CDWUSER.U_EXP_MSR a WHERE a.COB_DATE <='2018-02-22' and a.COB_DATE >= '2018-01-24' and a.CCC_TAPS_COMPANY='0620' GROUP BY a.COB_DATE, a.CCC_DIVISION, a.CURRENCY_OF_MEASURE, a.PRODUCT_TYPE_CODE UNION ALL /* adjustment due to incorrect EQ delta and FX Delta in database for 11/15/2017 */ SELECT a.CCC_DIVISION, '11/15/2017' AS COB_DATE, a.CURRENCY_OF_MEASURE, a.PRODUCT_TYPE_CODE, sum(a.USD_DELTA) as EQdelta, sum((case when currency_of_measure not in ('EUR','USD','UDB') then coalesce(a.usd_fx,0) else 0 end))as USD_FX_DELTA, 0 as USD_IR_UNIFIED_PV01 FROM CDWUSER.U_EXP_MSR a WHERE a.COB_DATE = '2017-11-14' and a.CCC_TAPS_COMPANY='0620' GROUP BY a.COB_DATE, a.CCC_DIVISION, a.CURRENCY_OF_MEASURE, a.PRODUCT_TYPE_CODE UNION ALL /* adjustment due to incorrect FX delta for INR in database for 12/01/2017 */ SELECT a.CCC_DIVISION, '12/01/2017' AS COB_DATE, a.CURRENCY_OF_MEASURE, a.PRODUCT_TYPE_CODE, 0 as EQdelta, sum((case when currency_of_measure not in ('EUR','USD','UDB') then coalesce(a.usd_fx,0) else 0 end))as USD_FX_DELTA, 0 as USD_IR_UNIFIED_PV01 FROM CDWUSER.U_EXP_MSR a WHERE a.COB_DATE = '2017-11-30' and a.CCC_TAPS_COMPANY='0620' GROUP BY a.COB_DATE, a.CCC_DIVISION, a.CURRENCY_OF_MEASURE, a.PRODUCT_TYPE_CODE