select COB_DATE, case when BOOK in ('RPOTO', 'RPOAF', 'RPOBK', 'RPOSE') or account in ('07000AF31') then 'NY' when BOOK in ('RWUIP','RWUIS', 'NYDI','RWUUK','RWULT', 'RWPO3') or account in ('07600AGA8') THEN 'LN' when BOOK in ('RWILX') THEN 'AP' else 'OTHER BOOKS' end as BOOK_REGION, currency_of_measure, case when CURRENCY_OF_MEASURE IN ('USD', 'EUR') and (BOOK in ('RPOTO', 'RPOAF', 'RPOBK', 'RPOSE') OR account in ('07000AF31')) then CURRENCY_OF_MEASURE when BOOK in ('RWUIP','RWUIS', 'NYDI','RWUUK','RWULT', 'RWPO3', 'RWILX') OR account in ('07600AGA8') then CURRENCY_OF_MEASURE else 'OTHER' end as CURRENCY, book, account, BU_RISK_SYSTEM, CASE WHEN REPO_MATURITY_PERIOD = '01/01/1980' OR REPO_MATURITY_PERIOD = '01/01/1970' THEN 'Other Maturities' else REPO_MATURITY_PERIOD END AS REPO_MATURITY_PERIOD, EXPIRATION_DATE, case when ((((Expiration_date) - (Cob_Date))/7 >=0 and ((Expiration_date) - (Cob_Date))/7 <=1) or repo_maturity_period = '1 week') then '1 Week' when ((((Expiration_date) - (Cob_Date))/7 >1 and ((Expiration_date) - (Cob_Date))/7 <=2) or repo_maturity_period = '2 weeks') then '2 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >2 and ((Expiration_date) - (Cob_Date))/7 <=3) or repo_maturity_period = '3 weeks') then '3 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >3 and ((Expiration_date) - (Cob_Date))/7 <=4) or repo_maturity_period = '4 weeks') then '4 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >4 and ((Expiration_date) - (Cob_Date))/7 <=5) or repo_maturity_period = '5 weeks') then '5 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >5 and ((Expiration_date) - (Cob_Date))/7 <=6) or repo_maturity_period = '6 weeks') then '6 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >6 and ((Expiration_date) - (Cob_Date))/7 <=7) or repo_maturity_period = '7 weeks') then '7 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >7 and ((Expiration_date) - (Cob_Date))/7 <=8) or repo_maturity_period = '8 weeks') then '8 Weeks' when (((Expiration_date) - (Cob_Date))/7 >8 and ((Expiration_date) - (Cob_Date))/7 <=12) then '3 Months' when (((Expiration_date) - (Cob_Date))/7 >12 and ((Expiration_date) - (Cob_Date))/7 <=26) then '6 Months' when (((Expiration_date) - (Cob_Date))/7 >26 and ((Expiration_date) - (Cob_Date))/7 <=52) then '1 Yr' when ((Expiration_date) - (Cob_Date))/7 > 52 then '2 Yr+' else 'Other Maturities' end as Chart_Bucketing, sum(coalesce(CASE WHEN book in('SWPIN','TDET6', 'TAIRR', 'TAEMR', 'TEEMR', 'HKFAP', 'TTIRR', 'HKFAM', 'TKFVS', 'HKFAS', 'TBAGR') THEN -usd_notional WHEN (book in('CALLT', 'CALTB', 'LCALT', 'LCATB')) THEN usd_MARKET_VALUE else usd_notional END, 0)) as USD_NOTIONAL from cdwuser.U_DM_TREASURY where cob_date in ('2018-02-28', '2018-02-27') and CCC_DIVISION = 'TREASURY CAPITAL MARKETS' and CCC_BUSINESS_AREA = 'LIQUIDITY RESERVE1' and LIQUIDITY_SUB_SECTYPE LIKE '%Term Reverse Repos%' and CCC_PRODUCT_LINE = 'LIQUIDITY' and BOOK not in ('TSYGLRCSH') and ACCOUNT NOT IN ('07000AB27') and USD_NOTIONAL is not NULL group by COB_DATE, BOOK, BU_RISK_SYSTEM, CURRENCY_OF_MEASURE, account, EXPIRATION_DATE, currency_of_measure, CASE WHEN REPO_MATURITY_PERIOD = '01/01/1980' OR REPO_MATURITY_PERIOD = '01/01/1970' THEN 'Other Maturities' else REPO_MATURITY_PERIOD END, case when ((((Expiration_date) - (Cob_Date))/7 >=0 and ((Expiration_date) - (Cob_Date))/7 <=1) or repo_maturity_period = '1 week') then '1 Week' when ((((Expiration_date) - (Cob_Date))/7 >1 and ((Expiration_date) - (Cob_Date))/7 <=2) or repo_maturity_period = '2 weeks') then '2 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >2 and ((Expiration_date) - (Cob_Date))/7 <=3) or repo_maturity_period = '3 weeks') then '3 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >3 and ((Expiration_date) - (Cob_Date))/7 <=4) or repo_maturity_period = '4 weeks') then '4 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >4 and ((Expiration_date) - (Cob_Date))/7 <=5) or repo_maturity_period = '5 weeks') then '5 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >5 and ((Expiration_date) - (Cob_Date))/7 <=6) or repo_maturity_period = '6 weeks') then '6 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >6 and ((Expiration_date) - (Cob_Date))/7 <=7) or repo_maturity_period = '7 weeks') then '7 Weeks' when ((((Expiration_date) - (Cob_Date))/7 >7 and ((Expiration_date) - (Cob_Date))/7 <=8) or repo_maturity_period = '8 weeks') then '8 Weeks' when (((Expiration_date) - (Cob_Date))/7 >8 and ((Expiration_date) - (Cob_Date))/7 <=12) then '3 Months' when (((Expiration_date) - (Cob_Date))/7 >12 and ((Expiration_date) - (Cob_Date))/7 <=26) then '6 Months' when (((Expiration_date) - (Cob_Date))/7 >26 and ((Expiration_date) - (Cob_Date))/7 <=52) then '1 Yr' when ((Expiration_date) - (Cob_Date))/7 > 52 then '2 Yr+' else 'Other Maturities' end, case when BOOK in ('RPOTO', 'RPOAF', 'RPOBK', 'RPOSE') or account in ('07000AF31') then 'NY' when BOOK in ('RWUIP','RWUIS', 'NYDI','RWUUK','RWULT', 'RWPO3') or account in ('07600AGA8') THEN 'LN' when BOOK in ('RWILX') THEN 'AP' else 'OTHER BOOKS' end