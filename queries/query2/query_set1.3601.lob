SELECT COB_DATE ,BOOK ,CASE WHEN COUNTRY_CD_OF_RISK = 'IRL' THEN 'IRELAND' WHEN COUNTRY_CD_OF_RISK = 'DEU' THEN 'GERMANY' WHEN COUNTRY_CD_OF_RISK = 'FRA' THEN 'FRANCE' WHEN COUNTRY_CD_OF_RISK = 'BEL' THEN 'BELGIUM' WHEN COUNTRY_CD_OF_RISK = 'NLD' THEN 'NETHERLANDS' WHEN COUNTRY_CD_OF_RISK = 'AUT' THEN 'AUSTRIA' WHEN COUNTRY_CD_OF_RISK = 'GBR' THEN 'UNITED KINGDOM' ELSE 'OTHER' END AS COUNTRY_CD_OF_RISK ,CCC_BUSINESS_AREA ,CASE WHEN PRODUCT_TYPE_CODE IN ('GVTBOND', 'GVTBONDIL', 'BONDFUT', 'GOVTBONDOPT') THEN 'GOVERNMENT BONDS' WHEN ( PRODUCT_TYPE_CODE IN ('BOND', 'AGN') AND PRODUCT_HIERARCHY_LEVEL7 IN ('COVERED BOND-OTHER', 'HYPOTHEKEN PFANDBRIEFE', 'JUMBO PFANDBRIEFE', 'PFANDBRIEFE', 'UNKNOWN') ) THEN 'COVERED BONDS' WHEN ( PRODUCT_TYPE_CODE IN ('BOND', 'AGN') AND PRODUCT_HIERARCHY_LEVEL7 NOT IN ('COVERED BOND-OTHER', 'HYPOTHEKEN PFANDBRIEFE', 'JUMBO PFANDBRIEFE', 'PFANDBRIEFE', 'UNKNOWN') ) THEN 'SUPRANATIONALS AND AGENCIES' WHEN PRODUCT_TYPE_CODE IN ('CRDBSKT', 'CRDINDEX', 'DEFSWAP') THEN 'CREDIT PRODUCTS' WHEN PRODUCT_TYPE_CODE IN ('ABS', 'RMBS', 'RMBS_ARM', 'RMBS_FIX') THEN 'ABS/RMBS' WHEN PRODUCT_TYPE_CODE NOT IN ('GVTBOND', 'GVTBONDIL', 'BONDFUT', 'GOVTBONDOPT', 'BOND', 'AGN', 'CRDBSKT', 'CRDINDEX', 'DEFSWAP', 'ABS', 'RMBS_ARM') THEN 'OTHER' END AS SECTYPE ,PRODUCT_TYPE_CODE ,TERM_NEW ,SUM(USD_IR_UNIFIED_PV01) AS country_pv01 FROM CDWUSER.U_DM_IR A WHERE cob_date in ('2018-02-28','2018-02-27') AND CCC_BUSINESS_AREA = 'LIQUID FLOW RATES' AND CCC_PL_REPORTING_REGION = 'EMEA' AND CCC_division IN ('FIXED INCOME DIVISION') AND USD_IR_UNIFIED_PV01 IS NOT NULL AND USD_IR_UNIFIED_PV01 <> 0 AND CCC_BUSINESS_AREA NOT IN ('LENDING') AND CCC_BUSINESS_AREA NOT LIKE '%CVA%' AND CCC_BUSINESS_AREA NOT LIKE '%CPM%' AND A.VERTICAL_SYSTEM NOT IN ('C1_LN', 'C1_NY', 'C1_TK') AND COUNTRY_CD_OF_RISK IN ('IRL','NLD', 'CHE', 'SWE', 'NOR', 'AUT', 'GBR', 'FIN', 'DNK', 'BEL', 'DEU', 'FRA') AND A.FID1_INDUSTRY_NAME_LEVEL1 = 'SOVEREIGN' GROUP BY COB_DATE ,BOOK ,CASE WHEN COUNTRY_CD_OF_RISK = 'IRL' THEN 'IRELAND' WHEN COUNTRY_CD_OF_RISK = 'DEU' THEN 'GERMANY' WHEN COUNTRY_CD_OF_RISK = 'FRA' THEN 'FRANCE' WHEN COUNTRY_CD_OF_RISK = 'BEL' THEN 'BELGIUM' WHEN COUNTRY_CD_OF_RISK = 'NLD' THEN 'NETHERLANDS' WHEN COUNTRY_CD_OF_RISK = 'AUT' THEN 'AUSTRIA' WHEN COUNTRY_CD_OF_RISK = 'GBR' THEN 'UNITED KINGDOM' ELSE 'OTHER' END ,CCC_BUSINESS_AREA ,CASE WHEN PRODUCT_TYPE_CODE IN ('GVTBOND', 'GVTBONDIL', 'BONDFUT', 'GOVTBONDOPT') THEN 'GOVERNMENT BONDS' WHEN ( PRODUCT_TYPE_CODE IN ('BOND', 'AGN') AND PRODUCT_HIERARCHY_LEVEL7 IN ('COVERED BOND-OTHER', 'HYPOTHEKEN PFANDBRIEFE', 'JUMBO PFANDBRIEFE', 'PFANDBRIEFE', 'UNKNOWN') ) THEN 'COVERED BONDS' WHEN ( PRODUCT_TYPE_CODE IN ('BOND', 'AGN') AND PRODUCT_HIERARCHY_LEVEL7 NOT IN ('COVERED BOND-OTHER', 'HYPOTHEKEN PFANDBRIEFE', 'JUMBO PFANDBRIEFE', 'PFANDBRIEFE', 'UNKNOWN') ) THEN 'SUPRANATIONALS AND AGENCIES' WHEN PRODUCT_TYPE_CODE IN ('CRDBSKT', 'CRDINDEX', 'DEFSWAP') THEN 'CREDIT PRODUCTS' WHEN PRODUCT_TYPE_CODE IN ('ABS', 'RMBS', 'RMBS_ARM', 'RMBS_FIX') THEN 'ABS/RMBS' WHEN PRODUCT_TYPE_CODE NOT IN ('GVTBOND', 'GVTBONDIL', 'BONDFUT', 'GOVTBONDOPT', 'BOND', 'AGN', 'CRDBSKT', 'CRDINDEX', 'DEFSWAP', 'ABS', 'RMBS_ARM') THEN 'OTHER' END ,PRODUCT_TYPE_CODE ,TERM_NEW UNION ALL SELECT COB_DATE ,BOOK ,CASE WHEN COUNTRY_CD_OF_RISK = 'IRL' THEN 'IRELAND' WHEN COUNTRY_CD_OF_RISK = 'DEU' THEN 'GERMANY' WHEN COUNTRY_CD_OF_RISK = 'FRA' THEN 'FRANCE' WHEN COUNTRY_CD_OF_RISK = 'BEL' THEN 'BELGIUM' WHEN COUNTRY_CD_OF_RISK = 'NLD' THEN 'NETHERLANDS' WHEN COUNTRY_CD_OF_RISK = 'AUT' THEN 'AUSTRIA' WHEN COUNTRY_CD_OF_RISK = 'GBR' THEN 'UNITED KINGDOM' ELSE 'OTHER' END AS COUNTRY_CD_OF_RISK ,CCC_BUSINESS_AREA ,CASE WHEN PRODUCT_TYPE_CODE IN ('GVTBOND', 'GVTBONDIL', 'BONDFUT', 'GOVTBONDOPT') THEN 'GOVERNMENT BONDS' WHEN ( PRODUCT_TYPE_CODE IN ('BOND', 'AGN') AND PRODUCT_HIERARCHY_LEVEL7 IN ('COVERED BOND-OTHER', 'HYPOTHEKEN PFANDBRIEFE', 'JUMBO PFANDBRIEFE', 'PFANDBRIEFE', 'UNKNOWN') ) THEN 'COVERED BONDS' WHEN ( PRODUCT_TYPE_CODE IN ('BOND', 'AGN') AND PRODUCT_HIERARCHY_LEVEL7 NOT IN ('COVERED BOND-OTHER', 'HYPOTHEKEN PFANDBRIEFE', 'JUMBO PFANDBRIEFE', 'PFANDBRIEFE', 'UNKNOWN') ) THEN 'SUPRANATIONALS AND AGENCIES' WHEN PRODUCT_TYPE_CODE IN ('CRDBSKT', 'CRDINDEX', 'DEFSWAP') THEN 'CREDIT PRODUCTS' WHEN PRODUCT_TYPE_CODE IN ('ABS', 'RMBS', 'RMBS_ARM', 'RMBS_FIX') THEN 'ABS/RMBS' WHEN PRODUCT_TYPE_CODE NOT IN ('GVTBOND', 'GVTBONDIL', 'BONDFUT', 'GOVTBONDOPT', 'BOND', 'AGN', 'CRDBSKT', 'CRDINDEX', 'DEFSWAP', 'ABS', 'RMBS_ARM') THEN 'OTHER' END AS SecType ,PRODUCT_TYPE_CODE ,TERM_NEW ,SUM(USD_PV01SPRD) AS country_pv01 FROM CDWUSER.U_DM_IR A WHERE cob_date in ('2018-02-28','2018-02-27') AND CCC_BUSINESS_AREA = 'LIQUID FLOW RATES' AND CCC_PL_REPORTING_REGION = 'EMEA' AND CCC_division IN ('FIXED INCOME DIVISION') AND USD_PV01SPRD IS NOT NULL AND USD_PV01SPRD <> 0 AND CCC_BUSINESS_AREA NOT IN ('LENDING') AND CCC_BUSINESS_AREA NOT LIKE '%CVA%' AND CCC_BUSINESS_AREA NOT LIKE '%CPM%' AND A.VERTICAL_SYSTEM IN ('C1_LN', 'C1_NY', 'C1_TK') AND COUNTRY_CD_OF_RISK IN ('IRL','NLD', 'CHE', 'SWE', 'NOR', 'AUT', 'GBR', 'FIN', 'DNK', 'BEL', 'DEU', 'FRA') AND A.FID1_INDUSTRY_NAME_LEVEL1 = 'SOVEREIGN' GROUP BY COB_DATE ,BOOK ,CASE WHEN COUNTRY_CD_OF_RISK = 'IRL' THEN 'IRELAND' WHEN COUNTRY_CD_OF_RISK = 'DEU' THEN 'GERMANY' WHEN COUNTRY_CD_OF_RISK = 'FRA' THEN 'FRANCE' WHEN COUNTRY_CD_OF_RISK = 'BEL' THEN 'BELGIUM' WHEN COUNTRY_CD_OF_RISK = 'NLD' THEN 'NETHERLANDS' WHEN COUNTRY_CD_OF_RISK = 'AUT' THEN 'AUSTRIA' WHEN COUNTRY_CD_OF_RISK = 'GBR' THEN 'UNITED KINGDOM' ELSE 'OTHER' END ,CCC_BUSINESS_AREA ,CASE WHEN PRODUCT_TYPE_CODE IN ('GVTBOND', 'GVTBONDIL', 'BONDFUT', 'GOVTBONDOPT') THEN 'GOVERNMENT BONDS' WHEN ( PRODUCT_TYPE_CODE IN ('BOND', 'AGN') AND PRODUCT_HIERARCHY_LEVEL7 IN ('COVERED BOND-OTHER', 'HYPOTHEKEN PFANDBRIEFE', 'JUMBO PFANDBRIEFE', 'PFANDBRIEFE', 'UNKNOWN') ) THEN 'COVERED BONDS' WHEN ( PRODUCT_TYPE_CODE IN ('BOND', 'AGN') AND PRODUCT_HIERARCHY_LEVEL7 NOT IN ('COVERED BOND-OTHER', 'HYPOTHEKEN PFANDBRIEFE', 'JUMBO PFANDBRIEFE', 'PFANDBRIEFE', 'UNKNOWN') ) THEN 'SUPRANATIONALS AND AGENCIES' WHEN PRODUCT_TYPE_CODE IN ('CRDBSKT', 'CRDINDEX', 'DEFSWAP') THEN 'CREDIT PRODUCTS' WHEN PRODUCT_TYPE_CODE IN ('ABS', 'RMBS', 'RMBS_ARM', 'RMBS_FIX') THEN 'ABS/RMBS' WHEN PRODUCT_TYPE_CODE NOT IN ('GVTBOND', 'GVTBONDIL', 'BONDFUT', 'GOVTBONDOPT', 'BOND', 'AGN', 'CRDBSKT', 'CRDINDEX', 'DEFSWAP', 'ABS', 'RMBS_ARM') THEN 'OTHER' END ,PRODUCT_TYPE_CODE ,TERM_NEW