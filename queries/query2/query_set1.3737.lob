SELECT COB_DATE, CCC_BUSINESS_AREA, CCC_PRODUCT_LINE, CASE WHEN CCC_PRODUCT_LINE = 'EXOTIC PRODUCTS' THEN 'EXO' WHEN CCC_PRODUCT_LINE = 'INDEX PRODUCTS' THEN 'IDX' ELSE NULL END AS PRD_LINE_FLAG, SUM(CASE WHEN SCENARIO_NAME='S-1%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS D01, SUM(CASE WHEN SCENARIO_NAME='S+1%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS P01, SUM(CASE WHEN SCENARIO_NAME='S-2%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS D02, SUM(CASE WHEN SCENARIO_NAME='S+2%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS P02, SUM(CASE WHEN SCENARIO_NAME='S-5%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS D05, SUM(CASE WHEN SCENARIO_NAME='S+5%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS P05, SUM(CASE WHEN SCENARIO_NAME='S-8%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS D08, SUM(CASE WHEN SCENARIO_NAME='S+8%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS P08, SUM(CASE WHEN SCENARIO_NAME='S-10%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS D10, SUM(CASE WHEN SCENARIO_NAME='S+10%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS P10, SUM(CASE WHEN SCENARIO_NAME='S-20%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS D20, SUM(CASE WHEN SCENARIO_NAME='S+20%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS P20, SUM(CASE WHEN SCENARIO_NAME='S-30%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS D30, SUM(CASE WHEN SCENARIO_NAME='S+30%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS P30, SUM(CASE WHEN SCENARIO_NAME='S-50%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS D50, SUM(CASE WHEN SCENARIO_NAME='S+50%' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN ROUND(POS_TV_MINUS_BASE,2)/1000 ELSE 0 END) AS P50 FROM CDWUSER.U_SURFACE_MSR A WHERE COB_DATE BETWEEN '2018-01-29' AND '2018-02-28' AND BASEL_III_GROUP_BTI = 'TRADING' AND CCC_DIVISION = 'INSTITUTIONAL EQUITY DIVISION' AND SCENARIO_NAME IN ('S-1%','S+1%','S-2%','S+2%', 'S-5%','S+5%', 'S-8%','S+8%', 'S-10%','S+10%', 'S-20%','S+20%', 'S-30%','S+30%', 'S-50%','S+50%' ) GROUP BY 1,2,3,4