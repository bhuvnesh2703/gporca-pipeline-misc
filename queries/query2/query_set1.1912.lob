SELECT A.COB_DATE, a.PRODUCT_DESCRIPTION, CASE WHEN a.CCC_BUSINESS_AREA = 'COMMODITIES' THEN a.CCC_PRODUCT_LINE ELSE a.CCC_BUSINESS_AREA END AS CCC_BUSINESS_AREA, CASE WHEN A.PRODUCT_SUB_TYPE_CODE IN ('N EAST CONSUMPTI', 'N EAST CONSUMPTION') THEN 'N EAST CONSUMPTI' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('N EAST APPALACHI', 'N EAST APPALACHIA') THEN 'N EAST APPALACHI' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('POLYPROPELENE HO', 'POLYPROPELENE HOMOPOLYMER') THEN 'POLYPROPELENE HO' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('POLYPROPYLENE CO', 'POLYPROPYLENE COPOLYMER') THEN 'POLYPROPYLENE CO' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('PURE TEREPHTHALI', 'PURE TEREPHTHALIC ACID') THEN 'PURE TEREPHTHALI' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('GSCI-PRECIOUS ME', 'GSCI-PRECIOUS METALS') THEN 'GSCI-PRECIOUS ME' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('ZERO PRICED EXPO', 'ZERO PRICED EXPOSURE') THEN 'ZERO PRICED EXPO' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('DJUBS-BASE METAL', 'DJUBS-BASE METALS') THEN 'DJUBS-BASE METAL' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('GAS SULFUR CREDI', 'GAS SULFUR CREDIT') THEN 'GAS SULFUR CREDI' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('GASOIL TIMESPREA', 'GASOIL TIMESPREAD') THEN 'GASOIL TIMESPREA' WHEN A.PRODUCT_SUB_TYPE_CODE IN ('USD INTEREST RAT', 'USD INTEREST RATE') THEN 'USD INTEREST RAT' WHEN a.PRODUCT_SUB_TYPE_CODE IN ('GOLD') AND a.PRODUCT_DESCRIPTION LIKE '%GLD' THEN 'GLD' WHEN a.PRODUCT_SUB_TYPE_CODE IN ('GOLD') AND a.PRODUCT_DESCRIPTION NOT LIKE '%GLD' THEN 'XAU' WHEN a.PRODUCT_SUB_TYPE_CODE IN ('SILVER') AND a.PRODUCT_DESCRIPTION LIKE '%SLV' THEN 'SLV' WHEN a.PRODUCT_SUB_TYPE_CODE IN ('SILVER') AND a.PRODUCT_DESCRIPTION NOT LIKE '%SLV' THEN 'XAG' ELSE A.PRODUCT_SUB_TYPE_CODE END AS PRODUCT_SUB_TYPE_CODE, a.TIME_BUCKET_QUARTER, a.TIME_BUCKET_CALENDAR, A.PRODUCT_TYPE_CODE, A.CMDTY_CD, sum(cast(a.USD_CM_Delta as numeric(15,5))) as Dollar_Delta, sum(cast(a.RAW_CM_DELTA as numeric(15,5))) as Raw_Delta, sum(cast(a.USD_CM_GAMMA/20 as numeric(15,5))) as Dollar_Gamma, sum(cast(a.USD_CM_KAPPA as numeric (15,5))) as Dollar_Vega, sum(cast(a.RAW_CM_KAPPA as numeric (15,5))) as Raw_Vega, sum(cast(a.USD_CM_THETA as numeric (15,5))) as Dollar_Theta, sum(cast(a.Raw_CM_THETA as numeric (15,5))) as Raw_Theta, case when A.PROD_POS_NAME_DESCRIPTION in ('GLD', 'SLV') then 'ETF' else 'Physical' end as ETF_FLAG, PROD_POS_NAME_DESCRIPTION FROM cdwuser.U_CM_MSR A WHERE ((A.CCC_DIVISION='COMMODITIES' AND A.CCC_BUSINESS_AREA in ('METALS') AND A.PRODUCT_TYPE_CODE IN ('PRECIOUSMETAL', 'FUND')) /* OLD LOGIC*/ or (A.CCC_DIVISION = 'FIXED INCOME DIVISION' AND A.CCC_BUSINESS_AREA = 'COMMODITIES' and (a.CCC_PRODUCT_LINE IN ('PRECIOUS METALS')) AND A.CCC_STRATEGY NOT IN ('MS CVA MNE - COMMOD'))/* NEW LOGIC*/ ) AND A.COB_DATE IN ('2018-02-28','2018-01-31') AND PRODUCT_TYPE_CODE NOT IN ('CURRENCY', 'INTEREST RATE', 'INFLATION', 'TBD', 'MISC','CVA', 'FVA', 'ERROR') GROUP BY A.COB_DATE, A.PRODUCT_DESCRIPTION, CASE WHEN a.CCC_BUSINESS_AREA = 'COMMODITIES' THEN a.CCC_PRODUCT_LINE ELSE a.CCC_BUSINESS_AREA END, A.PRODUCT_SUB_TYPE_CODE, A.PRODUCT_TYPE_CODE, A.CMDTY_CD, PROD_POS_NAME_DESCRIPTION,a.TIME_BUCKET_QUARTER, a.TIME_BUCKET_CALENDAR