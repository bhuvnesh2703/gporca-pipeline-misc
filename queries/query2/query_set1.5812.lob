SELECT     B.*,     CASE WHEN B.WM_BANKING_PRODUCT_SUB_GROUP IN ('Savings', 'Deposits - Spot', 'Deposits - 3M Forward', 'Deposits - Beyond 3M',                                               'GWM BDP Personal Trust', 'Brokered CD - GCM', 'Brokered CD - PBG', 'Promontory Deposits',                                               'Structured CD') THEN 'Deposits' WHEN B.WM_BANKING_PRODUCT_SUB_GROUP IN ('AFS Govt Bonds',                                                                                                                    'AFS AGN Fixed',                                                                                                                    'AFS AGN Float',                                                                                                                    'AFS Credit Fixed',                                                                                                                    'AFS Credit Float',                                                                                                                    'HTM Govt Bonds',                                                                                                                    'HTM Agency', 'Repo')          THEN 'Investment Portfolio' WHEN B.WM_BANKING_PRODUCT_SUB_GROUP IN ('IR Swap', 'Swaption', 'IR Futures', 'Option on Futures') THEN          'IR Hedges' WHEN B.WM_BANKING_PRODUCT_SUB_GROUP IN ('Mortgages (HFI)', 'Mortgages (HFS)', 'PLA', 'LAL', 'Tailored Lending') THEN          'Lending'     ELSE 'Other' END AS PRODUCT_GROUP FROM     (         SELECT             a.COB_DATE,             a.CURRENCY_OF_MEASURE,             a.ACCOUNT,             a.CCC_PRODUCT_LINE,             a.VERTICAL_SYSTEM,             a.BOOK,             c.WM_BANKING_PRODUCT_SUB_GROUP AS WM_BANKING_PRODUCT_SUB_GROUP,             (CASE WHEN A.CCC_TAPS_COMPANY = '1633' THEN 'MSBNA' WHEN A.CCC_TAPS_COMPANY = '6635' THEN 'MSPBNA' END) AS ASSET_TYPE,             a.PRODUCT_TYPE_NAME,             SUM (USD_NOTIONAL) AS USD_NOTIONAL,             SUM (USD_EXPOSURE) AS USD_EXPOSURE,             SUM (MV) AS USD_MARKET_VALUE,             SUM (USD_PV01) AS USD_PV01,             SUM (CASE WHEN (Product_Type_Code IN ('REPO') OR                             A.VERTICAL_SYSTEM LIKE '%SPG%' OR                             a.book IN ('TTSNY', 'TBSNY')) THEN USD_PV01 * - 100                  ELSE COALESCE (SLIDE_IR_MIN_100BP_USD,                                 USD_PV01 * - 100) END) AS SLIDE_IR_MIN_100BP_USD,             SUM (CASE WHEN (Product_Type_Code IN ('REPO') OR                             A.VERTICAL_SYSTEM LIKE '%SPG%' OR                             a.book IN ('TTSNY', 'TBSNY')) THEN USD_PV01 * 50                  ELSE COALESCE (SLIDE_IR_PLS_50BP_USD,                                 USD_PV01 * 50) END) AS SLIDE_IR_PLS_50BP_USD,             SUM (CASE WHEN (Product_Type_Code IN ('REPO') OR                             A.VERTICAL_SYSTEM LIKE '%SPG%' OR                             a.book IN ('TTSNY', 'TBSNY')) THEN USD_PV01 * 100                  ELSE COALESCE (SLIDE_IR_PLS_100BP_USD,                                 USD_PV01 * 100) END) AS SLIDE_IR_PLS_100BP_USD,             SUM (CASE WHEN (Product_Type_Code IN ('REPO') OR                             A.VERTICAL_SYSTEM LIKE '%SPG%' OR                             a.book IN ('TTSNY', 'TBSNY')) THEN USD_PV01 * 200                  ELSE COALESCE (SLIDE_IR_PLS_200BP_USD,                                 USD_PV01 * 200) END) AS SLIDE_IR_PLS_200BP_USD,             SUM (CASE WHEN (Product_Type_Code IN ('REPO') OR                             A.VERTICAL_SYSTEM LIKE '%SPG%' OR                             a.book IN ('TTSNY', 'TBSNY')) THEN USD_PV01 * 300                  ELSE COALESCE (SLIDE_IR_PLS_300BP_USD,                                 USD_PV01 * 300) END) AS SLIDE_IR_PLS_300BP_USD,             SUM (CASE WHEN (Product_Type_Code IN ('REPO') OR                             A.VERTICAL_SYSTEM LIKE '%SPG%' OR                             a.book IN ('TTSNY', 'TBSNY')) THEN USD_PV01 * 400                  ELSE COALESCE (SLIDE_IR_PLS_400BP_USD,                                 USD_PV01 * 400) END) AS SLIDE_IR_PLS_400BP_USD         FROM             (                 SELECT                     a.POSITION_ID,                     a.COB_DATE,                     a.ACCOUNT,                     a.CCC_PRODUCT_LINE,                     a.CCC_DIVISION,                     a.CCC_BUSINESS_AREA,                     a.VERTICAL_SYSTEM,                     a.BOOK,                     a.PRODUCT_TYPE_CODE,                     A.CCC_TAPS_COMPANY,                     a.PRODUCT_SUB_TYPE_CODE,                     a.CCC_HIERARCHY_LEVEL9,                     CCC_STRATEGY,                     a.PRODUCT_TYPE_NAME,                     a.CURRENCY_OF_MEASURE,                     SUM (COALESCE (USD_NOTIONAL,                                    0)) / 1000 AS USD_NOTIONAL,                     SUM (COALESCE (USD_EXPOSURE,                                    0)) / 1000 AS USD_EXPOSURE,                     SUM (COALESCE (a.USD_MARKET_VALUE,                                    0)) / 1000 AS MV,                     SUM (COALESCE (USD_IR_UNIFIED_PV01,                                    0)) AS USD_PV01,                     SUM (a.SLIDE_IR_PLS_100BP_USD) AS SLIDE_IR_PLS_100BP_USD,                     SUM (a.SLIDE_IR_PLS_200BP_USD) AS SLIDE_IR_PLS_200BP_USD,                     SUM (a.SLIDE_IR_PLS_300BP_USD) AS SLIDE_IR_PLS_300BP_USD,                     SUM (a.SLIDE_IR_PLS_50BP_USD) AS SLIDE_IR_PLS_50BP_USD,                     SUM (a.SLIDE_IR_MIN_100BP_USD) AS SLIDE_IR_MIN_100BP_USD,                     SUM (a.SLIDE_IR_MIN_200BP_USD) AS SLIDE_IR_MIN_200BP_USD,                     SUM (a.SLIDE_IR_MIN_300BP_USD) AS SLIDE_IR_MIN_300BP_USD,                     SUM (a.SLIDE_IR_PLS_400BP_USD) AS SLIDE_IR_PLS_400BP_USD                 FROM dwuser.U_EXP_MSR a                 WHERE COB_DATE in ('2018-02-28', '2018-01-31') AND                      A.CCC_TAPS_COMPANY IN ('1633', '6635') AND                     (A.VAR_EXCL_FL <> 'Y' OR                      A.BOOK IN ('MSDPB3M', 'MSDPT3M')) AND                     (A.ccc_banking_trading = 'BANKING' OR                      (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') OR                       a.CCC_business_area = 'US BANKS-LIQUIDITY') AND                      A.PRODUCT_TYPE_CODE = 'REPO' AND                      A.CCC_BUSINESS_AREA NOT IN ('NON CORE MARKETS', 'CORE MARKETS'))                 GROUP BY                     a.POSITION_ID,                     a.COB_DATE,                     a.ACCOUNT,                     a.CCC_PRODUCT_LINE,                     a.CCC_DIVISION,                     a.CCC_BUSINESS_AREA,                     a.VERTICAL_SYSTEM,                     a.BOOK,                     a.PRODUCT_TYPE_CODE,                     a.PRODUCT_SUB_TYPE_CODE,                     a.CCC_HIERARCHY_LEVEL9,                     CCC_STRATEGY,                     a.PRODUCT_TYPE_NAME,                     a.CURRENCY_OF_MEASURE,                     A.CCC_TAPS_COMPANY             )             A             LEFT JOIN             (                 SELECT                     DISTINCT                     b.COB_DATE,                     b.book,                     b.account,                     b.WM_BANKING_PRODUCT_GROUP,                     b.WM_BANKING_PRODUCT_SUB_GROUP                 FROM DWUSER.U_DM_WM B                 WHERE COB_DATE in ('2018-02-28', '2018-01-31') AND                      B.CCC_TAPS_COMPANY IN ('1633', '6635') AND                     (B.VAR_EXCL_FL <> 'Y' OR                      B.BOOK IN ('MSDPB3M', 'MSDPT3M')) AND                     (B.ccc_banking_trading = 'BANKING' OR                      (B.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') OR                       B.CCC_business_area = 'US BANKS-LIQUIDITY') AND                      B.PRODUCT_TYPE_CODE = 'REPO' AND                      B.CCC_BUSINESS_AREA NOT IN ('NON CORE MARKETS', 'CORE MARKETS'))             )             AS C             ON                 a.BOOK = c.book AND                 a.account = c.account AND                 a.COB_DATE = c.COB_DATE         GROUP BY             a.COB_DATE,             a.CURRENCY_OF_MEASURE,             a.ACCOUNT,             a.CCC_PRODUCT_LINE,             a.CCC_DIVISION,             a.CCC_BUSINESS_AREA,             a.VERTICAL_SYSTEM,             a.BOOK,             a.PRODUCT_TYPE_NAME,             A.CCC_TAPS_COMPANY,             CCC_HIERARCHY_LEVEL9,             CCC_STRATEGY,             c.WM_BANKING_PRODUCT_SUB_GROUP     )     AS B