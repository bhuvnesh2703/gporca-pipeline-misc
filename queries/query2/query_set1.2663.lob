with test as ( SELECT A.COB_DATE ,A.LIMIT_NAME ,A.PARENT_DESCRIPTION ,A.CHILD_DESCRIPTION ,A.LIMIT_VALUE ,A.TEMP_LIMIT_VALUE as LIMIT_VALUE_WITH_TEMP ,CASE WHEN (abs(MAX(A.RISK_VALUE_OVERRIDE)) > abs(MIN(A.RISK_VALUE_OVERRIDE))) THEN MAX(A.RISK_VALUE_OVERRIDE) ELSE MIN(A.RISK_VALUE_OVERRIDE) END AS RISK_VALUE_OVERRIDE FROM cdwuser.U_FLOW_LIMITS A WHERE A.COB_DATE in ('02/28/2018','02/27/2018') AND A.LIMIT_ID IN ( '10189' ) AND ( PARENT_DESCRIPTION LIKE '%MSCO%' ) GROUP BY A.COB_DATE ,A.LIMIT_ID ,A.LIMIT_NAME ,A.PARENT_DESCRIPTION ,A.CHILD_DESCRIPTION ,A.LIMIT_VALUE ,A.TEMP_LIMIT_VALUE ) Select A.COB_DATE ,A.LIMIT_ID ,A.LIMIT_NAME ,A.LIMIT_APPLIED_TO ,A.PARENT_DESCRIPTION ,A.CHILD_DESCRIPTION ,A.LIMIT_VALUE ,CASE WHEN (A.TEMP_LIMIT_VALUE IS NOT NULL AND A.TEMP_LIMIT_EXPIRATION_DATE > A.COB_DATE) THEN A.TEMP_LIMIT_VALUE ELSE A.LIMIT_VALUE END AS LIMIT_AMOUNT_WITH_TEMP ,A.RISK_VALUE_OVERRIDE from cdwuser.U_FLOW_LIMITS A right join (select test.COB_DATE ,test.LIMIT_NAME ,test.PARENT_DESCRIPTION ,test.CHILD_DESCRIPTION ,test.LIMIT_VALUE ,max(RISK_VALUE_OVERRIDE) as RISK_VALUE_OVERRIDE from test group by test.COB_DATE ,test.LIMIT_NAME ,test.PARENT_DESCRIPTION ,test.CHILD_DESCRIPTION ,test.LIMIT_VALUE) C on A.COB_DATE = C.COB_DATE and A.PARENT_DESCRIPTION = C.PARENT_DESCRIPTION and A.RISK_VALUE_OVERRIDE = C.RISK_VALUE_OVERRIDE