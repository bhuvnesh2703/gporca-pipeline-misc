select B.COB_DATE, B.WTIBrent, sum(B.RAW_VEGA) as RAW_VEGA From( Select A.COB_DATE, A.PROD_POS_NAME_DESCRIPTION, sum(case when PRODUCT_TYPE_CODE = 'TIMESPREAD' and PROD_POS_NAME_DESCRIPTION = 'WCS POST SPREAD' then 0 else cast(RAW_CM_KAPPA as numeric(15,5)) end) as RAW_VEGA, case when A.PROD_POS_NAME_DESCRIPTION = 'NYM WTI' then 'WTI' when A.PROD_POS_NAME_DESCRIPTION = 'BRENT' then 'Brent' else 'Other' END as WTIBrent FROM cdwuser.U_CM_MSR A WHERE A.COB_DATE >= '2017-11-30' AND ((A.CCC_BUSINESS_AREA in ('OIL LIQUIDS') AND A.CCC_DIVISION IN ('COMMODITIES')) /*OLG LOGIC*/ OR (A.CCC_DIVISION = 'FIXED INCOME DIVISION' AND A.CCC_BUSINESS_AREA = 'COMMODITIES' and a.CCC_PRODUCT_LINE IN ('OIL & PRODUCTS'))) /*NEW LOGIC*/ AND PRODUCT_TYPE_CODE NOT IN ('CURRENCY', 'INTEREST RATE', 'INFLATION', 'TBD', 'MISC','CVA', 'FVA', 'ERROR') Group By A.COB_DATE, A.PROD_POS_NAME_DESCRIPTION) b GROUP BY B.COB_DATE, B.WTIBrent