select case when rank_COB <= 50 then UNDERLIER_PRODUCT_DESCRIPTION else 'Other' end as UNDERLIER_PRODUCT_DESCRIPTION_COB, case when rank_COB <= 50 then rank_COB else 51 end as rank_COB, case when rank_CHANGE <= 50 then UNDERLIER_PRODUCT_DESCRIPTION else 'Other' end as UNDERLIER_PRODUCT_DESCRIPTION_CHANGE, case when rank_CHANGE <= 50 then rank_CHANGE else 51 end as rank_CHANGE, sum(disc_risk_cob) as disc_risk_cob, sum(disc_risk_change) as disc_risk_change from ( select UNDERLIER_PRODUCT_DESCRIPTION, sum(case when cob_date = '2018-02-28' then coalesce(USD_EQ_DISC_RISK,0) else 0 end) as disc_risk_cob, sum(case when cob_date = '2018-02-28' then coalesce(USD_EQ_DISC_RISK,0) else -coalesce(USD_EQ_DISC_RISK,0) end) as disc_risk_change, rank() over (order by abs(sum(case when cob_date = '2018-02-28' then coalesce(USD_EQ_DISC_RISK,0) else 0 end)) desc) as rank_COB, rank() over (order by abs(sum(case when cob_date = '2018-02-28' then coalesce(USD_EQ_DISC_RISK,0) else -coalesce(USD_EQ_DISC_RISK,0) end)) desc) as rank_CHANGE from cdwuser.U_EQ_MSR eq where cob_date in ('2018-02-28', '2018-02-27') and var_excl_fl <> 'Y' and parent_legal_entity = '0302(G)' and ccc_banking_trading = 'TRADING' group by UNDERLIER_PRODUCT_DESCRIPTION ) a group by case when rank_COB <= 50 then UNDERLIER_PRODUCT_DESCRIPTION else 'Other' end, case when rank_COB <= 50 then rank_COB else 51 end, case when rank_CHANGE <= 50 then UNDERLIER_PRODUCT_DESCRIPTION else 'Other' end, case when rank_CHANGE <= 50 then rank_CHANGE else 51 end