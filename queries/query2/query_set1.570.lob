SELECT cob_date, a.CCC_BUSINESS_AREA, a.CCC_PRODUCT_LINE, a.product_type_code, a.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, a.FID1_INDUSTRY_NAME_LEVEL1, SUM (a.USD_EXPOSURE) AS netexp, a.term_bucket, SUM (a.usd_pv10_BENCH) AS bpv10, SUM (a.usd_pv01sprd) AS spv01, SUM (a.USD_PV01SPRD_BENCH) AS BENCH_PV01, a.CCC_PL_REPORTING_REGION, a.fid1_seniority, a.mrd_rating, a.issuer_country_code, a.book, case when a.book in ('ABREZ', 'ABDRV', 'ABHEDG', 'ABUSF', 'ABOPN') then 'index products' when a.book in ('AAABG', 'CLNCP', 'ABANG', 'CSDSK', 'ABMGM', 'CSLT2', 'CSSBG', 'CTGOV', 'KEFRZ', '$ TIER 1 JV', 'ABNGA', 'CSLEX', 'CSNGK', 'CSNGR', 'CTLEX', 'T1UT2', 'ABLEX', 'ABPLT', 'CSBCA', 'CSREZ', 'CSALD', 'HYLEX', 'ABCSG', 'JVPNS', 'MMGOV', 'ABART', 'CSMSF', 'CSRAL', 'CSSNR', 'CSUSF', 'JVPNG', 'JVPNW', 'HYFRZ') then 'IG Fins' when a.book in ('ACTRS', 'CSDDB', 'CSSAM', 'AOFRF', 'CSPRI', 'CSAXG', 'ABSAM', 'CSAIW', 'CSCSG', 'ABMEL', 'CSMDG', 'CSMEL', 'CSAKM', 'CSAND', 'CSFOR', 'CTAND', 'GCFRZ', 'AAASG', 'AADLL', 'ABALD', 'ABPAP', 'CSARL', 'CSPUT', 'CSYPB', 'GFLEX', 'KJFRZ', 'CSANG') then 'IG Corps' when a.book in ('ABOTH', 'ABOIS', 'AADMM', 'ABCBN', 'CSCBN') then 'CC Mgmt' when a.book in ('CSYRG', 'GHYRG', 'LNPAR', 'LNRGO', 'LNSSL', 'CSYAW', 'GHYAW', 'ABDDB', 'CSYRF', 'GHYSS', 'ABUNS', 'CSANJ', 'GHYAJ', 'GHYLR', 'LNAGP', 'LNANJ', 'REALLOCATED', 'CSASG', 'CSYMW', 'CSYSS', 'EQYAW', 'GHYRF', 'LNAWA', 'LDN PAR TRADING AW-LNAWA', 'LDN PAR TRADING GHY-LNPAR', 'LDN PAR TRADING RG-LNRGO', 'LDN PAR TRADING SIDDIQUI-LNSSL') then 'High Yield' else 'Others' end as BUSINESS_GROUP, case when A.MRD_RATING not IN ('AAA', 'AA', 'A', 'BBB')then 'High Yield' when a.MRD_RATING in ('A', 'AA', 'AAA', 'BBB') then 'IG Trading' else 'Others' end as Product_line2, case when (a.GICS_LEVEL_1_NAME = 'FINANCIALS' OR (a.GICS_LEVEL_1_NAME IS NULL AND a.FID1_INDUSTRY_NAME_LEVEL1='CORPORATES: FINANCIALS')) then 'Financials' else 'Non-Financials' end as Industry_name2, case when a.PRODUCT_TYPE_CODE in ('BANKDEBT', 'BOND', 'GVTBOND') then 'Cash' when a.PRODUCT_TYPE_CODE in ('CRDBSKT', 'CRDINDEX') then 'Index' when a.PRODUCT_TYPE_CODE in ('DEFSWAP', 'LOANCDS') then 'CDS' else 'Others' end as Product_type2, case when a.MRD_RATING in ('A', 'AA', 'AAA', 'BBB') then 'IG' else 'NIG' end as Product_rating, case when a.TERM_BUCKET in ('0-0.25Y', '0.25-0.5Y', '0.5-1Y', '1-2Y', '2-5Y') then '<5Y' when a.TERM_BUCKET in ('5-7Y', '7-8Y', '8-10Y', '10-12Y', '12-15Y') then '5-15Y' else '>15Y' end as Maturity_bucket FROM cdwuser.u_cr_msr a WHERE a.COB_DATE in ('2018-02-28','2018-02-21','2017-12-29','2017-09-29','2017-06-30') AND A.CCC_PL_REPORTING_REGION = 'EMEA' AND ((a.CCC_BUSINESS_AREA = 'CREDIT-CORPORATES' AND a.FID1_SENIORITY not in ('AT1','SUBT1','SUBUT2') and A.CCC_PRODUCT_LINE not in ('DISTRESSED TRADING', 'PRIMARY - LOANS', 'PAR LOANS TRADING')) OR (A.CCC_Product_line = 'DISTRESSED TRADING' AND a.Product_type_code = 'CRDINDEX')) and a.issuer_country_code in ('PRT','ITA','IRL','GRC','ESP') GROUP BY a.cob_date, a.CCC_BUSINESS_AREA, a.CCC_PRODUCT_LINE, a.product_type_code, a.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, a.FID1_INDUSTRY_NAME_LEVEL1, case when (a.GICS_LEVEL_1_NAME = 'FINANCIALS' OR (a.GICS_LEVEL_1_NAME IS NULL AND a.FID1_INDUSTRY_NAME_LEVEL1='CORPORATES: FINANCIALS')) then 'Financials' else 'Non-Financials' end, a.term_bucket, a.CCC_PL_REPORTING_REGION, a.fid1_seniority, a.issuer_country_code, a.BOOK, A.MRD_RATING