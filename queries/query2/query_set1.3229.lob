With x as ( SELECT CAST(RANK () OVER (ORDER BY SUM (ABS (vega)) desc ) || '.' || 'UK Group ALL' as VARCHAR(50)) as RankUKALL, Underlier, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_PARTIAL_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) t GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), x2 as ( SELECT CAST(RANK () OVER (ORDER BY SUM (ABS (vega)) desc ) || '.' || 'UK Group ALL Prev. CoB' as VARCHAR(50)) as RankUKALL, Underlier, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_PARTIAL_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-21' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) t GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), y as ( SELECT CAST('x.UK Group EMEA' as VARCHAR(50)) as RankUKEMEA, CAST('UK Group EMEA' || '.' || Underlier as VARCHAR(50)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_PARTIAL_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_PL_REPORTING_REGION = 'EMEA' AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) t GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), z as ( SELECT CAST('x.UK Group ASIA' AS VARCHAR(50)) as RankUKASIA, CAST('UK Group ASIA' || '.' || Underlier AS VARCHAR(50)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_PARTIAL_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_PL_REPORTING_REGION IN ('ASIA PACIFIC','JAPAN') AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) t GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), w as ( SELECT CAST('x.UK Group AMERICAS' AS VARCHAR(50)) as RankUKAMERICAS, CAST('UK Group AMERICAS' || '.' || Underlier AS VARCHAR(50)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_PARTIAL_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_PL_REPORTING_REGION IN ('AMERICAS') AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) t GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), j as ( SELECT CAST('x.UK Group OTHERS' AS VARCHAR(50)) as RankUKOTHERS, CAST('UK Group OTHERS' || '.' || Underlier AS VARCHAR(50)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_PARTIAL_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.LE_GROUP = 'UK' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_PL_REPORTING_REGION NOT IN ('EMEA', 'ASIA PACIFIC','JAPAN','AMERICAS') AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) t GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ), k as ( SELECT CAST('x.EMEA' AS VARCHAR(50)) as RankEMEA, CAST('EMEA' || '.' || Underlier AS VARCHAR(50)) as UNDERLIER, SUM (ABS (vega)) AS Grossvega, Vega FROM ( SELECT UNDERLIER_TICK || '.' || UNDERLIER_EXCH AS Underlier, SUM (COALESCE (a.USD_EQ_PARTIAL_KAPPA, 0))/1000 AS vega FROM CDWUSER.U_EQ_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.EXECUTIVE_MODEL IN ('VARIANCESWAP', 'CAPPEDVARIANCESWAP', 'VOLATILITYSWAP', 'CAPPEDVOLATILITYSWAP') AND a.CCC_PL_REPORTING_REGION IN ('EMEA') AND UNDERLIER_TICK || '.' || UNDERLIER_EXCH IN (SELECT UNDERLIER FROM x) GROUP BY UNDERLIER_TICK || '.' || UNDERLIER_EXCH ) t GROUP BY Underlier, Vega ORDER BY sum(ABS(vega)) desc FETCH FIRST 10 ROWS ONLY ) SELECT * FROM x UNION ALL SELECT * FROM x2 UNION ALL SELECT * FROM y UNION ALL SELECT * FROM z UNION ALL SELECT * FROM w UNION ALL SELECT * FROM j UNION ALL SELECT * FROM k