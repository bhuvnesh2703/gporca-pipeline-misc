SELECT COB_DATE, PWR_PLANT, SUM(DOLLAR_GREEK) as DOLLAR_GREEK From( SELECT COB_DATE, USD_CM_Delta as dollar_greek, product_type_code, CCC_TRD_BOOK, case when CCC_TRD_BOOK in ('BERKEL', 'EU CC BERKEL') then 'Berkel' || ' (ndl)' when CCC_TRD_BOOK in ('STORA', 'CC_STORA') then 'Stora' || ' (ndl)' when CCC_TRD_BOOK in ('COGEN PRAT', 'EU CC COGEN PRAT') then 'Cogen Prat' || ' (esp)' when CCC_TRD_BOOK in ('DALKIA', 'EU CC DALKIA') then 'Dalkia' || ' (fra)' when CCC_TRD_BOOK in ('VELTHEIM', 'VELTHEIM') then 'Veltheim' || ' (ger)' else CCC_TRD_BOOK end as pwr_plant FROM cdwuser.U_CM_MSR Where COB_DATE IN ('2018-02-28','2018-02-27') AND ((CCC_DIVISION='COMMODITIES' AND CCC_BUSINESS_AREA not in ('CREDIT','MS CVA MNE - COMMOD', 'COMMODS FINANCING','INVESTMENTS AND STR TRANS','INVESTOR BUSINESS')) OR(CCC_DIVISION = 'FIXED INCOME DIVISION' AND CCC_BUSINESS_AREA = 'COMMODITIES' AND CCC_PRODUCT_LINE NOT IN ('COMMOD LENDING', 'COMMOD EXOTICS', 'COMMOD INDEX') AND CCC_STRATEGY NOT IN ('MS CVA MNE - COMMOD', 'CMD LEGACY LAONS & CLAIMS', 'CVA RISK MANAGEMENT', 'FVA RISK MANAGEMENT', 'FUNDING COLLATERAL COMM'))) /* NEW LOGIC*/ AND CCC_TRD_BOOK <> 'DEVELOPMENT' AND product_type_code='EURO PWR' and (CCC_PRODUCT_LINE='CROSS COMMODITIES SPREADS' OR UPPER(CCC_STRATEGY) ='CROSS COMMODITIES SPREADS') )abc GROUP BY COB_DATE, PWR_PLANT FOR READ ONLY