SELECT CASE WHEN (PRODUCT_TYPE_CODE IN ('AGN','BOND') AND PRODUCT_HIERARCHY_LEVEL7 IN ('COVERED BOND-OTHER','JUMBO PFANDBRIEFE','PFANDBRIEFE','HYPOTHEKEN PFANDBRIEFE','UNKNOWN')) THEN 'CoveredB' ELSE 'NNCovered' END AS coveredbflag, 'Treasuries' AS TRvsSWAP, CASE WHEN a.ISSUER_COUNTRY_CODE IN ('XS','VGB','USA','SWE','PRT','NZL','NOR','NLD','LUX','JPN','JEY','ITA','ISL','IRL','IRL','IMN','GRC','GGY','GBR','FRA','FIN','ESP','DNK','DEU','CYP','CYM','CHE','CAN','BMU','BEL','AUT','AUS') THEN 'G10' ELSE 'EM' END AS EMFLAG, CASE WHEN a.ISSUER_COUNTRY_CODE IN ('ITA','ESP','PRT','FRA','NLD','BEL','DEU') THEN ISSUER_COUNTRY_CODE WHEN a.ISSUER_COUNTRY_CODE IN ('IRL','GRC') THEN 'Other Periphery' ELSE 'Other' END AS COUNTRY_CD_OF_RISK, SUM (CASE WHEN FID1_SENIORITY IN ('AT1', 'SUBT1', 'SUBUT2') THEN 0 WHEN ccc_strategy = 'DISTRESSED TRADING1' then 0 ELSE USD_PV10_BENCH END) AS USD_PV10_BENCH, SUM (CASE WHEN ( (PRODUCT_TYPE_CODE IN ('CAP', 'FLOOR', 'SWAP', 'ZCS') AND CURVE_TYPE NOT IN ('GovtYieldCurve')) OR (VERTICAL_SYSTEM LIKE '%SPG%' AND IS_CASH_FL = 'Y') OR PRODUCT_TYPE_CODE IN ('CDO2', 'CDSOPTIDX', 'CLNBSKT', 'CLNCDO2', 'CP', 'CRDBSKT', 'CRDINDEX', 'DEFSWAP', 'FRN', 'LOANCDS', 'LOANDGDS', 'LOANINDEX', 'NTDCDO')) THEN USD_PV01SPRD ELSE 0 END) AS USD_PV01SPRD, SUM (CASE WHEN ((PRODUCT_TYPE_CODE IN ('CAP', 'FLOOR', 'SWAP', 'ZCS') AND CURVE_TYPE = 'GovtYieldCurve') OR PRODUCT_TYPE_CODE IN ('AGN', 'BOND', 'BONDFUT', 'BONDFUTOPT', 'BONFUTOPT', 'GOVTBONDOPT', 'GOVTBONDOPTIL', 'GVTBOND', 'GVTBONDIL', 'GVTFRN', 'TRRSWAP', 'TRS - GVTBOND', 'TRS - GVTBONDIL')) THEN USD_IR_UNIFIED_PV01 ELSE 0 END) AS usd_pv01, SUM (USD_EXPOSURE) AS USD_EXPOSURE FROM cdwuser.U_EXP_MSR a WHERE a.cob_date IN ('2018-02-28') AND LE_GROUP = 'UK' AND (CCC_PRODUCT_LINE IN ('AGENCIES TRADING','EU GOVERNMENTS','NA GOVERNMENTS')) AND CCC_DIVISION NOT IN ('FID DVA','FIC DVA') AND CCC_STRATEGY NOT IN ('MS DVA STR NOTES IED') GROUP BY CASE WHEN (PRODUCT_TYPE_CODE IN ('AGN','BOND') AND PRODUCT_HIERARCHY_LEVEL7 IN ('COVERED BOND-OTHER','JUMBO PFANDBRIEFE','PFANDBRIEFE','HYPOTHEKEN PFANDBRIEFE','UNKNOWN')) THEN 'CoveredB' ELSE 'NNCovered' END, TRvsSWAP, CASE WHEN a.ISSUER_COUNTRY_CODE IN ('XS','VGB','USA','SWE','PRT','NZL','NOR','NLD','LUX','JPN','JEY','ITA','ISL','IRL','IRL','IMN','GRC','GGY','GBR','FRA','FIN','ESP','DNK','DEU','CYP','CYM','CHE','CAN','BMU','BEL','AUT','AUS') THEN 'G10' ELSE 'EM' END, CASE WHEN a.ISSUER_COUNTRY_CODE IN ('ITA','ESP','PRT','FRA','NLD','BEL','DEU') THEN ISSUER_COUNTRY_CODE WHEN a.ISSUER_COUNTRY_CODE IN ('IRL','GRC') THEN 'Other Periphery' ELSE 'Other' END ORDER BY coveredbflag DESC, country_cd_of_risk