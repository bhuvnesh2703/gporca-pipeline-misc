SELECT a.COB_DATE, a.CCC_RISK_MANAGER_LOGIN, a.CUSIP, CASE WHEN (a.UNDERLIER_TICK = 'spy' AND a.EXPIRATION_DATE <= '2018-2-28' AND a.EXPIRATION_DATE >= '2018-2-16' AND a.STRIKE <= a.UNDERLIER_PRICE AND substr(a.SECURITY_DESCRIPTION, length(a.SECURITY_DESCRIPTION)+1-1)='C' AND a.EXECUTIVE_MODEL = 'AMERICAN-OPTION' AND a.trade_size>0) THEN 'Early Exercise Long' WHEN (a.UNDERLIER_TICK = 'spy' AND a.EXPIRATION_DATE <= '2018-2-28' AND a.EXPIRATION_DATE >= '2018-2-16' AND a.STRIKE <= a.UNDERLIER_PRICE AND substr(a.SECURITY_DESCRIPTION, length(a.SECURITY_DESCRIPTION)+1-1)='C' AND a.EXECUTIVE_MODEL = 'AMERICAN-OPTION' AND a.trade_size<0 AND a.EXCH = 'OTC') THEN 'Early Exercise Short OTC' WHEN (a.UNDERLIER_TICK = 'spy' AND a.EXPIRATION_DATE <= '2018-2-28' AND a.EXPIRATION_DATE >= '2018-2-16' AND a.STRIKE <= a.UNDERLIER_PRICE AND substr(a.SECURITY_DESCRIPTION, length(a.SECURITY_DESCRIPTION)+1-1)='C' AND a.EXECUTIVE_MODEL = 'AMERICAN-OPTION' AND a.trade_size<0) THEN 'Early Exercise Short Listed' WHEN (a.UNDERLIER_TICK IN ('spy', 'spx') AND a.EXPIRATION_DATE = '2018-2-16') THEN 'Other S&P Expiring Tom' WHEN a.UNDERLIER_TICK IN ('spy', 'spx') THEN 'Other S&P' ELSE 'Other' END AS TYPE_FLAG, SUM(a.SLIDE_MIN_05_USD +a.USD_DELTA*.05)/1000 AS D05_Adj, SUM(a.SLIDE_MIN_10_USD +a.USD_DELTA*.1)/1000 AS D10_Adj, SUM(a.SLIDE_MIN_20_USD +a.USD_DELTA*.2)/1000 AS D20_Adj, SUM(a.SLIDE_MIN_30_USD +a.USD_DELTA*.3)/1000 AS D30_Adj FROM CDWUSER.U_IED_VIEW a WHERE a.COB_DATE IN ('2018-2-28') AND a.CCC_DIVISION = 'INSTITUTIONAL EQUITY DIVISION' AND a.CCC_BANKING_TRADING = 'TRADING' AND a.ccc_PL_REPORTING_REGION IN ('AMERICAS') AND a.UNDERLIER_TICK = 'spy' AND a.EXPIRATION_DATE <= '2018-2-28' AND a.EXPIRATION_DATE >= '2018-2-16' AND a.STRIKE <=a.UNDERLIER_PRICE AND substr(a.SECURITY_DESCRIPTION, length(a.SECURITY_DESCRIPTION)+1-1)='C' AND a.EXECUTIVE_MODEL = 'AMERICAN-OPTION' AND a.SLIDE_MIN_10_USD IS NOT NULL AND NOT a.EXCH = 'OTC' AND a.CCC_BUSINESS_AREA = 'DERIVATIVES' GROUP BY a.COB_DATE, a.CCC_RISK_MANAGER_LOGIN, a.CUSIP, CASE WHEN (a.UNDERLIER_TICK = 'spy' AND a.EXPIRATION_DATE <= '2018-2-28' AND a.EXPIRATION_DATE >= '2018-2-16' AND a.STRIKE <= a.UNDERLIER_PRICE AND substr(a.SECURITY_DESCRIPTION, length(a.SECURITY_DESCRIPTION)+1-1)='C' AND a.EXECUTIVE_MODEL = 'AMERICAN-OPTION' AND a.trade_size>0) THEN 'Early Exercise Long' WHEN (a.UNDERLIER_TICK = 'spy' AND a.EXPIRATION_DATE <= '2018-2-28' AND a.EXPIRATION_DATE >= '2018-2-16' AND a.STRIKE <= a.UNDERLIER_PRICE AND substr(a.SECURITY_DESCRIPTION, length(a.SECURITY_DESCRIPTION)+1-1)='C' AND a.EXECUTIVE_MODEL = 'AMERICAN-OPTION' AND a.trade_size<0 AND a.EXCH = 'OTC') THEN 'Early Exercise Short OTC' WHEN (a.UNDERLIER_TICK = 'spy' AND a.EXPIRATION_DATE <= '2018-2-28' AND a.EXPIRATION_DATE >= '2018-2-16' AND a.STRIKE <= a.UNDERLIER_PRICE AND substr(a.SECURITY_DESCRIPTION, length(a.SECURITY_DESCRIPTION)+1-1)='C' AND a.EXECUTIVE_MODEL = 'AMERICAN-OPTION' AND a.trade_size<0) THEN 'Early Exercise Short Listed' WHEN (a.UNDERLIER_TICK IN ('spy', 'spx') AND a.EXPIRATION_DATE = '2018-2-16') THEN 'Other S&P Expiring Tom' WHEN a.UNDERLIER_TICK IN ('spy', 'spx') THEN 'Other S&P' ELSE 'Other' END