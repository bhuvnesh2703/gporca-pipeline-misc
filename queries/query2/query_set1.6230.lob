SELECT B.COB_DATE, B.CURRENCY_OF_MEASURE, SUM(B.USD_FX) AS DELTA FROM ( SELECT COB_DATE, A.CCC_DIVISION, A.CURRENCY_OF_MEASURE, CASE WHEN A.PRODUCT_TYPE_CODE IN ('CAP', 'FLOOR', 'SWAPTION') THEN 'OPTION' ELSE A.PRODUCT_TYPE_CODE END AS PRODUCT_TYPE_CODE, QIS_RUN_TYPE, BU_RISK_SYSTEM, sum(COALESCE(USD_FX, 0)) AS USD_FX FROM DWUSER.U_QIS_EXP_MSR a WHERE cob_date >= '11/30/2017' AND cob_date <= '02/28/2018' AND QIS_RUN_TYPE = 'MEXICO_LOCALVAR' GROUP BY PRODUCT_TYPE_CODE, A.CURRENCY_OF_MEASURE, A.CCC_DIVISION, COB_DATE, QIS_RUN_TYPE, BU_RISK_SYSTEM ) B WHERE B.CURRENCY_OF_MEASURE IN ('USD','MXN') GROUP BY B.COB_DATE, B.CURRENCY_OF_MEASURE