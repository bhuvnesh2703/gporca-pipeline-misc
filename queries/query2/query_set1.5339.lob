SELECT a.COB_DATE, a.SPG_DESC, a.SPG_DESC_GROUP, a.SPG_PRODUCT_TYPE, a.SPG_PRODUCT_TYPE_GROUP, CASE WHEN a.SPG_DESC = 'CORPORATE INDEX' THEN a.TICKET ELSE a.TAPSCUSIP END AS TAPSCUSIP, a.INSURER_RATING, a.DETACHMENT, CASE WHEN (NOT (a.DETACHMENT >= 1) AND a.INSURER_RATING NOT IN ('AAA', 'AJ', 'AM', 'PENAAA')) THEN 'Mezz' ELSE 'Senior' END AS SENIOR_MEZZ_FLAG, CASE WHEN NOT (a.DETACHMENT >= 1) AND a.INSURER_RATING NOT IN ('AAA', 'AJ', 'AM', 'PENAAA') AND a.SPG_PRODUCT_TYPE IN ('RESI- NON AGENCY ALT A SINGLE NAME', 'SUBPRIME CDO', 'SUBPRIME SINGLE NAME') THEN 'Non-Conforming' WHEN a.INSURER_RATING NOT IN ('AAA', 'AJ', 'AM', 'PENAAA') AND a.SPG_PRODUCT_TYPE IN ('CORPORATE CDO') THEN 'CDO' END AS FLOW_LIMITS, CASE WHEN a.SPG_DESC = 'CORPORATE INDEX' THEN a.REFERENCE_INDEX_ENTITY_NAME ELSE a.PRODUCT_DESCRIPTION END AS PRODUCT_DESCRIPTION, CASE WHEN a.SPG_DESC_GROUP = 'CORPORATE INDEX' THEN SUM (COALESCE (a.USD_EXPOSURE_COMP, 0)) / 1000 ELSE SUM (COALESCE (a.USD_EXPOSURE, 0)) / 1000 END AS USD_EXPOSURE FROM CDWUSER.U_EXP_MSR a WHERE a.COB_DATE = '2018-02-28' AND a.CCC_PRODUCT_LINE = 'EUROPEAN SPG' AND (ABS (a.USD_EXPOSURE) > 0.01 OR ABS (a.USD_EXPOSURE_COMP) > 0.01) GROUP BY a.COB_DATE, a.SPG_DESC, a.SPG_DESC_GROUP, a.SPG_PRODUCT_TYPE, a.SPG_PRODUCT_TYPE_GROUP, CASE WHEN a.SPG_DESC = 'CORPORATE INDEX' THEN a.TICKET ELSE a.TAPSCUSIP END, a.INSURER_RATING, a.DETACHMENT, CASE WHEN a.SPG_DESC = 'CORPORATE INDEX' THEN a.REFERENCE_INDEX_ENTITY_NAME ELSE a.PRODUCT_DESCRIPTION END, a.MARK_OF_POSITION, CASE WHEN (NOT (a.DETACHMENT >= 1) AND a.INSURER_RATING NOT IN ('AAA', 'AJ', 'AM', 'PENAAA')) THEN 'Mezz' ELSE 'Senior' END, CASE WHEN NOT (a.DETACHMENT >= 1) AND a.INSURER_RATING NOT IN ('AAA', 'AJ', 'AM', 'PENAAA') AND a.SPG_PRODUCT_TYPE IN ('RESI- NON AGENCY ALT A SINGLE NAME', 'SUBPRIME CDO', 'SUBPRIME SINGLE NAME') THEN 'Non-Conforming' WHEN a.INSURER_RATING NOT IN ('AAA', 'AJ', 'AM', 'PENAAA') AND a.SPG_PRODUCT_TYPE IN ('CORPORATE CDO') THEN 'CDO' END