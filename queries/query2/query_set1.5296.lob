SELECT cob_date, sum(case when CCC_STRATEGY = 'HFI HEDGES' then usd_posn end) as HFI_HEDGE_NOTIONAL, sum(case when category = 'LIMIT' then usd_posn / 2 end) as Limit, sum(case when PRODUCT_TYPE_CODE IN ('BONDFUT', 'RATEFUT') AND CCC_STRATEGY = 'HFI HEDGES' then usd_posn end) as Treasury_Bond_Futures, sum(case when PRODUCT_TYPE_CODE IN ('CAP', 'FLOOR', 'SWAPTION', 'BONDFUTOPT', 'RATEFUTOPT') AND CCC_STRATEGY = 'HFI HEDGES' then usd_posn end) as Option_Products, sum(case when PRODUCT_TYPE_CODE IN ('SWAP', 'BONDFUT', 'RATEFUT') AND CCC_STRATEGY = 'HFI HEDGES' then usd_posn end) as Linear_Products FROM ( SELECT cob_date, case when CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' THEN 'LIMIT' when PRODUCT_TYPE_CODE = 'SWAPTION' then'SWAPTION' when book = 'PBSWA' then 'SWAP' end as category, PRODUCT_TYPE_CODE, CCC_STRATEGY, sum((usd_notional) :: numeric(15,5)) AS usd_posn FROM CDWUSER.U_DM_WM WHERE cob_date = '2018-02-28' and (CCC_DIVISION IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH') or WM_BANKING_PRODUCT_SUB_GROUP in ('Cash')) AND var_excl_fl <> 'Y' AND ccc_banking_trading = 'BANKING' GROUP BY cob_date, case when CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' THEN 'LIMIT' when PRODUCT_TYPE_CODE = 'SWAPTION' then'SWAPTION' when book = 'PBSWA' then 'SWAP' end, PRODUCT_TYPE_CODE, CCC_STRATEGY ) A GROUP BY cob_date