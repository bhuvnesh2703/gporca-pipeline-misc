SELECT a.ATTRIBUTE9 AS "Risk metric", a.ATTRIBUTE10 AS "Unit", SUM(a.VALUE1)/1000 AS "Current (ISG)", coalesce(prior_risk_all,0) AS "Prior (ISG)", (SUM(a.VALUE1)/1000 - coalesce(prior_risk_all,0)) AS "Change (ISG)", coalesce(current_risk_fid,0) AS "Current (FID)", coalesce(prior_risk_fid,0) AS "Prior (FID)", (coalesce(current_risk_fid,0) - coalesce(prior_risk_fid,0)) AS "Change (FID)", (SUM(a.VALUE1)/1000 - coalesce(current_risk_fid,0)) AS "Current (Others)", (coalesce(prior_risk_all,0) - coalesce(prior_risk_fid,0)) AS "Prior (Others)", (SUM(a.VALUE1)/1000 - coalesce(current_risk_fid,0)) - (coalesce(prior_risk_all,0) - coalesce(prior_risk_fid,0)) AS "Change (Others)" from CDWUSER.U_GENERIC_DATA a LEFT JOIN (SELECT ATTRIBUTE9, ATTRIBUTE10, SUM(VALUE1)/1000 AS prior_risk_fid from CDWUSER.U_GENERIC_DATA where cob_date IN ('2018-01-19') and analytic_group = 'FDSF' and analytics = 'SENSITIVITIES' and ATTRIBUTE3 IN ('FIXED INCOME DIVISION') and ATTRIBUTE1 IN ('IR') group by ATTRIBUTE9,ATTRIBUTE10) b ON (a.ATTRIBUTE9=b.ATTRIBUTE9 AND a.ATTRIBUTE10=b.ATTRIBUTE10) LEFT JOIN (SELECT ATTRIBUTE9, ATTRIBUTE10, SUM(VALUE1)/1000 AS current_risk_fid from CDWUSER.U_GENERIC_DATA where cob_date IN ('2018-02-16') and analytic_group = 'FDSF' and analytics = 'SENSITIVITIES' and ATTRIBUTE3 IN ('FIXED INCOME DIVISION') and ATTRIBUTE1 IN ('IR') group by ATTRIBUTE9,ATTRIBUTE10) c on (a.ATTRIBUTE9=c.ATTRIBUTE9 AND a.ATTRIBUTE10=c.ATTRIBUTE10) LEFT JOIN (SELECT ATTRIBUTE9, ATTRIBUTE10, SUM(VALUE1)/1000 AS prior_risk_all from CDWUSER.U_GENERIC_DATA where cob_date IN ('2018-01-19') and analytic_group = 'FDSF' and analytics = 'SENSITIVITIES' and ATTRIBUTE1 IN ('IR') group by ATTRIBUTE9,ATTRIBUTE10) d on (c.ATTRIBUTE9=d.ATTRIBUTE9 AND c.ATTRIBUTE10=d.ATTRIBUTE10) where cob_date IN ('2018-02-16') and analytic_group = 'FDSF' and analytics = 'SENSITIVITIES' and a.ATTRIBUTE1 IN ('IR') group by a.ATTRIBUTE9,a.ATTRIBUTE10, current_risk_fid, prior_risk_fid, prior_risk_all order by a.ATTRIBUTE9 desc