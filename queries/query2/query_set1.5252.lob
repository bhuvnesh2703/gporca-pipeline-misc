select a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, CASE WHEN (A.CCC_PRODUCT_LINE IN ('COMMOD LENDING', 'CRA INVESTMENTS') or WM_BANKING_PRODUCT_SUB_GROUP IN ('Relationship Loans', 'Relationship Hedges', 'SPG CRE Loans', 'SPG CRE Hedges', 'Event Loans', 'Other ISG Loans','SPG Warehouse','RESI WL'))THEN 'ISG LOANS' WHEN A.BOOK IN ('PBCDB') THEN 'Other Liabilities' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') or a.WM_BANKING_PRODUCT_GROUP IN ('Liquidity') Then ('Liquidity') WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' WHEN WM_BANKING_PRODUCT_SUB_GROUP IN ('Brokered CD - GCM', 'Brokered CD - PBG', 'Global Currency', 'Other Liabilities', 'Promontory Deposits', 'Parent Deposits at FRB', 'Structured CD', 'Brokered CD', 'FHLB Program') THEN 'Other Liabilities' WHEN WM_BANKING_PRODUCT_SUB_GROUP IN ('Mortgages (HFI)', 'PLA','Tailored Lending', 'Mortgages (HFS)', 'Swaption', 'IR Futures', 'Option on Futures') OR BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'BANK LENDING' ELSE a.WM_BANKING_PRODUCT_GROUP END AS WM_BANKING_PRODUCT_GROUP, Case WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN A.CCC_PRODUCT_LINE IN ('COMMOD LENDING', 'CRA INVESTMENTS') THEN 'Other ISG Loans' WHEN CCC_PRODUCT_LINE = 'RELATIONSHIP LENDING' AND BOOK in ('BLNUT', 'BNYUT', 'HFIEB', 'HFINB', 'BYNUU') then 'Relationship Hedges' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') then 'Repo' WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' WHEN BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'LAL' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END AS WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME, a.PRODUCT_SUB_TYPE_CODE, sum(USD_NOTIONAL) AS USD_NOTIONAL, sum(USD_EXPOSURE) AS USD_EXPOSURE, sum(MV) AS MV, SUM(USD_PV01SPRD) AS USD_PV01SPRD, SUM(USD_PV01) AS USD_PV01, SUM(USD_IR_KAPPA) AS USD_IR_KAPPA, SUM(USD_CONVX) AS USD_CONVX, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * - 100 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) ELSE COALESCE(SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) END) AS SLIDE_IR_MIN_100BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 50 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_50BP_USD, USD_PV01 * 50) ELSE COALESCE(SLIDE_IR_PLS_50BP_USD, USD_PV01 * 50) END) AS SLIDE_IR_PLS_50BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * -50 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_MIN_50BP_USD, USD_PV01 * -50) ELSE COALESCE(SLIDE_IR_MIN_50BP_USD, USD_PV01 * -50) END) AS SLIDE_IR_MIN_50BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * -25 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_MIN_25BP_USD, USD_PV01 * -25) ELSE COALESCE(SLIDE_IR_MIN_25BP_USD, USD_PV01 * -25) END) AS SLIDE_IR_MIN_25BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 25 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_25BP_USD, USD_PV01 * 25) ELSE COALESCE(SLIDE_IR_PLS_25BP_USD, USD_PV01 * 25) END) AS SLIDE_IR_PLS_25BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 100 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_100BP_USD, USD_PV01 * 100) ELSE COALESCE(SLIDE_IR_PLS_100BP_USD, USD_PV01 * 100) END) AS SLIDE_IR_PLS_100BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 200 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_200BP_USD, USD_PV01 * 200) ELSE COALESCE(SLIDE_IR_PLS_200BP_USD,USD_PV01 * 200) END) AS SLIDE_IR_PLS_200BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 300 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_300BP_USD, USD_PV01 * 300) ELSE COALESCE(SLIDE_IR_PLS_300BP_USD, USD_PV01 * 300) END) AS SLIDE_IR_PLS_300BP_USD, SUM (USD_FX) AS USD_FX, sum(USD_FX_KAPPA) AS USD_VEGA from ( select a.POSITION_ID, a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME, SUM(COALESCE((USD_NOTIONAL) :: numeric(15,5),0))/1000 as USD_NOTIONAL, sum(COALESCE((USD_EXPOSURE) :: numeric(15,5), 0)) / 1000 AS USD_EXPOSURE, sum(COALESCE((USD_PROCEED) :: numeric(15,5), 0)) / 1000 AS MV, SUM(COALESCE((USD_PV01SPRD) :: numeric(15,5),0))/1000 AS USD_PV01SPRD, SUM(COALESCE((USD_IR_KAPPA) :: numeric(15,5), 0)/10) AS USD_IR_KAPPA, SUM(COALESCE((USD_CONVX) :: numeric(15,5), 0)/10) AS USD_CONVX, SUM(COALESCE((USD_IR_UNIFIED_PV01) :: numeric(15,5), 0)) AS USD_PV01, SUM ((a.SLIDE_IR_PLS_100BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_100BP_USD, SUM ((a.SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_200BP_USD, SUM ((a.SLIDE_IR_PLS_300BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_300BP_USD, SUM ((a.SLIDE_IR_PLS_50BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_50BP_USD, SUM ((a.SLIDE_IR_MIN_50BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_50BP_USD, SUM ((a.SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_100BP_USD, SUM ((a.SLIDE_IR_MIN_200BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_200BP_USD, SUM ((a.SLIDE_IR_MIN_300BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_300BP_USD, SUM(COALESCE((USD_FX) :: numeric(15,5), 0)) AS USD_FX, SUM(COALESCE((USD_FX_KAPPA) :: numeric(15,5), 0)) AS USD_FX_KAPPA, SUM ((a.SLIDE_IR_MIN_25BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_25BP_USD, SUM ((a.SLIDE_IR_PLS_25BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_25BP_USD from cdwuser.u_dm_wm_position a WHERE A.COB_DATE in ( '2018-02-28', '2018-01-31', '2017-12-29', '2017-11-30', '2015-12-31' ) AND A.CCC_TAPS_COMPANY = '1633' AND (A.VAR_EXCL_FL<> 'Y' OR A.BOOK IN ('MSDPB3M','MSDPT3M')) AND (A.ccc_banking_trading = 'BANKING' OR (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') or a.CCC_business_area = 'US BANKS-LIQUIDITY' ) AND A.PRODUCT_TYPE_CODE ='REPO' AND A.CCC_BUSINESS_AREA NOT IN ('NON CORE MARKETS','CORE MARKETS')) and a.book not in ('MS DVA STR NOTES IED NAM ADRIENS', 'MS DVA STR NOTES IED NAM CHAKOSPE') and a.account not in ('070002FK') group by a.POSITION_ID, a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME ) A GROUP BY a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, CASE WHEN (A.CCC_PRODUCT_LINE IN ('COMMOD LENDING', 'CRA INVESTMENTS') or WM_BANKING_PRODUCT_SUB_GROUP IN ('Relationship Loans', 'Relationship Hedges', 'SPG CRE Loans', 'SPG CRE Hedges', 'Event Loans', 'Other ISG Loans','SPG Warehouse','RESI WL'))THEN 'ISG LOANS' WHEN A.BOOK IN ('PBCDB') THEN 'Other Liabilities' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') or a.WM_BANKING_PRODUCT_GROUP IN ('Liquidity') Then ('Liquidity') WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' WHEN WM_BANKING_PRODUCT_SUB_GROUP IN ('Brokered CD - GCM', 'Brokered CD - PBG', 'Global Currency', 'Other Liabilities', 'Promontory Deposits', 'Parent Deposits at FRB', 'Structured CD', 'Brokered CD', 'FHLB Program') THEN 'Other Liabilities' WHEN WM_BANKING_PRODUCT_SUB_GROUP IN ('Mortgages (HFI)', 'PLA','Tailored Lending', 'Mortgages (HFS)', 'Swaption', 'IR Futures', 'Option on Futures') OR BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'BANK LENDING' ELSE a.WM_BANKING_PRODUCT_GROUP END, Case WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN A.CCC_PRODUCT_LINE IN ('COMMOD LENDING', 'CRA INVESTMENTS') THEN 'Other ISG Loans' WHEN CCC_PRODUCT_LINE = 'RELATIONSHIP LENDING' AND BOOK in ('BLNUT', 'BNYUT', 'HFIEB', 'HFINB', 'BYNUU') then 'Relationship Hedges' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') then 'Repo' WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' WHEN BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'LAL' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END, a.PRODUCT_TYPE_NAME, a.PRODUCT_SUB_TYPE_CODE, a.BANKING_PRODUCT_DESCRIPTION UNION ALL select a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, CASE WHEN ((CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' ) OR (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)') OR BOOK IN ('PLAFL', 'PLAPV') OR BOOK LIKE 'WM_LAL%' OR (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' ) OR A.WM_BANKING_PRODUCT_GROUP = 'Bank Lending') THEN 'Bank Lending' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') or a.WM_BANKING_PRODUCT_GROUP IN ('Liquidity') Then ('Liquidity') WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' ELSE a.WM_BANKING_PRODUCT_GROUP END AS WM_BANKING_PRODUCT_GROUP, CASE WHEN A.BOOK IN ('RPOHJ') THEN 'Repo' WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN (CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' )THEN 'Mortgages (HFI)' WHEN (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)' ) THEN 'Mortgages (HFS)' WHEN BOOK IN ('PLAFL', 'PLAPV')THEN 'PLA' WHEN BOOK LIKE 'WM_LAL%' THEN 'LAL' WHEN (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' )THEN 'Tailored Lending' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') then 'Repo' WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END AS WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME, a.PRODUCT_SUB_TYPE_CODE, sum(USD_NOTIONAL) AS USD_NOTIONAL, sum(USD_EXPOSURE) AS USD_EXPOSURE, sum(MV) AS MV, SUM(USD_PV01SPRD) AS USD_PV01SPRD, SUM(USD_PV01) AS USD_PV01, SUM(USD_IR_KAPPA) AS USD_IR_KAPPA, SUM(USD_CONVX) AS USD_CONVX, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * - 100 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) ELSE COALESCE(SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) END) AS SLIDE_IR_MIN_100BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 50 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_50BP_USD, USD_PV01 * 50) ELSE COALESCE(SLIDE_IR_PLS_50BP_USD, USD_PV01 * 50) END) AS SLIDE_IR_PLS_50BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * -50 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_MIN_50BP_USD, USD_PV01 * -50) ELSE COALESCE(SLIDE_IR_MIN_50BP_USD, USD_PV01 * -50) END) AS SLIDE_IR_MIN_50BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * -25 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_MIN_25BP_USD, USD_PV01 * -25) ELSE COALESCE(SLIDE_IR_MIN_25BP_USD, USD_PV01 * -25) END) AS SLIDE_IR_MIN_25BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 25 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_25BP_USD, USD_PV01 * 25) ELSE COALESCE(SLIDE_IR_PLS_25BP_USD, USD_PV01 * 25) END) AS SLIDE_IR_PLS_25BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 100 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_100BP_USD, USD_PV01 * 100) ELSE COALESCE(SLIDE_IR_PLS_100BP_USD, USD_PV01 * 100) END) AS SLIDE_IR_PLS_100BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 200 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_200BP_USD, USD_PV01 * 200) ELSE COALESCE(SLIDE_IR_PLS_200BP_USD,USD_PV01 * 200) END) AS SLIDE_IR_PLS_200BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 300 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_300BP_USD, USD_PV01 * 300) ELSE COALESCE(SLIDE_IR_PLS_300BP_USD, USD_PV01 * 300) END) AS SLIDE_IR_PLS_300BP_USD, SUM (USD_FX) AS USD_FX, sum(USD_FX_KAPPA) AS USD_VEGA from ( select a.POSITION_ID, a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.CCC_BUSINESS_AREA, a.CCC_DIVISION, a.CCC_STRATEGY, a.VERTICAL_SYSTEM, a.BOOK, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME, SUM(COALESCE((USD_NOTIONAL) :: numeric(15,5),0))/1000 as USD_NOTIONAL, sum(COALESCE((USD_EXPOSURE) :: numeric(15,5), 0)) / 1000 AS USD_EXPOSURE, sum(COALESCE((USD_PROCEED) :: numeric(15,5), 0)) / 1000 AS MV, SUM(COALESCE((USD_PV01SPRD) :: numeric(15,5),0))/1000 AS USD_PV01SPRD, SUM(COALESCE((USD_IR_KAPPA) :: numeric(15,5), 0)/10) AS USD_IR_KAPPA, SUM(COALESCE((USD_CONVX) :: numeric(15,5), 0)/10) AS USD_CONVX, SUM(COALESCE((USD_IR_UNIFIED_PV01) :: numeric(15,5), 0)) AS USD_PV01, SUM ((a.SLIDE_IR_PLS_100BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_100BP_USD, SUM ((a.SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_200BP_USD, SUM ((a.SLIDE_IR_PLS_300BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_300BP_USD, SUM ((a.SLIDE_IR_PLS_50BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_50BP_USD, SUM ((a.SLIDE_IR_MIN_50BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_50BP_USD, SUM ((a.SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_100BP_USD, SUM ((a.SLIDE_IR_MIN_200BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_200BP_USD, SUM ((a.SLIDE_IR_MIN_300BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_300BP_USD, SUM(COALESCE((USD_FX) :: numeric(15,5), 0)) AS USD_FX, SUM(COALESCE((USD_FX_KAPPA) :: numeric(15,5), 0)) AS USD_FX_KAPPA, SUM ((a.SLIDE_IR_MIN_25BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_25BP_USD, SUM ((a.SLIDE_IR_PLS_25BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_25BP_USD from cdwuser.u_dm_wm_position a WHERE A.COB_DATE in ( '2017-07-31', '2015-12-31' ) AND A.CCC_TAPS_COMPANY = '1633' AND (A.VAR_EXCL_FL<> 'Y' OR A.BOOK IN ('MSDPB3M','MSDPT3M')) AND (A.ccc_banking_trading = 'BANKING' OR (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') or a.CCC_business_area = 'US BANKS-LIQUIDITY' ) AND A.PRODUCT_TYPE_CODE ='REPO' AND A.CCC_BUSINESS_AREA NOT IN ('NON CORE MARKETS','CORE MARKETS')) and a.BOOK not in ('MS DVA STR NOTES IED NAM ADRIENS', 'MS DVA STR NOTES IED NAM CHAKOSPE') and a.account not in ('070002FK') group by a.POSITION_ID, a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.CCC_DIVISION, a.VERTICAL_SYSTEM, a.BOOK, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME ) A GROUP BY a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, CASE WHEN ((CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' ) OR (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)') OR BOOK IN ('PLAFL', 'PLAPV') OR BOOK LIKE 'WM_LAL%' OR (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' ) OR A.WM_BANKING_PRODUCT_GROUP = 'Bank Lending') THEN 'Bank Lending' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') or a.WM_BANKING_PRODUCT_GROUP IN ('Liquidity') Then ('Liquidity') WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' ELSE a.WM_BANKING_PRODUCT_GROUP END, CASE WHEN A.BOOK IN ('RPOHJ') THEN 'Repo' WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN (CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' )THEN 'Mortgages (HFI)' WHEN (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)' ) THEN 'Mortgages (HFS)' WHEN BOOK IN ('PLAFL', 'PLAPV')THEN 'PLA' WHEN BOOK LIKE 'WM_LAL%' THEN 'LAL' WHEN (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' )THEN 'Tailored Lending' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') then 'Repo' WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END, a.PRODUCT_TYPE_NAME, a.PRODUCT_SUB_TYPE_CODE, a.BANKING_PRODUCT_DESCRIPTION