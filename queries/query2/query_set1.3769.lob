SELECT A.cob_date, A.LE, A.CCC_BUSINESS_AREA, case when A.TERM_NEW > 0 and A.TERM_NEW <=1 then '1y' when A.TERM_NEW > 1 and A.TERM_NEW <=2 then '2y' when A.TERM_NEW > 2 and A.TERM_NEW <=5 then '5y' when A.TERM_NEW > 5 and A.TERM_NEW <=10 then '10y' when A.TERM_NEW > 10 and A.TERM_NEW <=20 then '20y' when A.TERM_NEW > 20 and A.TERM_NEW <=30 then '30y' when A.TERM_NEW > 30 and A.TERM_NEW <=100 then '100y' when A.TERM_NEW > 100 then '100y+' end as Bucket, CASE WHEN A.CURRENCY_CODE IN ('UB1', 'UBD', 'USD') THEN 'USD' WHEN A.CURRENCY_CODE NOT IN ('UB1', 'UBD', 'USD', 'JPY', 'EUR', 'GBP', 'BRL', 'CAD') THEN 'Other' ELSE A.CURRENCY_CODE END AS CCY1, case when A.CURRENCY_CODE in ('USD','CAD','EUR','JPY','GBP') then CURRENCY_CODE else 'Other' end as CCY2, case when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('DERIVS FUNDING','ISG FINANCING') then 'BRM' when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('LIQUID FLOW RATES') then 'LFR' when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('SECURITIZED PRODUCTS GRP') then 'SPG' when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('MUNICIPAL SECURITIES') then 'Muni' when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('CREDIT-CORPORATES') then 'CC' when A.LE='MSCO' and A.CCC_BUSINESS_AREA not in ('DERIVS FUNDING','ISG FINANCING','LIQUID FLOW RATES','SECURITIZED PRODUCTS GRP','MUNICIPAL SECURITIES','CREDIT-CORPORATES') then 'Other' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('DERIVS FUNDING','ISG FINANCING') then 'BRM' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('LIQUID FLOW RATES') then 'LFR' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('SECURITIZED PRODUCTS GRP') then 'SPG' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('STRUCTURED RATES') then 'SR' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('FXEM MACRO TRADING') then 'FXEM' when A.LE='MSCS' and A.CCC_BUSINESS_AREA not in ('DERIVS FUNDING','ISG FINANCING','LIQUID FLOW RATES','SECURITIZED PRODUCTS GRP','STRUCTURED RATES','FXEM MACRO TRADING') then 'Other' when A.LE='MSCGI' and A.CCC_BUSINESS_AREA in ('LIQUID FLOW RATES') then 'LFR' when A.LE='MSCGI' and A.CCC_BUSINESS_AREA in ('STRUCTURED RATES') then 'SR' when A.LE='MSCGI' and A.CCC_BUSINESS_AREA not in ('LIQUID FLOW RATES','STRUCTURED RATES') then 'Other' when A.LE='MSCAP' and A.CCC_BUSINESS_AREA in ('LIQUID FLOW RATES') then 'LFR' when A.LE='MSCAP' and A.CCC_BUSINESS_AREA in ('STRUCTURED RATES') then 'SR' when A.LE='MSCAP' and A.CCC_BUSINESS_AREA in ('PRIME BROKERAGE') then 'PB' when A.LE='MSCAP' and A.CCC_BUSINESS_AREA not in ('LIQUID FLOW RATES','STRUCTURED RATES','PRIME BROKERAGE') then CCC_BUSINESS_AREA end as BUSI1, sum(A.USD_PV01) as USD_PV01 FROM ( select cob_date, CCC_TAPS_COMPANY, CURRENCY_CODE, TERM_NEW, CCC_BUSINESS_AREA, CCC_STRATEGY, case when CCC_TAPS_COMPANY in ( '0201','0103','0205','0206','0530','5924') then 'MSCO' when CCC_TAPS_COMPANY in ('0111') then 'MSCS' when CCC_TAPS_COMPANY in ('5745') then 'MSCAP' when CCC_TAPS_COMPANY in ('0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609') then 'MSCGI' end as LE, SUM(round(USD_IR_UNIFIED_PV01/1000,1)) as USD_PV01 FROM CDWUSER.U_EXP_TRENDS WHERE cob_date in ('03/31/2017','04/28/2017','05/31/2017','06/30/2017','07/31/2017','08/31/2017','09/29/2017','10/31/2017','11/30/2017','12/29/2017','01/31/2018','02/28/2018') and CCC_TAPS_COMPANY in ( '0201','0103','0205','0206','0530','5924','0111','0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609','5745') and var_excl_fl <> 'Y' and bu_risk_system not like 'PIPELINE%' and bu_risk_run_custom1 <> 'STORAGE' and ccc_division not in ('FIC DVA','FID DVA') AND BU_RISK_SYSTEM NOT LIKE 'EQUITYSD%' group by cob_date, CCC_TAPS_COMPANY, CURRENCY_CODE, TERM_NEW, CCC_BUSINESS_AREA,CCC_STRATEGY, case when CCC_TAPS_COMPANY in ( '0201','0103','0205','0206','0530','5924') then 'MSCO' when CCC_TAPS_COMPANY in ('0111') then 'MSCS' when CCC_TAPS_COMPANY in ('5745') then 'MSCAP' when CCC_TAPS_COMPANY in ('0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609') then 'MSCGI' end ) A where A.LE in ('MSCO','MSCS','MSCGI','MSCAP') GROUP BY A.cob_date, A.LE, A.CCC_BUSINESS_AREA, case when A.TERM_NEW > 0 and A.TERM_NEW <=1 then '1y' when A.TERM_NEW > 1 and A.TERM_NEW <=2 then '2y' when A.TERM_NEW > 2 and A.TERM_NEW <=5 then '5y' when A.TERM_NEW > 5 and A.TERM_NEW <=10 then '10y' when A.TERM_NEW > 10 and A.TERM_NEW <=20 then '20y' when A.TERM_NEW > 20 and A.TERM_NEW <=30 then '30y' when A.TERM_NEW > 30 and A.TERM_NEW <=100 then '100y' when A.TERM_NEW > 100 then '100y+' end, CASE WHEN A.CURRENCY_CODE IN ('UB1', 'UBD', 'USD') THEN 'USD' WHEN A.CURRENCY_CODE NOT IN ('UB1', 'UBD', 'USD', 'JPY', 'EUR', 'GBP', 'BRL', 'CAD') THEN 'Other' ELSE A.CURRENCY_CODE END, case when A.CURRENCY_CODE in ('USD','CAD','EUR','JPY','GBP') then CURRENCY_CODE else 'Other' end , case when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('DERIVS FUNDING','ISG FINANCING') then 'BRM' when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('LIQUID FLOW RATES') then 'LFR' when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('SECURITIZED PRODUCTS GRP') then 'SPG' when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('MUNICIPAL SECURITIES') then 'Muni' when A.LE='MSCO' and A.CCC_BUSINESS_AREA in ('CREDIT-CORPORATES') then 'CC' when A.LE='MSCO' and A.CCC_BUSINESS_AREA not in ('DERIVS FUNDING','ISG FINANCING','LIQUID FLOW RATES','SECURITIZED PRODUCTS GRP','MUNICIPAL SECURITIES','CREDIT-CORPORATES') then 'Other' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('DERIVS FUNDING','ISG FINANCING') then 'BRM' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('LIQUID FLOW RATES') then 'LFR' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('SECURITIZED PRODUCTS GRP') then 'SPG' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('STRUCTURED RATES') then 'SR' when A.LE='MSCS' and A.CCC_BUSINESS_AREA in ('FXEM MACRO TRADING') then 'FXEM' when A.LE='MSCS' and A.CCC_BUSINESS_AREA not in ('DERIVS FUNDING','ISG FINANCING','LIQUID FLOW RATES','SECURITIZED PRODUCTS GRP','STRUCTURED RATES','FXEM MACRO TRADING') then 'Other' when A.LE='MSCGI' and A.CCC_BUSINESS_AREA in ('LIQUID FLOW RATES') then 'LFR' when A.LE='MSCGI' and A.CCC_BUSINESS_AREA in ('STRUCTURED RATES') then 'SR' when A.LE='MSCGI' and A.CCC_BUSINESS_AREA not in ('LIQUID FLOW RATES','STRUCTURED RATES') then 'Other' when A.LE='MSCAP' and A.CCC_BUSINESS_AREA in ('LIQUID FLOW RATES') then 'LFR' when A.LE='MSCAP' and A.CCC_BUSINESS_AREA in ('STRUCTURED RATES') then 'SR' when A.LE='MSCAP' and A.CCC_BUSINESS_AREA in ('PRIME BROKERAGE') then 'PB' when A.LE='MSCAP' and A.CCC_BUSINESS_AREA not in ('LIQUID FLOW RATES','STRUCTURED RATES','PRIME BROKERAGE') then CCC_BUSINESS_AREA end