With TOP10UKVega as ( SELECT CASE WHEN a.PARTIAL_DECOMP_PRODUCT_DESCRIPTION IS NULL THEN 'UNDEFINED' ELSE a.PARTIAL_DECOMP_PRODUCT_DESCRIPTION END PARTIAL_DECOMP_PRODUCT_DESCRIPTION, sum(a.USD_EQ_PARTIAL_KAPPA) as USD_EQ_PARTIAL_KAPPA FROM CDWUSER.U_EXP_MSR_PARTIAL a WHERE a.COB_DATE = '2018-02-28' AND a.CCC_DIVISION = 'INSTITUTIONAL EQUITY DIVISION' AND a.CCC_TAPS_COMPANY = '0302' AND ABS(a.USD_EQ_PARTIAL_KAPPA) > 0 AND (a.CASH_ISSUE_TYPE IN ('STOCK', 'ADR') OR a.Partial_Decomp_Sector IN ('STOCK', 'ADR')) AND a.ASSET_CLASS = 'EQ' GROUP BY a.PARTIAL_DECOMP_PRODUCT_DESCRIPTION ORDER BY ABS(sum(a.USD_EQ_PARTIAL_KAPPA)) DESC FETCH FIRST 10 ROWS ONLY ) SELECT a.RISK_MANAGER_LOCATION, CASE WHEN a.PARTIAL_DECOMP_PRODUCT_DESCRIPTION IS NULL THEN 'UNDEFINED' ELSE a.PARTIAL_DECOMP_PRODUCT_DESCRIPTION END PARTIAL_DECOMP_PRODUCT_DESCRIPTION, sum(coalesce(a.USD_EQ_PARTIAL_KAPPA,0))/1000 as USD_EQ_PARTIAL_KAPPA FROM CDWUSER.U_EXP_MSR_PARTIAL a WHERE a.COB_DATE = '2018-02-28' AND a.CCC_DIVISION = 'INSTITUTIONAL EQUITY DIVISION' AND a.CCC_TAPS_COMPANY = '0302' AND a.PARTIAL_DECOMP_PRODUCT_DESCRIPTION IN (SELECT PARTIAL_DECOMP_PRODUCT_DESCRIPTION FROM TOP10UKVega) AND (a.CASH_ISSUE_TYPE IN ('STOCK', 'ADR') OR a.Partial_Decomp_Sector IN ('STOCK', 'ADR')) AND a.ASSET_CLASS = 'EQ' GROUP BY a.RISK_MANAGER_LOCATION, a.PARTIAL_DECOMP_PRODUCT_DESCRIPTION