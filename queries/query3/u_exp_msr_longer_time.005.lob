SELECT a.COB_DATE, 'OIL LIQUIDS' as CCC_BUSINESS_AREA, SUM(a.USD_CM_DELTA) AS CM_DELTA FROM CDWUSER.u_exp_msr a WHERE a.CCC_TAPS_COMPANY IN ('0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609') AND a.cob_date <= '02/28/2018' and a.cob_date >= '02/01/2017' AND ((CCC_DIVISION = 'COMMODITIES' AND CCC_BUSINESS_AREA IN ('OIL LIQUIDS', 'TMG', 'OLYMPUS')) /*OLD LOGIC*/ OR (A.CCC_DIVISION = 'FIXED INCOME DIVISION' AND A.CCC_BUSINESS_AREA = 'COMMODITIES' AND (A.CCC_PRODUCT_LINE IN ('OIL & PRODUCTS') OR A.CCC_STRATEGY IN ('TMG', 'OLYMPUS'))) /*NEW LOGIC*/ ) AND PRODUCT_TYPE_CODE NOT IN ('CURRENCY', 'INTEREST RATE', 'INFLATION', 'TBD', 'MISC', 'CVA', 'FVA') GROUP BY a.COB_DATE, case when a.CCC_BUSINESS_AREA IN ('OIL LIQUIDS') or a.ccc_product_line in ('OIL & PRODUCTS') then 'OIL LIQUIDS' else a.CCC_PRODUCT_LINE end UNION SELECT b.COB_DATE, 'AGRICULTURALS' AS CCC_BUSINESS_AREA , SUM(b.USD_CM_DELTA) AS CM_DELTA FROM CDWUSER.u_exp_msr b WHERE b.CCC_TAPS_COMPANY IN ('0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609') AND b.cob_date <= '02/28/2018' and b.cob_date >= '02/01/2017' AND b.PRODUCT_TYPE_CODE IN ('GRAINS', 'SOFT / LIVESTOCK', 'VEG OILS') GROUP BY b.COB_DATE UNION SELECT c.COB_DATE, c.CCC_BUSINESS_AREA, SUM(case when c.LOT_UNIT_OF_LABEL IN ('LOT', 'MWH-P', 'MWH-O', 'RR-MWH') AND c.FEED_SOURCE_NAME = 'CORISK' AND c.CCC_BUSINESS_AREA NOT IN ('INVESTOR BUSINESS') then coalesce(c.USD_CM_DELTA,0) else 0 end) + sum(case when c.VERTICAL_SYSTEM ='NY-NG-SUPPLYLINK' and c.CCC_STRATEGY ='NAPG NAT GAS' and c.PRODUCT_SUB_TYPE_NAME ='OTC OPTION PREMIUM' then c.LCY_BALSHEET else 0 end )/1000 as cm_delta FROM CDWUSER.u_exp_msr c WHERE c.CCC_TAPS_COMPANY IN ('0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609') AND cob_date <= '02/28/2018' and cob_date >= '02/01/2017' AND c.var_excl_fl <> 'Y' AND (c.CCC_BUSINESS_AREA = 'NA ELECTRICITYNATURAL GAS' OR (c.CCC_BUSINESS_AREA = 'COMMODITIES' AND C.CCC_PRODUCT_LINE IN ('NA POWER & GAS'))) group by c.COB_DATE, c.CCC_BUSINESS_AREA UNION SELECT d.COB_DATE, 'NA ELECTRICITYNATURAL GAS' as CCC_BUSINESS_AREA, SUM(coalesce(d.USD_CM_DELTA,0)) AS CM_DELTA FROM CDWUSER.u_exp_msr d WHERE d.CCC_TAPS_COMPANY IN ('0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609') AND cob_date >= '02/01/2017' and cob_date < '07/30/2015' AND d.var_excl_fl <> 'Y' AND d.FEED_SOURCE_NAME = 'CORISK' AND d.LOT_UNIT_OF_LABEL IN ('LOT', 'MWH-P', 'MWH-O', 'RR-MWH') AND (d.CCC_BUSINESS_AREA = 'NA ELECTRICITYNATURAL GAS' OR (d.CCC_BUSINESS_AREA = 'COMMODITIES' AND d.CCC_PRODUCT_LINE IN ('NA POWER & GAS'))) group by d.COB_DATE, d.CCC_BUSINESS_AREA UNION SELECT e.COB_DATE, e.CCC_BUSINESS_AREA, SUM(coalesce(e.USD_CM_DELTA,0)) AS CM_DELTA FROM CDWUSER.u_exp_msr e WHERE e.CCC_TAPS_COMPANY IN ('0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609') AND e.cob_date <= '02/28/2018' and e.cob_date >= '02/01/2017' AND e.var_excl_fl <> 'Y' AND e.FEED_SOURCE_NAME = 'CORISK' AND e.PRODUCT_TYPE_CODE IN ('EUR NG','EURO BASE','EURO PWR','EMISSIONS-EU','LEC','LNG','COAL','LNG FREIGHT','DRY FREIGHT','IRON ORE') AND e.CCC_BUSINESS_AREA = 'AP EU ELECTRICNATURAL GAS' group by e.COB_DATE, e.CCC_BUSINESS_AREA UNION select f.COB_date ,f.PRODUCT_TYPE_CODE ,sum(f.USD_CM_DELTA) as USD_CM_DELTA from CDWUSER.u_exp_msr f where 1=1 AND f.cob_date <= '02/28/2018' and f.cob_date >= '02/01/2017' and f.USD_CM_DELTA is not null AND F.CCC_TAPS_COMPANY IN ('0105', '0513', '1133', '1614', '2042', '4442', '4919', '4920', '5122', '6399', '7025', '7038', '7114', '7323', '7410', '7504', '7516', '8296', '8304', '8562', '8747', '8934', '7706', '7549', '6706', '5427', '7414', '7465', '7493', '7278', '7279', '7705', '7624', '7681', '7800', '5656', '7708', '7707', '7801', '7627', '7759', '7710', '7762', '7630', '7628', '7761', '7684', '5923', '7609') and f.PRODUCT_TYPE_CODE in ('BASEMETAL', 'PRECIOUSMETAL') and f.VAR_EXCL_FL <> 'Y' and f.FEED_SOURCE_NAME = 'CORISK' group by f.COB_date, f.PRODUCT_TYPE_CODE