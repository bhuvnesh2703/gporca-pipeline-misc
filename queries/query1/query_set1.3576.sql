SELECT CASE WHEN a.TERM_NEW <= 1 THEN '<=1Y' ELSE '>1Y' END AS term_bucket, CASE WHEN CURRENCY_OF_MEASURE IN ('BRX','BR1') THEN 'BRL' WHEN CURRENCY_OF_MEASURE IN ('KRX') THEN 'KRW' WHEN CURRENCY_OF_MEASURE IN ('RU1','RBX') THEN 'RUB' WHEN CURRENCY_OF_MEASURE IN ('CNH') THEN 'CNY' ELSE CURRENCY_OF_MEASURE END AS currency, CASE WHEN (currency_of_measure IN ('EUR','CHF','GBP','SEK','NOK','DKK','JPY','AUD','NZD','CAD','USD') OR (substr(currency_of_measure,1,3) IN ('EUR','CHF','GBP','SEK','NOK','DKK','JPY','AUD','NZD','CAD','USD') AND substr(currency_of_measure,4,3) IN ('EUR','CHF','GBP','SEK','NOK','DKK','JPY','AUD','NZD','CAD','USD'))) THEN 'MAJOR' ELSE 'EM' END AS MAJOR_EM, SUM (a.USD_FX_KAPPA) AS Vega FROM cdwuser.U_DM_FX a WHERE a.cob_date IN ('2018-02-28') AND VAR_EXCL_FL <> 'Y' AND BU_RISK_RUN_CUSTOM1 <> 'STORAGE' AND a.USD_FX_KAPPA IS NOT NULL AND a.USD_FX_KAPPA <> 0 AND a.IS_UK_GROUP = 'Y' AND CCC_DIVISION NOT IN ('FID DVA','FIC DVA') AND CCC_STRATEGY NOT IN ('MS DVA STR NOTES IED') GROUP BY CASE WHEN a.TERM_NEW <= 1 THEN '<=1Y' ELSE '>1Y' END, CASE WHEN CURRENCY_OF_MEASURE IN ('BRX','BR1') THEN 'BRL' WHEN CURRENCY_OF_MEASURE IN ('KRX') THEN 'KRW' WHEN CURRENCY_OF_MEASURE IN ('RU1','RBX') THEN 'RUB' WHEN CURRENCY_OF_MEASURE IN ('CNH') THEN 'CNY' ELSE CURRENCY_OF_MEASURE END, CASE WHEN (currency_of_measure IN ('EUR','CHF','GBP','SEK','NOK','DKK','JPY','AUD','NZD','CAD','USD') OR (substr(currency_of_measure,1,3) IN ('EUR','CHF','GBP','SEK','NOK','DKK','JPY','AUD','NZD','CAD','USD') AND substr(currency_of_measure,4,3) IN ('EUR','CHF','GBP','SEK','NOK','DKK','JPY','AUD','NZD','CAD','USD'))) THEN 'MAJOR' ELSE 'EM' END