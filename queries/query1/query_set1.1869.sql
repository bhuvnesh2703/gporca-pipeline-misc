Select C.*, D.ccc_risk_manager_login, D.consolidated_rating from (SELECT cob_date,parent_credit_issuer_darwin_name ,sum(usd_eq_base_jtd_decomp) as usd_eq_base_jtd_current ,0 as usd_eq_base_jtd_prev FROM CDWUSER.U_DECOMP_JTD_SLIDES a WHERE COB_DATE = '02-28-2018' and usd_eq_base_jtd_decomp is not null and usd_eq_base_jtd_decomp <>0 and parent_credit_issuer_darwin_name not like '%MORGAN STANLEY%' group by cob_date,parent_credit_issuer_darwin_name union all SELECT cob_date,parent_credit_issuer_darwin_name ,0 as usd_eq_base_jtd_current ,sum(usd_eq_base_jtd_decomp) as usd_eq_base_jtd_prev FROM CDWUSER.U_DECOMP_JTD_SLIDES a WHERE COB_DATE = '02-27-2018' and usd_eq_base_jtd_decomp is not null and usd_eq_base_jtd_decomp <>0 and parent_credit_issuer_darwin_name not like '%MORGAN STANLEY%' group by cob_date,parent_credit_issuer_darwin_name) as C left join (Select parent_credit_issuer_darwin_name,ccc_risk_manager_login,consolidated_rating from (SELECT parent_credit_issuer_darwin_name ,ccc_risk_manager_login ,consolidated_rating ,sum(usd_eq_base_jtd_decomp) as usd_eq_base_jtd_current ,rank() over (partition by parent_credit_issuer_darwin_name order by sum(usd_eq_base_jtd_decomp)) as RM_ranking FROM CDWUSER.U_DECOMP_JTD_SLIDES a WHERE COB_DATE in ('02-27-2018','02-28-2018') and usd_eq_base_jtd_decomp is not null and usd_eq_base_jtd_decomp <>0 and parent_credit_issuer_darwin_name not like '%MORGAN STANLEY%' group by cob_date ,parent_credit_issuer_darwin_name ,consolidated_rating ,ccc_risk_manager_login) as B where RM_ranking = 1) as D on C.parent_credit_issuer_darwin_name = D.parent_credit_issuer_darwin_name