SELECT COB_DATE, AS_OF_DATE, RERUN_ID, TO_CHAR(COB_DATE,'DD-Mon-YYYY') || ' | ' || TO_CHAR(AS_OF_DATE,'DD-Mon-YYYY') AS DATE_STRING, CASE WHEN COB_DATE - AS_OF_DATE > 5 THEN COB_DATE - AS_OF_DATE - ROUND(((COB_DATE-AS_OF_DATE)/5),0) * 2 WHEN COB_DATE - AS_OF_DATE >= 3 AND EXTRACT(DOW FROM COB_DATE) IN (1,2,3) THEN COB_DATE - AS_OF_DATE - 2 ELSE COB_DATE - AS_OF_DATE END AS FFWD_AGE, CCC_BUSINESS_AREA, BOOK, CCC_RISK_MANAGER_LOGIN, STRING_AGG (ACCOUNT, ', ') AS ACCOUNT FROM ( SELECT COB_DATE, CCC_BUSINESS_AREA, BOOK, CCC_RISK_MANAGER_LOGIN, AS_OF_DATE, RERUN_ID, MAX(ACCOUNT) AS ACCOUNT FROM CDWUSER.U_EXP_MSR WHERE COB_DATE = '2018-02-28' AND FFWD_FL = 'Y' AND FILL_FORWARD_TYPE='M' GROUP BY COB_DATE, CCC_BUSINESS_AREA, BOOK, ACCOUNT, AS_OF_DATE, CCC_RISK_MANAGER_LOGIN, RERUN_ID ORDER BY COB_DATE, BOOK, ACCOUNT, CCC_RISK_MANAGER_LOGIN, AS_OF_DATE ASC ) X GROUP BY COB_DATE, CCC_BUSINESS_AREA, AS_OF_DATE, FFWD_AGE, BOOK, CCC_RISK_MANAGER_LOGIN, RERUN_ID