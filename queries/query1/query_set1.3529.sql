select cob_date, term_bucket, usd_notional from ( select cob_date, account, case when term_of_measure<=3 then '1d' when term_of_measure<=30 then '< 1m' when term_of_measure>30 then '> 1m' end as term_bucket, sum(coalesce(CASE WHEN book in('SWPIN','TDET6', 'TAIRR', 'TAEMR', 'TEEMR', 'HKFAP', 'TTIRR', 'HKFAM', 'TKFVS', 'HKFAS', 'TBAGR') THEN -usd_notional WHEN (book in('CALLT', 'CALTB', 'LCALT', 'LCATB')) THEN usd_MARKET_VALUE else usd_notional END, 0)) as USD_NOTIONAL from cdwuser.u_dm_treasury where cob_date in ('2018-02-28', '2018-01-31') and book='RPOAF' and ACCOUNT NOT IN ('07000AB27') group by cob_date,account, case when term_of_measure<=3 then '1d' when term_of_measure<=30 then '< 1m' when term_of_measure>30 then '> 1m' end) a where usd_notional>0