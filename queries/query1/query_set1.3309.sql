SELECT f.COB_DATE, 'Funding' AS FUNDING_FLAG, F.BOOK, f.CURRENCY_OF_MEASURE, f.EXPIRATION_DATE, SUM (f.USD_NOTIONAL) AS USD_NOTIONAL FROM cDWUSER.U_OT_MSR F WHERE F.COB_DATE IN ('2018-02-28') AND f.CCC_DIVISION = 'TREASURY CAPITAL MARKETS' AND f.VERTICAL_SYSTEM LIKE '%FXDDI%' AND f.BOOK NOT IN ('CT0302XE', 'CT0101XE') AND f.CCC_BUSINESS_AREA IN ('TSY DEBT') AND f.CCC_PRODUCT_LINE IN ('S-TERM DEBT', 'FX AND OTHER FUNDING') AND f.CCC_STRATEGY IN ('FX SWAPS') AND f.USD_NOTIONAL IS NOT NULL AND f.USD_NOTIONAL <> 0 AND f.COB_DATE < f.EXPIRATION_DATE GROUP BY f.COB_DATE, F.BOOK, f.CURRENCY_OF_MEASURE, f.EXPIRATION_DATE UNION ALL SELECT f.COB_DATE, 'Funding' AS FUNDING_FLAG, F.BOOK, f.CURRENCY_OF_MEASURE, f.EXPIRATION_DATE, CASE WHEN f.LONG_SHORT = 'L' THEN SUM (f.USD_NOTIONAL) ELSE - SUM (f.USD_NOTIONAL) END AS USD_NOTIONAL FROM cDWUSER.U_OT_MSR F WHERE F.COB_DATE IN ('2018-02-28') AND f.BOOK IN ('TSGFX', 'THKFX') AND f.USD_NOTIONAL IS NOT NULL AND f.USD_NOTIONAL <> 0 AND f.COB_DATE < f.EXPIRATION_DATE GROUP BY f.COB_DATE, F.BOOK, f.CURRENCY_OF_MEASURE, f.EXPIRATION_DATE, f.long_short UNION ALL SELECT f.COB_DATE, 'Funding' AS FUNDING_FLAG, F.BOOK, f.CURRENCY_OF_MEASURE, f.EXPIRATION_DATE, case when f.book = 'KRSWP' THEN SUM (f.USD_MARKET_VALUE) ELSE SUM(F.USD_NOTIONAL) END AS USD_NOTIONAL FROM cDWUSER.U_OT_MSR F WHERE F.COB_DATE IN ('2018-02-28') AND f.BOOK IN ('KRSWP', 'CT0101LIQ1') AND f.USD_NOTIONAL IS NOT NULL AND f.COB_DATE < f.EXPIRATION_DATE GROUP BY f.COB_DATE, F.BOOK, f.CURRENCY_OF_MEASURE, f.EXPIRATION_DATE