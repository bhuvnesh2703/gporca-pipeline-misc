select * from ( select COB_DATE, a.CCC_TAPS_COMPANY, a.YEARS_TO_MATURITY, a.book, a.ACCOUNT, CASE WHEN ((CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' ) OR (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)') OR BOOK IN ('PLAFL', 'PLAPV') OR BOOK LIKE 'WM_LAL%' OR (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' ) OR A.WM_BANKING_PRODUCT_GROUP = 'Bank Lending') THEN 'Bank Lending' ELSE a.WM_BANKING_PRODUCT_GROUP END AS WM_BANKING_PRODUCT_GROUP, CASE WHEN A.BOOK IN ('RPOHJ') THEN 'Repo' WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN (CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' )THEN 'Mortgages (HFI)' WHEN (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)' ) THEN 'Mortgages (HFS)' WHEN BOOK IN ('PLAFL', 'PLAPV')THEN 'PLA' WHEN BOOK LIKE 'WM_LAL%' THEN 'LAL' WHEN (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' )THEN 'Tailored Lending' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END AS WM_BANKING_PRODUCT_SUB_GROUP, case when BOOK in ('CCISW','DPSWA','DPTSW','IPBSW','IPTSW','PLSWA','RPOFO','RPOHA','RPOHD','RPOHJ','RPOHK','RPOHM','RPOHO','TL2SW', 'CSSW2') then 'Internal Hedges' else 'n/a' end as Hedges, case when Product_Type_Code in ('BOND') then 'Credit' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit' else 'Other' end as SECTYPE_GROUP, Product_Type_Code, PRODUCT_SUB_TYPE_CODE, FID1_INDUSTRY_NAME_LEVEL2, A.POSITION_ISSUER_PARTY_DARWIN_NAME, MRD_RATING, A.VINTAGE_YEAR, round(COUPON/0.5, 0 )*0.5 as COUPON, CASE WHEN ((CREDIT_SPREAD) :: numeric(15,5) <= -50) THEN '-50' WHEN ((CREDIT_SPREAD) :: numeric(15,5) >-50 AND (CREDIT_SPREAD) :: numeric(15,5) <=0) THEN '-50 - 0' WHEN ((CREDIT_SPREAD) :: numeric(15,5) >0 AND (CREDIT_SPREAD) :: numeric(15,5) <=50) THEN '0 - 50' WHEN ((CREDIT_SPREAD) :: numeric(15,5) >50 AND (CREDIT_SPREAD) :: numeric(15,5) <=100) THEN '50 - 100' WHEN ((CREDIT_SPREAD) :: numeric(15,5) >100) THEN '> 100' END AS CREDIT_SPREAD, COALESCE ((USD_NOTIONAL) :: numeric(15,5), 0)/1000 as USD_NOTIONAL, COALESCE ((USD_MARKET_VALUE) :: numeric(15,5), 0)/ 1000 AS USD_MARKET_VALUE, COALESCE ((USD_EXPOSURE) :: numeric(15,5), 0)/ 1000 AS USD_EXPOSURE, COALESCE ((USD_IR_UNIFIED_PV01) :: numeric(15,5), 0)/1000 AS USD_PV01, COALESCE ((USD_PV01SPRD) :: numeric(15,5), 0)/1000 AS USD_PV01SPRD, COALESCE ((USD_PV10_BENCH) :: numeric(15,5), 0)/1000 AS USD_PV10_BENCH, COALESCE ((USD_IR_KAPPA) :: numeric(15,5), 0)/10000 AS USD_IR_KAPPA, (COALESCE ((CREDIT_SPREAD) :: numeric(15,5), 0) *COALESCE ((USD_PV01SPRD) :: numeric(15,5), 0)/1000) as Spread_x_pv01sprd from CDWUSER.U_DM_WM A WHERE A.COB_DATE in ( '2015-12-31' ) AND A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') and VAR_EXCL_FL<> 'Y' ) a where a.WM_BANKING_PRODUCT_GROUP in ('AFS') UNION ALL select COB_DATE, a.CCC_TAPS_COMPANY, a.YEARS_TO_MATURITY, a.book, a.ACCOUNT, A.WM_BANKING_PRODUCT_GROUP, A.WM_BANKING_PRODUCT_SUB_GROUP, case when BOOK in ('CCISW','DPSWA','DPTSW','IPBSW','IPTSW','PLSWA','RPOFO','RPOHA','RPOHD','RPOHJ','RPOHK','RPOHM','RPOHO','TL2SW', 'CSSW2') then 'Internal Hedges' else 'n/a' end as Hedges, case when Product_Type_Code in ('BOND') then 'Credit' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit' else 'Other' end as SECTYPE_GROUP, Product_Type_Code, PRODUCT_SUB_TYPE_CODE, FID1_INDUSTRY_NAME_LEVEL2, A.POSITION_ISSUER_PARTY_DARWIN_NAME, MRD_RATING, A.VINTAGE_YEAR, round(COUPON/0.5, 0 )*0.5 as COUPON, CASE WHEN ((CREDIT_SPREAD) :: numeric(15,5) <= -50) THEN '-50' WHEN ((CREDIT_SPREAD) :: numeric(15,5) >-50 AND (CREDIT_SPREAD) :: numeric(15,5) <=0) THEN '-50 - 0' WHEN ((CREDIT_SPREAD) :: numeric(15,5) >0 AND (CREDIT_SPREAD) :: numeric(15,5) <=50) THEN '0 - 50' WHEN ((CREDIT_SPREAD) :: numeric(15,5) >50 AND (CREDIT_SPREAD) :: numeric(15,5) <=100) THEN '50 - 100' WHEN ((CREDIT_SPREAD) :: numeric(15,5) >100) THEN '> 100' END AS CREDIT_SPREAD, COALESCE ((USD_NOTIONAL) :: numeric(15,5), 0)/1000 as USD_NOTIONAL, COALESCE ((USD_MARKET_VALUE) :: numeric(15,5), 0)/ 1000 AS USD_MARKET_VALUE, COALESCE ((USD_EXPOSURE) :: numeric(15,5), 0)/ 1000 AS USD_EXPOSURE, COALESCE ((USD_IR_UNIFIED_PV01) :: numeric(15,5), 0)/1000 AS USD_PV01, COALESCE ((USD_PV01SPRD) :: numeric(15,5), 0)/1000 AS USD_PV01SPRD, COALESCE ((USD_PV10_BENCH) :: numeric(15,5), 0)/1000 AS USD_PV10_BENCH, COALESCE ((USD_IR_KAPPA) :: numeric(15,5), 0)/10000 AS USD_IR_KAPPA, (COALESCE ((CREDIT_SPREAD) :: numeric(15,5), 0) *COALESCE ((USD_PV01SPRD) :: numeric(15,5), 0)/1000) as Spread_x_pv01sprd from CDWUSER.U_DM_WM A where COB_DATE in ( '2018-02-28', '2018-02-27', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31', '2017-09-29', '2017-08-31', '2015-12-31' ) AND A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') and a.WM_BANKING_PRODUCT_GROUP in ('AFS') and VAR_EXCL_FL<> 'Y'