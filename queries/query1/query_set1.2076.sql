/* EQ DELTA */ SELECT COB_DATE, CCC_BUSINESS_AREA, CASE WHEN CCC_BUSINESS_AREA = 'DERIVATIVES' THEN CCC_PRODUCT_LINE ELSE 'Others' END AS CCC_PRODUCT_LINE, CASE WHEN CCC_PRODUCT_LINE = 'EXOTIC PRODUCTS' THEN 'EXO' WHEN CCC_PRODUCT_LINE = 'INDEX PRODUCTS' THEN 'IDX' ELSE NULL END AS PRD_LINE_FLAG, CCC_STRATEGY, SUM( CASE WHEN FEED_SOURCE_NAME NOT IN ('CORISK', 'ER1') AND PARENT_LEGAL_ENTITY = '0302(G)' THEN COALESCE (USD_DELTA, 0) WHEN FEED_SOURCE_NAME = 'CORISK' AND PRODUCT_TYPE_CODE = 'EQUITY INDEX' AND PARENT_LEGAL_ENTITY = '0302(G)' THEN COALESCE (USD_DELTA, 0) ELSE 0 END ) AS USD_DELTA, SUM( CASE WHEN PARENT_LEGAL_ENTITY = '0302(G)' THEN ( CASE WHEN (FEED_SOURCE_NAME = 'CORISK' AND PRODUCT_TYPE_CODE = 'EQUITY INDEX') THEN COALESCE(USD_EQ_KAPPA + RAW_CM_KAPPA,0) ELSE USD_EQ_KAPPA END ) END ) AS USD_EQ_KAPPA FROM CDWUSER.U_EXP_MSR x WHERE COB_DATE BETWEEN '2018-01-31' AND '2018-02-28' AND BASEL_III_GROUP_BTI = 'TRADING' AND CCC_DIVISION = 'INSTITUTIONAL EQUITY DIVISION' AND VAR_EXCL_FL <> 'Y' GROUP BY COB_DATE, CCC_BUSINESS_AREA, CCC_PRODUCT_LINE,CCC_STRATEGY UNION ALL /* EQ DECOMP */ SELECT COB_DATE, CCC_BUSINESS_AREA, CASE WHEN CCC_BUSINESS_AREA = 'DERIVATIVES' THEN CCC_PRODUCT_LINE ELSE 'Others' END AS CCC_PRODUCT_LINE, CASE WHEN CCC_PRODUCT_LINE = 'EXOTIC PRODUCTS' THEN 'EXO' WHEN CCC_PRODUCT_LINE = 'INDEX PRODUCTS' THEN 'IDX' ELSE NULL END AS PRD_LINE_FLAG, CCC_STRATEGY, SUM( CASE WHEN (COALESCE (PRODUCT_TYPE_CODE_DECOMP, '') <> 'COMM' OR COALESCE (CASH_ISSUE_TYPE, '') <> 'COMM') AND FEED_SOURCE_ID = 301 AND PARENT_LEGAL_ENTITY = '0302(G)' THEN COALESCE (USD_EQ_DELTA_DECOMP, 0) ELSE 0 END ) AS USD_DELTA, 0 AS USD_EQ_KAPPA FROM CDWUSER.U_DECOMP_MSR y WHERE COB_DATE BETWEEN '2018-01-31' AND '2018-02-28' AND CCC_BANKING_TRADING = 'TRADING' AND VAR_EXCL_FL <> 'Y' AND CCC_DIVISION = 'INSTITUTIONAL EQUITY DIVISION' GROUP BY COB_DATE, CCC_BUSINESS_AREA, CCC_PRODUCT_LINE,CCC_STRATEGY