Select T.COB_DATE, T.BOOK, T.PRODUCT_TYPE_CODE, T.POSITION_CHILD_ISSUER_PARTY_DARWIN_NAME, t.PRODUCT_DESCRIPTION_MAPPING, case when cob_date <> '2016-12-30' and (product_type_code='RMBS' or product_type_code='AGNCMO') AND (POSITION_CHILD_ISSUER_PARTY_DARWIN_NAME <> 'UNITED STATES OF AMERICA') THEN 'Pass-Throughs/Agency CMO' when cob_date = '2016-12-30' and PRODUCT_DESCRIPTION_MAPPING in ('FMCC 15 Years', 'FMCC 30 Years', 'FNMA 15 Years', 'FNMA 30 Years') THEN 'Pass-Throughs/Agency CMO' when product_type_code='AGN' THEN 'Agency Debentures' else 'Other' end as Portfolio_Breakout, sum(coalesce(CASE WHEN book in('SWPIN','TDET6', 'TAIRR', 'TAEMR', 'TEEMR', 'HKFAP', 'TTIRR', 'HKFAM', 'TKFVS', 'HKFAS', 'TBAGR') THEN -usd_notional WHEN (book in('CALLT', 'CALTB', 'LCALT', 'LCATB')) THEN usd_MARKET_VALUE else usd_notional END, 0)) as USD_NOTIONAL, SUM(T.USD_IR_UNIFIED_PV01) AS PV01, CASE WHEN SUM(T.SLIDE_IR_PLS_200BP_USD) IS NULL THEN SUM(T.USD_IR_UNIFIED_PV01)*200 ELSE SUM(T.SLIDE_IR_PLS_200BP_USD) END AS P200 from cdwuser.U_dm_treasury t where cob_date in ('2018-02-28', '2018-02-27', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31','2017-09-29','2017-08-31', '2017-12-29') and t.book IN ('TSTPM','TSHTM') GROUP BY T.COB_DATE, T.BOOK, T.PRODUCT_TYPE_CODE, T.POSITION_CHILD_ISSUER_PARTY_DARWIN_NAME, t.PRODUCT_DESCRIPTION_MAPPING, case when cob_date <> '2016-12-30' and (product_type_code='RMBS' or product_type_code='AGNCMO') AND (POSITION_CHILD_ISSUER_PARTY_DARWIN_NAME <> 'UNITED STATES OF AMERICA') THEN 'Pass-Throughs/Agency CMO' when cob_date = '2016-12-30' and PRODUCT_DESCRIPTION_MAPPING in ('FMCC 15 Years', 'FMCC 30 Years', 'FNMA 15 Years', 'FNMA 30 Years') THEN 'Pass-Throughs/Agency CMO' when product_type_code='AGN' THEN 'Agency Debentures' else 'Other' end