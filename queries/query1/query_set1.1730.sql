SELECT  source_scn_name, a.product_hierarchy_level_7 , Case when Substr(CCAR_CURRENCY_PAIR,1,3) = 'USD' THEN Substr(CCAR_CURRENCY_PAIR,4,3)||'USD' ELSE CCAR_CURRENCY_PAIR END as CCAR_CURRENCY_PAIR , sum(PNL) as PNL From ( Select source_scn_name, a.product_hierarchy_level_7 , case when PRODUCT_TYPE IN ('FXBSKT') then 'Unattributed' else REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(CURRENCY_PAIR,'CNH','CNY'),'KRX','KRW'),'RBX','RUB'),'RU1','RUB'),'BRX','BRL'),'UBD','USD'),'BR1','BRL') end as CCAR_CURRENCY_PAIR , sum(raw_pnl)/1000 PNL from DWUSER.U_RAW_SCENARIO_PNL a where  COB_DATE = '2018-02-28' AND CCC_BUSINESS_AREA = 'FXEM MACRO TRADING' and PRODUCT_TYPE IN ('FXOPT')  and  source_scn_name in ('BHC2017_S1_FX_ALL', 'BHC2017_S1_FX_Spot' , 'BHC2017_S1_FX_Vol') and  BU_RISK_SYSTEM like 'FXOPT%' group by source_scn_name, a.product_hierarchy_level_7 , case when PRODUCT_TYPE IN ('FXBSKT') then 'Unattributed' else REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(CURRENCY_PAIR,'CNH','CNY'),'KRX','KRW'),'RBX','RUB'),'RU1','RUB'),'BRX','BRL'),'UBD','USD'),'BR1','BRL') end ) a group by source_scn_name, a.product_hierarchy_level_7 , Case when Substr(CCAR_CURRENCY_PAIR,1,3) = 'USD' THEN Substr(CCAR_CURRENCY_PAIR,4,3)||'USD' ELSE CCAR_CURRENCY_PAIR END