select COB_DATE as VARDATE, CCC_BUSINESS_AREA, CCC_STRATEGY, CCC_PRODUCT_LINE, V_M050 as MINUS50PCT, V_M010 as MINUS10PCT, V_P010 as PLUS10PCT, V_P050 as PLUS50PCT, V_P100 as PLUS100PCT, V_P200 as PLUS200PCT, V_P300 as PLUS300PCT from ( SELECT case when Book like '%ELTH%' and BOOK not like '%HFI%' then 'LENDING' else CCC_BUSINESS_AREA end as CCC_BUSINESS_AREA, case when CCC_PRODUCT_LINE in ('PRIMARY - IG BONDS', 'PRIMARY - NIG BONDS' ) then 'PRIMARY - BONDS' when CCC_PRODUCT_LINE in ('HIGH YIELD - EU', 'INV GRADE TRADING - EU') then 'EUROPEAN CREDIT FLOW' else CCC_PRODUCT_LINE end as CCC_PRODUCT_LINE, CCC_STRATEGY, COB_DATE, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.SLIDE_PVSPRCOMP_MIN_50PCT_USD, 0) ELSE coalesce(SLIDE_PV_MIN_50PCT_USD, 0) END) AS V_M050, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.SLIDE_PVSPRCOMP_MIN_19PCT_USD, 0) ELSE coalesce(SLIDE_PV_MIN_19PCT_USD, 0) END) AS V_M019, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.SLIDE_PVSPRCOMP_MIN_10PCT_USD, 0) ELSE coalesce(SLIDE_PV_MIN_10PCT_USD, 0) END) AS V_M010, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.USD_PV10_BENCH_COMP, 0) ELSE coalesce(USD_PV10_BENCH, 0) END) AS V_P010, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.SLIDE_PVSPRCOMP_PLS_21PCT_USD, 0) ELSE coalesce(SLIDE_PV_PLS_21PCT_USD, 0) END) AS V_P021, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.SLIDE_PVSPRCOMP_PLS_50PCT_USD, 0) ELSE coalesce(SLIDE_PV_PLS_50PCT_USD, 0) END) AS V_P050, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.SLIDE_PVSPRCOMP_PLS_100PCT_USD, 0) ELSE coalesce(SLIDE_PV_PLS_100PCT_USD, 0) END) AS V_P100, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.SLIDE_PVSPRCOMP_PLS_200PCT_USD, 0) ELSE coalesce(SLIDE_PV_PLS_200PCT_USD, 0) END) AS V_P200, sum(CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN coalesce(b.SLIDE_PVSPRCOMP_PLS_300PCT_USD, 0) ELSE coalesce(SLIDE_PV_PLS_300PCT_USD, 0) END) AS V_P300 FROM DWUSER.U_EXP_TRENDS b WHERE (CCC_BUSINESS_AREA IN ('CREDIT-CORPORATES','LENDING','MUNICIPAL SECURITIES', 'EM CREDIT TRADING') and CCC_PRODUCT_LINE not in ('PRIMARY - BONDS','PRIMARY - IG BONDS', 'PRIMARY - NIG BONDS') and (CCC_PRODUCT_LINE != 'PRIMARY - LOANS' OR (Book like '%ELTH%' and BOOK not like '%HFI%')) AND CCC_STRATEGY NOT IN ('HELD FOR INVESTMENT','PROJECT FINANCE', 'CORPORATE LOAN STRATEGY' ) AND (CCC_PRODUCT_LINE != 'DISTRESSED TRADING' or CCC_STRATEGY = 'PAR LOANS TRADING') AND BOOK NOT IN ('PMGPB') and not (PRODUCT_TYPE_CODE in ('PREF','BOND') and FID1_SENIORITY in ('AT1','SUBT1','SUBUT2')) and b.cob_date = '2018-02-21' AND b.CCC_PL_REPORTING_REGION in ('EMEA','EUROPE') ) GROUP BY case when Book like '%ELTH%' and BOOK not like '%HFI%' then 'LENDING' else CCC_BUSINESS_AREA end, CCC_PRODUCT_LINE, CCC_STRATEGY, COB_DATE ) t