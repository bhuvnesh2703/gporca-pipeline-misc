select a.COB_DATE, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * - 100 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) ELSE COALESCE(SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) END) AS SLIDE_IR_MIN_100BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 200 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_200BP_USD, USD_PV01 * 200) ELSE COALESCE(SLIDE_IR_PLS_200BP_USD,USD_PV01 * 200) END) AS SLIDE_IR_PLS_200BP_USD from ( select a.POSITION_ID, a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME, SUM(COALESCE((USD_IR_UNIFIED_PV01) :: numeric(15,5), 0)) AS USD_PV01, SUM ((a.SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_200BP_USD, SUM ((a.SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_100BP_USD from cdwuser.u_dm_wm_position a WHERE A.COB_DATE in ( '2018-02-28', '2018-02-21', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31', '2017-09-29', '2017-08-31', '2017-12-29', '2015-12-31' ) AND A.CCC_TAPS_COMPANY = '1633' AND (A.VAR_EXCL_FL<> 'Y' OR A.BOOK IN ('MSDPB3M','MSDPT3M')) AND (A.ccc_banking_trading = 'BANKING' OR (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') or a.CCC_business_area = 'US BANKS-LIQUIDITY' ) AND A.PRODUCT_TYPE_CODE ='REPO' AND A.CCC_BUSINESS_AREA NOT IN ('NON CORE MARKETS','CORE MARKETS')) group by a.POSITION_ID, a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME ) A GROUP BY a.COB_DATE UNION ALL select a.COB_DATE, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * - 100 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) ELSE COALESCE(SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) END) AS SLIDE_IR_MIN_100BP_USD, sum(CASE WHEN (Product_Type_Code IN ('REPO') or A.VERTICAL_SYSTEM LIKE '%SPG%' or a.WM_BANKING_PRODUCT_SUB_GROUP = 'Cash') THEN USD_PV01 * 200 WHEN A.WM_BANKING_PRODUCT_GROUP IN ('Other Assets', 'ISG LOANS') or Product_Type_Code IN ('GVTBOND') THEN COALESCE(SLIDE_IR_PLS_200BP_USD, USD_PV01 * 200) ELSE COALESCE(SLIDE_IR_PLS_200BP_USD,USD_PV01 * 200) END) AS SLIDE_IR_PLS_200BP_USD from ( select a.POSITION_ID, a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME, SUM(COALESCE((USD_IR_UNIFIED_PV01) :: numeric(15,5), 0)) AS USD_PV01, SUM ((a.SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_200BP_USD, SUM ((a.SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_100BP_USD from cdwuser.u_dm_wm_position a WHERE A.COB_DATE in ( '2017-07-31', '2017-06-30', '2017-05-31', '2015-12-31' ) AND A.CCC_TAPS_COMPANY = '1633' AND (A.VAR_EXCL_FL<> 'Y' OR A.BOOK IN ('MSDPB3M','MSDPT3M')) AND (A.ccc_banking_trading = 'BANKING' OR (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') or a.CCC_business_area = 'US BANKS-LIQUIDITY' ) AND A.PRODUCT_TYPE_CODE ='REPO' AND A.CCC_BUSINESS_AREA NOT IN ('NON CORE MARKETS','CORE MARKETS')) group by a.POSITION_ID, a.COB_DATE, a.ACCOUNT, a.CCC_PRODUCT_LINE, a.VERTICAL_SYSTEM, a.BOOK, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME ) A GROUP BY a.COB_DATE