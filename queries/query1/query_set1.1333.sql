SELECT CUR.RANK || '_' || CUR.RANK_NAME AS CONCENTRATION, CUR.PRODUCT_DESCRIPTION, CUR.TICK, coalesce(CUR.DELTA,0) AS KAPPA_COB, coalesce(PREV.DELTA,0) AS KAPPA_COMP, coalesce(CUR.DELTA,0) - coalesce(PREV.DELTA,0) AS KAPPA_DOD, CUR.DESK FROM CDWUSER.U_DM_CONC CUR LEFT OUTER JOIN CDWUSER.U_DM_CONC PREV ON CUR.RANK_TYPE = PREV.RANK_TYPE AND CUR.RANK_NAME = PREV.RANK_NAME AND CUR.PRODUCT_DESCRIPTION = PREV.PRODUCT_DESCRIPTION AND CUR.TICK = PREV.TICK AND PREV.RANK_TYPE = 'NRAMV' AND (PREV.COB_DATE = '2018-02-21') WHERE CUR.RANK_TYPE = 'NRAMV' AND (CUR.COB_DATE = '2018-02-28') AND CUR.RANK <= 15 ORDER BY CUR.RANK_NAME, CUR.RANK