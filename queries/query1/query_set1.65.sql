SELECT     COB_DATE,     CASE         WHEN CAST(SUBSTRING(TIME_BUCKET_ANNUAL,LENGTH(TIME_BUCKET_ANNUAL)-1,2) AS DOUBLE PRECISION) > 19         THEN 20     ELSE CAST(SUBSTRING(TIME_BUCKET_ANNUAL,LENGTH(TIME_BUCKET_ANNUAL)-1,2) AS DOUBLE PRECISION) END AS HELP_TIME_BUCKET_ANNUAL,     CASE          WHEN CAST(SUBSTRING(TIME_BUCKET_ANNUAL,LENGTH(TIME_BUCKET_ANNUAL)-1,2) AS DOUBLE PRECISION)= 18         AND (product_sub_type_name IN ('STORAGE RELET','STORAGE CONTRACT') AND COB_DATE >= EXPIRATION_DATE AND BU_RISK_RUN_CUSTOM1 = 'STORAGE' OR                 product_sub_type_name IN ('FLEXDEAL','P_TANK-T','PHYSICAL INVENTORY') AND BU_RISK_RUN_CUSTOM1 <> 'STORAGE')  THEN 'TANK'     ELSE 'NOTANK' END AS TANK,     CASE          WHEN product_type_code = 'CRUDE' THEN prod_pos_name_description         WHEN product_type_code IN ('DIST','JET') THEN CMDTY_CD         WHEN product_type_code = 'ETHANOL' THEN 'Ethanol'         WHEN product_type_code = 'GAS' THEN 'Gasoline'         WHEN (product_type_code = 'NGL' AND job_cmdty_code = 'PROPANESCP') THEN 'Propane'         WHEN (product_type_code = 'NGL' AND job_cmdty_code = 'BUTANE A KMI') THEN 'Butane'         WHEN (product_type_code = 'NGL' AND CMDTY_CD IS NOT NULL) THEN CMDTY_CD     END AS sectype,     CASE          WHEN product_type_code IN ('DIST','JET') THEN 'Distillate'         WHEN product_type_code IN ('FUEL','GAS','CRUDE','NAPHTHA','ETHANOL','NGL') THEN product_type_code         WHEN product_type_code IN ('CLEAN FREIGHT','DIRTY FREIGHT') THEN 'Freight'     END AS asset_type,     SUM(RAW_CM_Delta) AS RAW_CM_Delta,     SUM(USD_CM_Delta) AS USD_CM_Delta FROM     cdwuser.U_CM_MSR a WHERE  (a.COB_DATE = '2018-02-28' or a.COB_DATE = '2018-02-21') and     CCC_DIVISION = 'FIXED INCOME DIVISION' AND     CCC_BUSINESS_AREA = 'COMMODITIES' AND     CCC_PRODUCT_LINE = 'OIL & PRODUCTS' AND     /* CCC_TRD_BOOK <> 'DEVELOPMENT' AND*/  A.CCC_PL_REPORTING_REGION in ('ASIA PACIFIC') AND      /*CCC_BANKING_TRADING='TRADING' AND*/     a.product_type_code NOT IN ('CLEAN FREIGHT','DIRTY FREIGHT') AND     /* AND (a.PRODUCT_TYPE_CODE IN ('BONDFUT','BONDFUTOPT')     OR (a.VAR_EXCL_FL <> 'Y' AND a.MEASURE_VAR_EXCL_FL <> 'Y')) */     A.BU_RISK_RUN_CUSTOM1<>'STORAGE' GROUP BY     COB_DATE,     CASE          WHEN ( CAST(SUBSTRING(TIME_BUCKET_ANNUAL,LENGTH(TIME_BUCKET_ANNUAL)-1,2) AS DOUBLE PRECISION)= 18         AND (product_sub_type_name IN ('STORAGE RELET','STORAGE CONTRACT') AND COB_DATE >= EXPIRATION_DATE AND BU_RISK_RUN_CUSTOM1 = 'STORAGE' OR                 product_sub_type_name IN ('FLEXDEAL','P_TANK-T','PHYSICAL INVENTORY') AND BU_RISK_RUN_CUSTOM1 <> 'STORAGE'))  THEN 'TANK'     ELSE 'NOTANK' END,     CASE          WHEN product_type_code = 'CRUDE' THEN prod_pos_name_description         WHEN product_type_code IN ('DIST','JET') THEN CMDTY_CD         WHEN product_type_code = 'ETHANOL' THEN 'Ethanol'         WHEN product_type_code = 'GAS' THEN 'Gasoline'         WHEN (product_type_code = 'NGL' AND job_cmdty_code = 'PROPANESCP') THEN 'Propane'         WHEN (product_type_code = 'NGL' AND job_cmdty_code = 'BUTANE A KMI') THEN 'Butane'         WHEN (product_type_code = 'NGL' AND CMDTY_CD IS NOT NULL) THEN CMDTY_CD     END,     CASE          WHEN product_type_code IN ('DIST','JET') THEN 'Distillate'         WHEN product_type_code IN ('FUEL','GAS','CRUDE','NAPHTHA','ETHANOL','NGL') THEN product_type_code         WHEN product_type_code IN ('CLEAN FREIGHT','DIRTY FREIGHT') THEN 'Freight'     END,     CASE         WHEN (CAST(SUBSTRING(TIME_BUCKET_ANNUAL,LENGTH(TIME_BUCKET_ANNUAL)-1,2) AS DOUBLE PRECISION)> 19         ) THEN 20     ELSE CAST(SUBSTRING(TIME_BUCKET_ANNUAL,LENGTH(TIME_BUCKET_ANNUAL)-1,2) AS DOUBLE PRECISION) END