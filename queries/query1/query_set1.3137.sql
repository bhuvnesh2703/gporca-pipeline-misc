SELECT category , CASE WHEN category = 'LIMIT' THEN usd_posn / 2 ELSE usd_posn END AS usd_posn FROM ( SELECT CASE WHEN CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' THEN 'LIMIT' WHEN PRODUCT_TYPE_CODE = 'SWAPTION' THEN 'SWAPTION' WHEN book = 'PBSWA' THEN 'SWAP' END AS category , sum((usd_notional) :: numeric(15,5)) AS usd_posn FROM CDWUSER.U_DM_WM WHERE cob_date = '2018-02-28' AND CCC_TAPS_COMPANY IN ('6635', '5443') AND var_excl_fl <> 'Y' AND ccc_banking_trading = 'BANKING' AND ( CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR PRODUCT_TYPE_CODE = 'SWAPTION' OR book = 'PBSWA' OR CCC_PRODUCT_LINE IN ('HELD FOR INVESTMENT - (HFI)') ) GROUP BY CASE WHEN CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' THEN 'LIMIT' WHEN PRODUCT_TYPE_CODE = 'SWAPTION' THEN 'SWAPTION' WHEN book = 'PBSWA' THEN 'SWAP' END ) a