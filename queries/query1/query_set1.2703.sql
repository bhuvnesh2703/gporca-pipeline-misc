SELECT e.COB_DATE,   case when UNDERLIER_EXCH IN ('z') OR e.CASH_ISSUE_TYPE in ('INDEX') or e.UNDERLIER_TICK || '.' || e.UNDERLIER_EXCH in ('spx.us','spy.p','sptr1.msny','','SPX (g)','itb.p','iyr.p','iyt.p','iyz.p','kbe.p','oih.p','smh.p','xhb.p','xlb.p','xle.p','xlf.p','xli.p','xlk.p','xlp.p','xlu.p','xlv.p','xly.p','xop.p','xrt.p','xme.p','xfn.to','ung.p','uso.p','ibb.q','kre.p','xbi.p')     then 'Index/Sector ETF' else 'Other' end     as Type , case when e.UNDERLIER_TICK || '.' || e.UNDERLIER_EXCH in ('spx.us','spy.p','sptr1.msny') then 'SPX (g)'     else e.UNDERLIER_TICK || '.' || e.UNDERLIER_EXCH end     as Symbol_Posn_UL , case when sum(coalesce(e.USD_THETA_GAMMA,0))<0 then 'Short' else 'Long' end as Long_Short, sum(case when cob_date = '2018-02-28' then coalesce(e.USD_THETA_GAMMA,0) else 0 end) as THETA_GAMMA_COB, sum(case when cob_date = '2018-02-27' then coalesce(e.USD_THETA_GAMMA,0) else 0 end) as THETA_GAMMA_COMP, sum(case when cob_date = '2018-02-28' then coalesce(e.USD_THETA_GAMMA,0) else - (coalesce(e.USD_THETA_GAMMA,0)) end) as THETA_GAMMA_CHANGE from cdwuser.U_EQ_MSR e where e.cob_date IN ('2018-02-28', '2018-02-27') and e.SILO_SRC = 'IED' and e.CCC_BANKING_TRADING = 'TRADING' and e.CCC_DIVISION = 'INSTITUTIONAL EQUITY DIVISION' and e.CCC_STRATEGY = 'SINGLE NAME' and e.CCC_PL_REPORTING_REGION = 'AMERICAS' and abs(e.USD_THETA_GAMMA)>0 group by e.COB_DATE,   case when UNDERLIER_EXCH IN ('z') OR e.CASH_ISSUE_TYPE in ('INDEX') or e.UNDERLIER_TICK || '.' || e.UNDERLIER_EXCH in ('spx.us','spy.p','sptr1.msny','','SPX (g)','itb.p','iyr.p','iyt.p','iyz.p','kbe.p','oih.p','smh.p','xhb.p','xlb.p','xle.p','xlf.p','xli.p','xlk.p','xlp.p','xlu.p','xlv.p','xly.p','xop.p','xrt.p','xme.p','xfn.to','ung.p','uso.p','ibb.q','kre.p','xbi.p')     then 'Index/Sector ETF' else 'Other' end , case when e.UNDERLIER_TICK || '.' || e.UNDERLIER_EXCH in ('spx.us','spy.p','sptr1.msny') then 'SPX (g)'     else e.UNDERLIER_TICK || '.' || e.UNDERLIER_EXCH end