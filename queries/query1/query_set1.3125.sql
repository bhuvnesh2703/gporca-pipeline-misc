SELECT a.COB_DATE, a.CCC_TAPS_COMPANY, a.ACCOUNT, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.term_wm, CASE WHEN ((CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' ) OR (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)') OR BOOK IN ('PLAFL', 'PLAPV') OR BOOK LIKE 'WM_LAL%' OR (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' ) OR A.WM_BANKING_PRODUCT_GROUP = 'Bank Lending') THEN 'Bank Lending' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') or a.WM_BANKING_PRODUCT_GROUP IN ('Liquidity') Then 'Liquidity' WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' ELSE a.WM_BANKING_PRODUCT_GROUP END AS WM_BANKING_PRODUCT_GROUP, CASE WHEN A.BOOK IN ('RPOHJ') THEN 'Repo' WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN (CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' )THEN 'Mortgages (HFI)' WHEN (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)' ) THEN 'Mortgages (HFS)' WHEN BOOK IN ('PLAFL', 'PLAPV')THEN 'PLA' WHEN BOOK LIKE 'WM_LAL%' THEN 'LAL' WHEN (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' )THEN 'Tailored Lending' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') then 'Repo' WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END AS WM_BANKING_PRODUCT_SUB_GROUP, CASE WHEN (CCC_DIVISION IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH', 'CENTRAL PORTFOLIO', 'HELD FOR INVESTMENT - (HFI)', 'HELD FOR SALE - (HFS)', 'TAILORED-BANK', 'TAILORED-NON-BANK', 'PLA-LAL', 'BUSINESSCAPE (C)', 'GLOBAL CURRENCY') AND ccc_strategy IN ('HELD FOR INVESTMENT - (HFI)', 'MSPBNA - VH MORTGAGE') OR ccc_division = 'HELD FOR INVESTMENT - (HFI)') AND product_type_code LIKE 'LOAN%' AND book NOT LIKE '%ORIG%' AND var_excl_fl <> 'Y' THEN BOOK WHEN CCC_BUSINESS_AREA in ('US BANKS-CRA PORTFOLIO') and CCC_TAPS_COMPANY not in ('6635', '1633') THEN BOOK END AS RESI_MTG_BOOK, case when a.WM_BANKING_PRODUCT_SUB_GROUP = 'INTERNAL TRANSFER TRADES' then 'Internal Hedges' else 'n/a' end as Hedges, case when Product_Type_Code in ('BOND') then 'Credit' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit' else 'Other' end as SECTYPE_GROUP, case when Product_Type_Code in ('BOND') then 'Credit Corp' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit ABS' when Product_Type_Code in ('GVTBOND') then 'Treasuries' when Product_Type_Code in ('ABS','AGNCMO','CMBS','RMBS') then 'Agencies' else 'Other' end as SECTYPE_GROUP2, Product_Type_Code, PRODUCT_SUB_TYPE_CODE, CASE WHEN PRODUCT_TYPE_CODE = 'DEPOSIT' THEN (CASE WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-A', 'Tier-6','Tier-A-BAU', 'Tier-6-BAU') THEN 'Tier-A' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-B-BAU', 'Tier-5-BAU','Tier-B', 'Tier-5') THEN 'Tier-B' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-C-BAU', 'Tier-4-BAU','Tier-C', 'Tier-4') THEN 'Tier-C' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-D-BAU', 'Tier-3-BAU','Tier-D', 'Tier-3') THEN 'Tier-D' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-8-BAU','Tier-7-BAU', 'Tier-E-BAU','Tier-8','Tier-7', 'Tier-E') THEN 'Tier-E' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-F-BAU', 'Tier-1-BAU','Tier-F', 'Tier-1') THEN 'Tier-F' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-66-BAU','Tier-66') THEN 'Mgd-A' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-65-BAU','Tier-65') THEN 'Mgd-B' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-64','Tier-64-BAU') THEN 'Mgd-C' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-63','Tier-63-BAU') THEN 'Mgd-D' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-67', 'Tier-52', 'Tier-G','Tier-67-BAU', 'Tier-52-BAU', 'Tier-G-BAU') THEN 'Mgd-E' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-61', 'Tier-51', 'Tier-J','Tier-61-BAU', 'Tier-51-BAU', 'Tier-J-BAU') THEN 'Mgd-F' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-H', 'Tier-914','Tier-H-BAU', 'Tier-914-BAU') THEN 'Tier-H' ELSE 'OTHER' END) ELSE 'n/a' END AS TIER, TERM_BUCKET, case when TERM_BUCKET_AGGR in ('5-7Y','7-10Y') then '5-10Y' else TERM_BUCKET_AGGR end as TERM_BUCKET_AGGR, a.MRD_RATING, CCC_Product_line, SUM(COALESCE(((USD_IR_KAPPA) :: numeric(15,5)), 0)/10) AS USD_KAPPA, SUM(COALESCE(((USD_IR_UNIFIED_PV01) :: numeric(15,5)), 0)) AS USD_PV01, SUM(COALESCE(((USD_PV01SPRD) :: numeric(15,5)),0)) AS usd_pv01sprd, SUM(COALESCE(((USD_NOTIONAL) :: numeric(15,5)),0))/1000 as usd_notional, sum(COALESCE(((USD_EXPOSURE) :: numeric(15,5)), 0)) / 1000 AS USD_EXPOSURE, sum(COALESCE(((USD_PROCEED) :: numeric(15,5)), 0)) / 1000 AS MV, sum(COALESCE(((USD_PV10_BENCH) :: numeric(15,5)), 0))/1000 as USD_PV10_BENCH, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)),0) ELSE COALESCE(((SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * - 100) END) AS SLIDE_IR_MIN_100BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_MIN_200BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_MIN_200BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * - 200) END) AS SLIDE_IR_MIN_200BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_MIN_300BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_MIN_300BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * - 300) END) AS SLIDE_IR_MIN_300BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_MIN_50BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_MIN_50BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * - 50) END) AS SLIDE_IR_MIN_50BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_PLS_50BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_PLS_50BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * 50) END) AS SLIDE_IR_PLS_50BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_PLS_100BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_PLS_100BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * 100) END) AS SLIDE_IR_PLS_100BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * 200) END) AS SLIDE_IR_PLS_200BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_PLS_300BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_PLS_300BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * 300) END) AS SLIDE_IR_PLS_300BP_USD FROM CDWUSER.U_DM_WM_POSITION A WHERE COB_DATE in ( '2017-07-31', '2015-12-31' ) AND (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') or a.WM_BANKING_PRODUCT_SUB_GROUP in ('Cash')) AND (A.VAR_EXCL_FL<> 'Y' OR A.BOOK IN ('MSDPB3M','MSDPT3M')) group by a.COB_DATE, A.CCC_TAPS_COMPANY, a.ACCOUNT, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.term_wm, CASE WHEN ((CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' ) OR (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)') OR BOOK IN ('PLAFL', 'PLAPV') OR BOOK LIKE 'WM_LAL%' OR (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' ) OR A.WM_BANKING_PRODUCT_GROUP = 'Bank Lending') THEN 'Bank Lending' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') or a.WM_BANKING_PRODUCT_GROUP IN ('Liquidity') Then 'Liquidity' WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' ELSE a.WM_BANKING_PRODUCT_GROUP END, CASE WHEN A.BOOK IN ('RPOHJ') THEN 'Repo' WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN (CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' )THEN 'Mortgages (HFI)' WHEN (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)' ) THEN 'Mortgages (HFS)' WHEN BOOK IN ('PLAFL', 'PLAPV')THEN 'PLA' WHEN BOOK LIKE 'WM_LAL%' THEN 'LAL' WHEN (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' )THEN 'Tailored Lending' when account in ('070008AG2', '0700089Z2', '0700ERR44','070008AG2', '0700089Z2') or book in ('RPOHJ', 'RPOHC') then 'Repo' WHEN BOOK IN ('DPSWA', 'DPTSW', 'IPBSW', 'IPTSW', 'PLSWA', 'RPOFO','RPOHA', 'RPOHD', 'RPOHK', 'RPOHM', 'RPOHO', 'TL2SW','RPOHE', 'RPOHB', 'RPOHF', 'RPOHG', 'RPOHH') THEN 'INTERNAL TRANSFER TRADES' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END, CASE WHEN (CCC_DIVISION IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH', 'CENTRAL PORTFOLIO', 'HELD FOR INVESTMENT - (HFI)', 'HELD FOR SALE - (HFS)', 'TAILORED-BANK', 'TAILORED-NON-BANK', 'PLA-LAL', 'BUSINESSCAPE (C)', 'GLOBAL CURRENCY') AND ccc_strategy IN ('HELD FOR INVESTMENT - (HFI)', 'MSPBNA - VH MORTGAGE') OR ccc_division = 'HELD FOR INVESTMENT - (HFI)') AND product_type_code LIKE 'LOAN%' AND book NOT LIKE '%ORIG%' AND var_excl_fl <> 'Y' THEN BOOK WHEN CCC_BUSINESS_AREA in ('US BANKS-CRA PORTFOLIO') and CCC_TAPS_COMPANY not in ('6635', '1633') THEN BOOK END, case when a.WM_BANKING_PRODUCT_SUB_GROUP = 'INTERNAL TRANSFER TRADES' then 'Internal Hedges' else 'n/a' end, case when Product_Type_Code in ('BOND') then 'Credit' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit' else 'Other' end, case when Product_Type_Code in ('BOND') then 'Credit Corp' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit ABS' when Product_Type_Code in ('GVTBOND') then 'Treasuries' when Product_Type_Code in ('ABS','AGNCMO','CMBS','RMBS') then 'Agencies' else 'Other' end, Product_Type_Code, case when TERM_BUCKET_AGGR in ('5-7Y','7-10Y') then '5-10Y' else TERM_BUCKET_AGGR end, a.MRD_RATING, PRODUCT_SUB_TYPE_CODE, CASE WHEN PRODUCT_TYPE_CODE = 'DEPOSIT' THEN (CASE WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-A', 'Tier-6','Tier-A-BAU', 'Tier-6-BAU') THEN 'Tier-A' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-B-BAU', 'Tier-5-BAU','Tier-B', 'Tier-5') THEN 'Tier-B' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-C-BAU', 'Tier-4-BAU','Tier-C', 'Tier-4') THEN 'Tier-C' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-D-BAU', 'Tier-3-BAU','Tier-D', 'Tier-3') THEN 'Tier-D' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-8-BAU','Tier-7-BAU', 'Tier-E-BAU','Tier-8','Tier-7', 'Tier-E') THEN 'Tier-E' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-F-BAU', 'Tier-1-BAU','Tier-F', 'Tier-1') THEN 'Tier-F' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-66-BAU','Tier-66') THEN 'Mgd-A' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-65-BAU','Tier-65') THEN 'Mgd-B' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-64','Tier-64-BAU') THEN 'Mgd-C' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-63','Tier-63-BAU') THEN 'Mgd-D' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-67', 'Tier-52', 'Tier-G','Tier-67-BAU', 'Tier-52-BAU', 'Tier-G-BAU') THEN 'Mgd-E' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-61', 'Tier-51', 'Tier-J','Tier-61-BAU', 'Tier-51-BAU', 'Tier-J-BAU') THEN 'Mgd-F' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-H', 'Tier-914','Tier-H-BAU', 'Tier-914-BAU') THEN 'Tier-H' ELSE 'OTHER' END) ELSE 'n/a' END, TERM_BUCKET, CCC_Product_line UNION ALL SELECT a.COB_DATE, a.CCC_TAPS_COMPANY, a.ACCOUNT, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.term_wm, CASE WHEN WM_BANKING_PRODUCT_SUB_GROUP IN ('Mortgages (HFI)', 'PLA','Tailored Lending', 'Mortgages (HFS)', 'Swaption', 'IR Futures', 'Option on Futures') OR BOOK IN ('CREF_FIXED', 'CREF_FLOAT', 'CREF_RLCK') OR BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'BANK LENDING' else a.WM_BANKING_PRODUCT_GROUP end as WM_BANKING_PRODUCT_GROUP, CASE WHEN BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'LAL' WHEN BOOK IN ('CREF_FIXED', 'CREF_FLOAT', 'CREF_RLCK') THEN 'CRE Financing' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END AS WM_BANKING_PRODUCT_SUB_GROUP, CASE WHEN (ccc_division IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH') AND ccc_business_area IN ('MSCC MORTGAGE LOAN ORIGINATIONS-GWMG')) AND var_excl_fl <> 'Y' AND CCC_STRATEGY LIKE ('%LOAN RISK MANAGEMENT - HTM') THEN BOOK WHEN CCC_BUSINESS_AREA IN ('US BANKS-CRA PORTFOLIO') AND CCC_TAPS_COMPANY NOT IN ('6635', '1633') THEN BOOK END AS RESI_MTG_BOOK, case when a.WM_BANKING_PRODUCT_SUB_GROUP = 'INTERNAL TRANSFER TRADES' then 'Internal Hedges' else 'n/a' end as Hedges, case when Product_Type_Code in ('BOND') then 'Credit' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit' else 'Other' end as SECTYPE_GROUP, case when Product_Type_Code in ('BOND') then 'Credit Corp' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit ABS' when Product_Type_Code in ('GVTBOND') then 'Treasuries' when Product_Type_Code in ('ABS','AGNCMO','CMBS','RMBS') then 'Agencies' else 'Other' end as SECTYPE_GROUP2, Product_Type_Code, PRODUCT_SUB_TYPE_CODE, CASE WHEN PRODUCT_TYPE_CODE = 'DEPOSIT' THEN (CASE WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-A', 'Tier-6','Tier-A-BAU', 'Tier-6-BAU') THEN 'Tier-A' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-B-BAU', 'Tier-5-BAU','Tier-B', 'Tier-5') THEN 'Tier-B' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-C-BAU', 'Tier-4-BAU','Tier-C', 'Tier-4') THEN 'Tier-C' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-D-BAU', 'Tier-3-BAU','Tier-D', 'Tier-3') THEN 'Tier-D' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-8-BAU','Tier-7-BAU', 'Tier-E-BAU','Tier-8','Tier-7', 'Tier-E') THEN 'Tier-E' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-F-BAU', 'Tier-1-BAU','Tier-F', 'Tier-1') THEN 'Tier-F' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-66-BAU','Tier-66') THEN 'Mgd-A' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-65-BAU','Tier-65') THEN 'Mgd-B' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-64','Tier-64-BAU') THEN 'Mgd-C' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-63','Tier-63-BAU') THEN 'Mgd-D' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-67', 'Tier-52', 'Tier-G','Tier-67-BAU', 'Tier-52-BAU', 'Tier-G-BAU') THEN 'Mgd-E' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-61', 'Tier-51', 'Tier-J','Tier-61-BAU', 'Tier-51-BAU', 'Tier-J-BAU') THEN 'Mgd-F' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-H', 'Tier-914','Tier-H-BAU', 'Tier-914-BAU') THEN 'Tier-H' ELSE 'OTHER' END) ELSE 'n/a' END AS TIER, TERM_BUCKET, case when TERM_BUCKET_AGGR in ('5-7Y','7-10Y') then '5-10Y' else TERM_BUCKET_AGGR end as TERM_BUCKET_AGGR, a.MRD_RATING, CCC_Product_line, SUM(COALESCE(((USD_IR_KAPPA) :: numeric(15,5)), 0)/10) AS USD_KAPPA, SUM(COALESCE(((USD_IR_UNIFIED_PV01) :: numeric(15,5)), 0)) AS USD_PV01, SUM(COALESCE(((USD_PV01SPRD) :: numeric(15,5)),0)) AS usd_pv01sprd, SUM(COALESCE(((USD_NOTIONAL) :: numeric(15,5)),0))/1000 as usd_notional, sum(COALESCE(((USD_EXPOSURE) :: numeric(15,5)), 0)) / 1000 AS USD_EXPOSURE, sum(COALESCE(((USD_PROCEED) :: numeric(15,5)), 0)) / 1000 AS MV, sum(COALESCE(((USD_PV10_BENCH) :: numeric(15,5)), 0))/1000 as USD_PV10_BENCH, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)),0) ELSE COALESCE(((SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * - 100) END) AS SLIDE_IR_MIN_100BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_MIN_200BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_MIN_200BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * - 200) END) AS SLIDE_IR_MIN_200BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_MIN_300BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_MIN_300BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * - 300) END) AS SLIDE_IR_MIN_300BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_MIN_50BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_MIN_50BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * - 50) END) AS SLIDE_IR_MIN_50BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_PLS_50BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_PLS_50BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * 50) END) AS SLIDE_IR_PLS_50BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_PLS_100BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_PLS_100BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * 100) END) AS SLIDE_IR_PLS_100BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * 200) END) AS SLIDE_IR_PLS_200BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (((SLIDE_IR_PLS_300BP_USD) :: numeric(15,5)),0) ELSE COALESCE (((SLIDE_IR_PLS_300BP_USD) :: numeric(15,5)), ((USD_PV01) :: numeric(15,5)) * 300) END) AS SLIDE_IR_PLS_300BP_USD FROM CDWUSER.U_DM_WM_POSITION A WHERE COB_DATE in ( '2018-02-28', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31', '2017-09-29', '2017-08-31', '2015-12-31' ) AND (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') or a.WM_BANKING_PRODUCT_SUB_GROUP in ('Cash')) AND (A.VAR_EXCL_FL<> 'Y' OR A.BOOK IN ('MSDPB3M','MSDPT3M')) group by a.COB_DATE, A.CCC_TAPS_COMPANY, a.ACCOUNT, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.term_wm, CASE WHEN WM_BANKING_PRODUCT_SUB_GROUP IN ('Mortgages (HFI)', 'PLA','Tailored Lending', 'Mortgages (HFS)', 'Swaption', 'IR Futures', 'Option on Futures') OR BOOK IN ('CREF_FIXED', 'CREF_FLOAT', 'CREF_RLCK') OR BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'BANK LENDING' else a.WM_BANKING_PRODUCT_GROUP end, CASE WHEN BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'LAL' WHEN BOOK IN ('CREF_FIXED', 'CREF_FLOAT', 'CREF_RLCK') THEN 'CRE Financing' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END, CASE WHEN (ccc_division IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH') AND ccc_business_area IN ('MSCC MORTGAGE LOAN ORIGINATIONS-GWMG')) AND var_excl_fl <> 'Y' AND CCC_STRATEGY LIKE ('%LOAN RISK MANAGEMENT - HTM') THEN BOOK WHEN CCC_BUSINESS_AREA IN ('US BANKS-CRA PORTFOLIO') AND CCC_TAPS_COMPANY NOT IN ('6635', '1633') THEN BOOK END, case when a.WM_BANKING_PRODUCT_SUB_GROUP = 'INTERNAL TRANSFER TRADES' then 'Internal Hedges' else 'n/a' end, case when Product_Type_Code in ('BOND') then 'Credit' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit' else 'Other' end, case when Product_Type_Code in ('BOND') then 'Credit Corp' when Product_Type_Code in ('ABS','CDO_CASH','CLO','CMBS') and PRODUCT_SUB_TYPE_CODE not in ('FHLMC','FNMA','GNMA','STU_LOAN','STU_LOAN_FFELP', 'FHLMC_SENIOR', 'STU_LOAN_PVT') then 'Credit ABS' when Product_Type_Code in ('GVTBOND') then 'Treasuries' when Product_Type_Code in ('ABS','AGNCMO','CMBS','RMBS') then 'Agencies' else 'Other' end, Product_Type_Code, case when TERM_BUCKET_AGGR in ('5-7Y','7-10Y') then '5-10Y' else TERM_BUCKET_AGGR end, a.MRD_RATING, PRODUCT_SUB_TYPE_CODE, CASE WHEN PRODUCT_TYPE_CODE = 'DEPOSIT' THEN (CASE WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-A', 'Tier-6','Tier-A-BAU', 'Tier-6-BAU') THEN 'Tier-A' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-B-BAU', 'Tier-5-BAU','Tier-B', 'Tier-5') THEN 'Tier-B' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-C-BAU', 'Tier-4-BAU','Tier-C', 'Tier-4') THEN 'Tier-C' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-D-BAU', 'Tier-3-BAU','Tier-D', 'Tier-3') THEN 'Tier-D' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-8-BAU','Tier-7-BAU', 'Tier-E-BAU','Tier-8','Tier-7', 'Tier-E') THEN 'Tier-E' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-F-BAU', 'Tier-1-BAU','Tier-F', 'Tier-1') THEN 'Tier-F' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-66-BAU','Tier-66') THEN 'Mgd-A' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-65-BAU','Tier-65') THEN 'Mgd-B' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-64','Tier-64-BAU') THEN 'Mgd-C' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-63','Tier-63-BAU') THEN 'Mgd-D' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-67', 'Tier-52', 'Tier-G','Tier-67-BAU', 'Tier-52-BAU', 'Tier-G-BAU') THEN 'Mgd-E' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-61', 'Tier-51', 'Tier-J','Tier-61-BAU', 'Tier-51-BAU', 'Tier-J-BAU') THEN 'Mgd-F' WHEN BANKING_PRODUCT_DESCRIPTION IN ('Tier-H', 'Tier-914','Tier-H-BAU', 'Tier-914-BAU') THEN 'Tier-H' ELSE 'OTHER' END) ELSE 'n/a' END, TERM_BUCKET, CCC_Product_line