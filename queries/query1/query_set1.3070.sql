SELECT cob_date, sum(case when CCC_STRATEGY = 'HFI HEDGES' then usd_posn end) as HFI_HEDGE_NOTIONAL, sum(case when category = 'LIMIT' then usd_posn / 2 end) as Limit, sum(case when PRODUCT_TYPE_CODE IN ('BONDFUT', 'RATEFUT') AND CCC_STRATEGY = 'HFI HEDGES' then usd_posn end) ::numeric(15,5) as Treasury_Bond_Futures, sum(case when PRODUCT_TYPE_CODE IN ('CAP', 'FLOOR', 'SWAPTION', 'BONDFUTOPT', 'RATEFUTOPT') AND CCC_STRATEGY = 'HFI HEDGES' then usd_posn end) ::numeric(15,5) as Option_Products, sum(case when PRODUCT_TYPE_CODE IN ('SWAP', 'BONDFUT', 'RATEFUT') AND CCC_STRATEGY = 'HFI HEDGES' then usd_posn end) ::numeric(15,5) as Linear_Products FROM ( SELECT cob_date, case when CCC_STRATEGY in ('HELD FOR INVESTMENT - (HFI)') or CCC_DIVISION IN ('HELD FOR INVESTMENT - (HFI)') THEN 'LIMIT' when PRODUCT_TYPE_CODE = 'SWAPTION' then'SWAPTION' when book = 'PBSWA' then 'SWAP' end as category, PRODUCT_TYPE_CODE, CCC_STRATEGY, abs(sum(usd_notional)) ::numeric(15,5) as usd_posn FROM cdwuser.U_DM_WM WHERE cob_date in ( '2018-02-28' ) AND CCC_TAPS_COMPANY in ('6635','5443') AND var_excl_fl <> 'Y' AND ccc_banking_trading = 'BANKING' GROUP BY cob_date, case when CCC_STRATEGY in ('HELD FOR INVESTMENT - (HFI)') or CCC_DIVISION IN ('HELD FOR INVESTMENT - (HFI)') THEN 'LIMIT' when PRODUCT_TYPE_CODE = 'SWAPTION' then'SWAPTION' when book = 'PBSWA' then 'SWAP' end, PRODUCT_TYPE_CODE, CCC_STRATEGY ) a GROUP BY cob_date