Select COB_DATE, CASE WHEN CCC_BUSINESS_AREA = 'COMMODITIES' THEN CCC_PRODUCT_LINE ELSE CCC_BUSINESS_AREA END AS CCC_BUSINESS_AREA, CCC_TAPS_COMPANY, PRODUCT_TYPE_CODE, SUM(cast(USD_CM_DELTA as numeric(15,5))) as DELTA, case when PRODUCT_TYPE_CODE in ('EAST PEAK','EAST OFF','WEST PEAK','WEST OFF','MIDWEST PEAK','MIDWEST OFF','GRNPWR PEAK','GRNPWR OFF','TEXAS PEAK','TEXAS OFF') then 'NA POWER' when PRODUCT_TYPE_CODE in ('NATGAS') then 'NA NATGAS' when PRODUCT_TYPE_CODE in ('EURO PWR','EURO PWR SPREAD') then 'EU POWER' when PRODUCT_TYPE_CODE in ('EUR NG') then 'EU NATGAS' when PRODUCT_TYPE_CODE in ('CRUDE','NGL','DIST','GAS','FUEL','ETHANOL','JET','GASOLINE CREDITS','NAPHTHA') then 'OIL PRODUCTS' when PRODUCT_TYPE_CODE in ('BASEMETAL','PRECIOUSMETAL') then 'METALS' else 'OTHER' end as PRODUCT_TYPE_BUCKET FROM cdwuser.U_CM_MSR Where COB_DATE IN ('2018-02-28','2018-02-21') AND ((CCC_DIVISION IN ('COMMODITIES')) /*OLD LOGIC*/ OR (CCC_DIVISION = 'FIXED INCOME DIVISION' AND CCC_BUSINESS_AREA = 'COMMODITIES')) /*NEW LOGIC*/ AND (CCC_PL_REPORTING_REGION IN ('EUROPE','EMEA')) GROUP BY COB_DATE, CASE WHEN CCC_BUSINESS_AREA = 'COMMODITIES' THEN CCC_PRODUCT_LINE ELSE CCC_BUSINESS_AREA END, CCC_TAPS_COMPANY, PRODUCT_TYPE_CODE