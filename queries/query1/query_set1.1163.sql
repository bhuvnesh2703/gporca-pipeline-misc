SELECT a.CCC_DIVISION,a.PAYOFF_MODEL,CASE WHEN a.CCC_TAPS_COMPANY_NAME IN ('MORGAN STANLEY & CO. INTERNATIONAL PLC') THEN 'MSIP' else a.CCC_TAPS_COMPANY_NAME end as CCC_TAPS_COMPANY_NAME,a.PRODUCT_DESCRIPTION, a.VERTICAL_SYSTEM,a.CCC_PL_REPORTING_REGION, a.COB_DATE, a.CURRENCY_OF_MEASURE, case when a.CURRENCY_OF_MEASURE IN ('EUR','USD','JPY') then a.CURRENCY_OF_MEASURE else 'Others' end as CURRENCY_OF_MEASURE2, case when a.TERM_BUCKET in ('0-0.083Y','0.75-1Y','0.5-0.75Y','0.083-0.25Y','1-2Y','0.5-1Y','0.25-0.5Y','0-0.25Y','-0') then '0-2Y' when a.TERM_BUCKET in ('2-3Y','3-5Y','8-10Y','7-8Y','5-7Y','2-5Y') then '2-10Y' when a.TERM_BUCKET in ('25-30Y','20-25Y','15-20Y','12-15Y','10-12Y') then '10-30Y' when a.TERM_BUCKET in ('75+Y','60-75Y','50-60Y','40-50Y','30-40Y') then '30Y+' ELSE 'MISMAPPED' end as TERM_BUCKET, case when a.PRODUCT_HIERARCHY_LEVEL7 = 'UNDEFINED' then a.EXECUTIVE_MODEL WHEN a.EXECUTIVE_MODEL = 'UNDEFINED' THEN a.BASE_MODEL_NAME ELSE a.EXECUTIVE_MODEL END as PH7 ,a.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, a.PRODUCT_TYPE_CODE, a.LE_GROUP, a.CCC_PL_REPORTING_REGION, sum(coalesce(a.USD_DELTA,0)) as USD_DELTA, sum(coalesce(a.USD_EQ_KAPPA,0)) as USD_EQ_KAPPA, sum((case when currency_of_measure not in ('USD', 'UBD') then coalesce(a.usd_fx,0) else 0 end))as USD_FX_DELTA, sum((case when (currency_of_measure not in ('USD', 'UBD')AND a.COB_Date in ('2018-02-28') ) then coalesce(a.usd_fx,0) else 0 end))as USD_FX_DELTAcob, sum(coalesce(a.USD_FX_KAPPA,0)) as USD_FX_KAPPA, sum(Case when a.COB_Date in ('2018-02-28') then coalesce(a.USD_FX_KAPPA,0)else 0 end) as USD_FX_KAPPAcob, sum(coalesce(a.USD_IR_THETA,0) )as IR_THETA, sum(coalesce(a.USD_FX_THETA,0) )as FX_THETA, sum(coalesce(a.USD_CR_KAPPA,0) )as CR_VEGA, sum(usd_notional) as FaceNotional, sum(coalesce(a.USD_EXPOSURE,0)) as USD_EXPOSURE, sum( case when (account like '07%' AND a.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME like '%MORGAN STANLEY%') then coalesce(A.USD_PV10_BENCH,a.USD_CREDIT_PV10PCT) else 0 end ) as USD_PV10, sum( case when a.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME not like '%MORGAN STANLEY%' then coalesce(A.USD_PV10_BENCH,a.USD_CREDIT_PV10PCT) else 0 end ) as NNMSUSD_PV10, sum( Case when a.COB_Date in ('2018-02-28') then coalesce(A.USD_PV10_BENCH,a.USD_CREDIT_PV10PCT) else 0 end) as USD_PV10cob, sum(coalesce(a.USD_IR_UNIFIED_PV01,0)) as USD_IR_UNIFIED_PV01, sum( Case when a.COB_Date in ('2018-02-28') then coalesce(a.USD_IR_UNIFIED_PV01,0) else 0 end) as USD_IR_UNIFIED_PV01cob, sum(coalesce(a.USD_IR_KAPPA,0))/10 as USD_IR_KAPPA, sum(Case when a.COB_Date in ('2018-02-28') then coalesce(a.USD_IR_KAPPA,0)else 0 end) as USD_IR_KAPPAcob, sum(case when ( account like '07%' AND a.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME like '%MORGAN STANLEY%') then A.USD_PV01SPRD else 0 end) as SP01, sum(case when a.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME not like '%MORGAN STANLEY%' then A.USD_PV01SPRD else 0 end) as NNMSSP01, SUM (a.usd_theta_gamma) AS theta_gamma, SUM (COALESCE (a.SLIDE_EQ_MIN_30_USD, 0)) AS D30, SUM (COALESCE (a.SLIDE_EQ_MIN_20_USD,0))AS D20, SUM (COALESCE (a.SLIDE_EQ_MIN_10_USD, 0)) AS D10, SUM (COALESCE (a.SLIDE_EQ_MIN_05_USD,0)) AS D5, SUM (COALESCE (a.SLIDE_EQ_PLS_05_USD,0)) AS P5, SUM (COALESCE (a.SLIDE_EQ_PLS_10_USD,0)) AS P10, SUM (COALESCE (a.SLIDE_EQ_PLS_20_USD, 0)) AS P20 FROM CDWUSER.U_EXP_MSR a WHERE a.COB_DATE IN ('2018-01-31','2018-02-28','2018-02-27') and (a.CCC_DIVISION='FID DVA' OR a.CCC_DIVISION='FIC DVA' OR A.CCC_STRATEGY='MS DVA STR NOTES IED') GROUP BY a.CCC_DIVISION,a.PAYOFF_MODEL,a.CCC_TAPS_COMPANY_NAME,a.PRODUCT_DESCRIPTION,a.VERTICAL_SYSTEM,a.CCC_PL_REPORTING_REGION, a.COB_DATE, a.CURRENCY_OF_MEASURE, case when a.TERM_BUCKET in ('0-0.083Y','0.75-1Y','0.5-0.75Y','0.083-0.25Y','1-2Y','0.5-1Y','0.25-0.5Y','0-0.25Y','-0') then '0-2Y' when a.TERM_BUCKET in ('2-3Y','3-5Y','8-10Y','7-8Y','5-7Y','2-5Y') then '2-10Y' when a.TERM_BUCKET in ('25-30Y','20-25Y','15-20Y','12-15Y','10-12Y') then '10-30Y' when a.TERM_BUCKET in ('75+Y','60-75Y','50-60Y','40-50Y','30-40Y') then '30Y+' ELSE 'MISMAPPED' end, case when a.PRODUCT_HIERARCHY_LEVEL7 = 'UNDEFINED' then a.EXECUTIVE_MODEL WHEN a.EXECUTIVE_MODEL = 'UNDEFINED' THEN a.BASE_MODEL_NAME ELSE a.EXECUTIVE_MODEL END,a.POSITION_ULT_ISSUER_PARTY_DARWIN_NAME, a.PRODUCT_TYPE_CODE, a.LE_GROUP, a.CCC_PL_REPORTING_REGION