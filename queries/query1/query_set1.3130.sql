SELECT cob_date, Product_Type_Code, coalesce(usd_net_exposure, 0) as usd_net_exposure, coalesce(market_value, 0) as market_value, coalesce(gross_market_value, 0) as gross_market_value, coalesce(gross_notional, 0) as gross_notional, coalesce(notional, 0) as notional, coalesce(usd_gamma, 0) as usd_gamma, coalesce(usd_fx_kappa, 0) as usd_fx_kappa, coalesce(eq_delta, 0) as eq_delta, coalesce(usd_pv01sprd, 0) as usd_pv01sprd, coalesce(usd_pv01, 0) as usd_pv01, coalesce(usd_kappa, 0) as usd_kappa, coalesce(usd_cr_kappa, 0) as usd_cr_kappa, coalesce(usd_fx, 0) as usd_fx, LONG_SHORT, ABS(coalesce(usd_net_exposure, 0))+ABS(coalesce(market_value, 0))+ABS(coalesce(gross_market_value, 0))+ABS(coalesce(gross_notional, 0))+ABS(coalesce(notional, 0))+ABS(coalesce(usd_gamma, 0))+ABS(coalesce(usd_fx_kappa, 0))+ ABS(coalesce(eq_delta, 0))+ABS(coalesce(usd_pv01sprd, 0))+ABS(coalesce(usd_pv01, 0))+ABS(coalesce(usd_kappa, 0))+ABS(coalesce(usd_cr_kappa, 0))+ABS(coalesce(usd_fx, 0)) AS SUM_MEASURES from ( SELECT cob_date, Product_Type_Code, sum(usd_net_exposure) as usd_net_exposure, sum(coalesce(market_value, 0)) as market_value, sum(coalesce(gross_market_value, 0)) as gross_market_value, sum(coalesce(gross_notional, 0)) as gross_notional, sum(coalesce(notional, 0)) as notional, sum(coalesce(usd_gamma, 0)) as usd_gamma, sum(coalesce(usd_fx_kappa, 0)) as usd_fx_kappa, sum(coalesce(eq_delta, 0)) as eq_delta, sum(coalesce(usd_pv01sprd, 0)) as usd_pv01sprd, sum(coalesce(usd_pv01,0))as usd_pv01, sum(coalesce(usd_kappa, 0)) as usd_kappa, sum(coalesce(usd_cr_kappa, 0)) as usd_cr_kappa, sum(coalesce(usd_fx, 0)) as usd_fx, LONG_SHORT FROM ( SELECT cob_date, position_id, Product_Type_Code, CCC_Banking_Trading, (usd_exposure) :: numeric(15,5) as usd_net_exposure, (USD_Market_Value) :: numeric(15,5) AS market_value, ABS ((USD_Market_Value) :: numeric(15,5)) AS gross_market_value, ABS ((usd_notional) :: numeric(15,5)) AS gross_notional, (usd_notional) :: numeric(15,5) AS notional, (USD_IR_PARTIAL_GAMMA) :: numeric(15,5) AS usd_gamma, (usd_fx_kappa) :: numeric(15,5) as usd_fx_kappa, (USD_eq_Delta) :: numeric(15,5) AS eq_delta, (usd_pv01sprd) :: numeric(15,5) as usd_pv01sprd, coalesce(((USD_IR_UNIFIED_PV01) :: numeric(15,5)), 0) as usd_pv01, ((USD_IR_KAPPA) :: numeric(15,5))/10 AS usd_kappa, (USD_CR_KAPPA) :: numeric(15,5) AS usd_cr_kappa, (usd_fx) :: numeric(15,5) as usd_fx, LONG_SHORT from CDWUSER.U_DM_WM_POSITION a WHERE cob_date IN ( '2018-02-28', '2018-02-27' ) AND DIVISION_GROUP = 'GWMG' and CCC_Banking_Trading = 'TRADING' ) b GROUP BY cob_date, Product_Type_Code, CCC_Banking_Trading, LONG_SHORT ) c WHERE ABS(coalesce(usd_net_exposure, 0))+ABS(coalesce(market_value, 0))+ABS(coalesce(gross_market_value, 0))+ABS(coalesce(gross_notional, 0))+ABS(coalesce(notional, 0))+ABS(coalesce(usd_gamma, 0))+ABS(coalesce(usd_fx_kappa, 0))+ ABS(coalesce(eq_delta, 0))+ABS(coalesce(usd_pv01sprd, 0))+ABS(coalesce(usd_pv01, 0))+ABS(coalesce(usd_kappa, 0))+ABS(coalesce(usd_cr_kappa, 0))+ABS(coalesce(usd_fx, 0)) <> 0 ORDER BY COB_DATE DESC, PRODUCT_TYPE_CODE