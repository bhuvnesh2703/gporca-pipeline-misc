select a.COB_DATE, a.CCC_TAPS_COMPANY, a.FACILITY_TYPE, CASE WHEN (CCC_DIVISION IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH', 'CENTRAL PORTFOLIO', 'HELD FOR INVESTMENT - (HFI)', 'HELD FOR SALE - (HFS)', 'TAILORED-BANK', 'TAILORED-NON-BANK', 'PLA-LAL', 'BUSINESSCAPE (C)', 'GLOBAL CURRENCY') AND ccc_strategy IN ('HELD FOR INVESTMENT - (HFI)', 'MSPBNA - VH MORTGAGE') OR ccc_division = 'HELD FOR INVESTMENT - (HFI)') AND product_type_code LIKE 'LOAN%' AND book NOT LIKE '%ORIG%' AND var_excl_fl <> 'Y' THEN BOOK WHEN CCC_BUSINESS_AREA in ('US BANKS-CRA PORTFOLIO') and CCC_TAPS_COMPANY not in ('6635', '1633') THEN BOOK END AS RESI_MTG_BOOK, Round(a.COUPON/.5,0)*.5 as COUPON, a.TERM_BUCKET_AGGR, a.VINTAGE_YEAR, a.VINTAGE, sum(Coalesce(((a.USD_NOTIONAL) :: numeric(15,5))*((a.COUPON) :: numeric(15,5)),0)) as Notional_x_Coupon, sum(COALESCE(round(((CREDIT_SPREAD) :: numeric(15,5))/50, 0)*50, 0)) as CREDIT_SPREAD, sum(COALESCE(((USD_NOTIONAL) :: numeric(15,5)), 0)/1000) as USD_NOTIONAL, sum(COALESCE(((USD_MARKET_VALUE) :: numeric(15,5)), 0)/1000) as USD_MARKET_VALUE, sum(COALESCE(((USD_EXPOSURE) :: numeric(15,5)), 0)/1000) as USD_EXPOSURE, sum(COALESCE(((USD_IR_UNIFIED_PV01) :: numeric(15,5)), 0)/1000) as USD_PV01, sum(COALESCE(((USD_PV01SPRD) :: numeric(15,5)), 0)/1000) as USD_PV01SPRD, sum(COALESCE(((USD_PV10_BENCH) :: numeric(15,5)), 0)/1000) as USD_PV10_BENCH, sum(COALESCE(((USD_IR_KAPPA) :: numeric(15,5)), 0)/10000) as USD_IR_KAPPA, sum((COALESCE(((CREDIT_SPREAD) :: numeric(15,5)), 0)) *(COALESCE(((USD_PV01SPRD) :: numeric(15,5)), 0))/1000) as Spread_x_pv01sprd, case when ((COUPON) :: numeric(15,5)) <=5 then round(((COUPON) :: numeric(15,5))/.5,0)*.5 else round(((COUPON) :: numeric(15,5)),0) end as COUPON2, case when BOOK like '%JUMBO%' then 'FRM' when BOOK like '%YRARM%' then 'ARM' else '1mARM' end as Type from CDWUSER.U_DM_WM A where COB_DATE in ( '2017-07-31', '2015-12-31' ) and CCC_HIERARCHY_LEVEL2 IN ('GLOBAL WEALTH MANAGEMENT', 'WEALTH MANAGEMENT') AND CCC_DIVISION in ('PRIVATE BANKING GROUP','RETAIL BANKING GROUP','PWM US BRANCH''CENTRAL PORTFOLIO', 'HELD FOR INVESTMENT - (HFI)', 'HELD FOR SALE - (HFS)') group by a.COB_DATE, a.CCC_TAPS_COMPANY, a.FACILITY_TYPE, CASE WHEN (CCC_DIVISION IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH', 'CENTRAL PORTFOLIO', 'HELD FOR INVESTMENT - (HFI)', 'HELD FOR SALE - (HFS)', 'TAILORED-BANK', 'TAILORED-NON-BANK', 'PLA-LAL', 'BUSINESSCAPE (C)', 'GLOBAL CURRENCY') AND ccc_strategy IN ('HELD FOR INVESTMENT - (HFI)', 'MSPBNA - VH MORTGAGE') OR ccc_division = 'HELD FOR INVESTMENT - (HFI)') AND product_type_code LIKE 'LOAN%' AND book NOT LIKE '%ORIG%' AND var_excl_fl <> 'Y' THEN BOOK WHEN CCC_BUSINESS_AREA in ('US BANKS-CRA PORTFOLIO') and CCC_TAPS_COMPANY not in ('6635', '1633') THEN BOOK END, a.COUPON, a.TERM_BUCKET_AGGR, a.VINTAGE_YEAR, a.VINTAGE, case when BOOK like '%JUMBO%' then 'FRM' when BOOK like '%YRARM%' then 'ARM' else '1mARM' end UNION ALL select a.COB_DATE, a.CCC_TAPS_COMPANY, a.FACILITY_TYPE, CASE WHEN (ccc_division IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH') AND ccc_business_area IN ('MSCC MORTGAGE LOAN ORIGINATIONS-GWMG')) AND var_excl_fl <> 'Y' AND CCC_STRATEGY LIKE ('%LOAN RISK MANAGEMENT - HTM') THEN BOOK WHEN CCC_BUSINESS_AREA IN ('US BANKS-CRA PORTFOLIO') AND CCC_TAPS_COMPANY NOT IN ('6635', '1633') THEN BOOK END AS RESI_MTG_BOOK, Round(a.COUPON/.5,0)*.5 as COUPON, a.TERM_BUCKET_AGGR, a.VINTAGE_YEAR, a.VINTAGE, sum(Coalesce(((a.USD_NOTIONAL) :: numeric(15,5))*((a.COUPON) :: numeric(15,5)),0)) as Notional_x_Coupon, sum(COALESCE(round(((CREDIT_SPREAD) :: numeric(15,5))/50, 0)*50, 0)) as CREDIT_SPREAD, sum(COALESCE(((USD_NOTIONAL) :: numeric(15,5)), 0)/1000) as USD_NOTIONAL, sum(COALESCE(((USD_MARKET_VALUE) :: numeric(15,5)), 0)/1000) as USD_MARKET_VALUE, sum(COALESCE(((USD_EXPOSURE) :: numeric(15,5)), 0)/1000) as USD_EXPOSURE, sum(COALESCE(((USD_IR_UNIFIED_PV01) :: numeric(15,5)), 0)/1000) as USD_PV01, sum(COALESCE(((USD_PV01SPRD) :: numeric(15,5)), 0)/1000) as USD_PV01SPRD, sum(COALESCE(((USD_PV10_BENCH) :: numeric(15,5)), 0)/1000) as USD_PV10_BENCH, sum(COALESCE(((USD_IR_KAPPA) :: numeric(15,5)), 0)/10000) as USD_IR_KAPPA, sum((COALESCE(((CREDIT_SPREAD) :: numeric(15,5)), 0)) *(COALESCE(((USD_PV01SPRD) :: numeric(15,5)), 0))/1000) as Spread_x_pv01sprd, case when ((COUPON) :: numeric(15,5)) <=5 then round(((COUPON) :: numeric(15,5))/.5,0)*.5 else round(((COUPON) :: numeric(15,5)),0) end as COUPON2, case when BOOK like '%JUMBO%' then 'FRM' when BOOK like '%YRARM%' then 'ARM' else '1mARM' end as Type from CDWUSER.U_DM_WM A where COB_DATE in ( '2018-02-28', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31', '2017-09-29', '2017-08-31', '2015-12-31' ) and CCC_HIERARCHY_LEVEL2 IN ('GLOBAL WEALTH MANAGEMENT', 'WEALTH MANAGEMENT') AND CCC_DIVISION IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH') and VAR_EXCL_FL<> 'Y' AND CCC_TAPS_COMPANY = '6635' group by a.COB_DATE, a.CCC_TAPS_COMPANY, a.FACILITY_TYPE, CASE WHEN (ccc_division IN ('PRIVATE BANKING GROUP', 'RETAIL BANKING GROUP', 'PWM US BRANCH') AND ccc_business_area IN ('MSCC MORTGAGE LOAN ORIGINATIONS-GWMG')) AND var_excl_fl <> 'Y' AND CCC_STRATEGY LIKE ('%LOAN RISK MANAGEMENT - HTM') THEN BOOK WHEN CCC_BUSINESS_AREA IN ('US BANKS-CRA PORTFOLIO') AND CCC_TAPS_COMPANY NOT IN ('6635', '1633') THEN BOOK END, a.COUPON, a.TERM_BUCKET_AGGR, a.VINTAGE_YEAR, a.VINTAGE, case when BOOK like '%JUMBO%' then 'FRM' when BOOK like '%YRARM%' then 'ARM' else '1mARM' end