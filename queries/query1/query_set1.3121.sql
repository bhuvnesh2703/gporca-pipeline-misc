SELECT a.COB_DATE, a.CCC_TAPS_COMPANY, a.account, a.CCC_STRATEGY, CASE WHEN ((CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' ) OR (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)') OR BOOK IN ('PLAFL', 'PLAPV') OR BOOK LIKE 'WM_LAL%' OR BOOK LIKE 'LAL%' or BOOK IN ('CREF_FIXED', 'CREF_FLOAT', 'CREF_RLCK') or (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' ) OR A.WM_BANKING_PRODUCT_GROUP = 'Bank Lending') THEN 'Bank Lending' ELSE a.WM_BANKING_PRODUCT_GROUP END AS WM_BANKING_PRODUCT_GROUP, CASE WHEN A.BOOK IN ('RPOHJ') THEN 'Repo' WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN (CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' )THEN 'Mortgages (HFI)' WHEN (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)' ) THEN 'Mortgages (HFS)' WHEN BOOK IN ('PLAFL', 'PLAPV')THEN 'PLA' WHEN BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'LAL' WHEN BOOK IN ('CREF_FIXED', 'CREF_FLOAT', 'CREF_RLCK') THEN 'CRE Financing' WHEN (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' )THEN 'Tailored Lending' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END AS WM_BANKING_PRODUCT_SUB_GROUP, a.WM_INV_PORTFOLIO, a.MRD_RATING, SUM (USD_NOTIONAL) AS USD_NOTIONAL, SUM (USD_EXPOSURE) AS USD_EXPOSURE, SUM (MV) AS MV, SUM (USD_PV01SPRD) AS USD_PV01SPRD, SUM (USD_PV01) AS USD_PV01, SUM (USD_IR_KAPPA) AS USD_IR_KAPPA, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (SLIDE_IR_MIN_100BP_USD,0) ELSE COALESCE (SLIDE_IR_MIN_100BP_USD, USD_PV01 * - 100) END) AS SLIDE_IR_MIN_100BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (SLIDE_IR_MIN_200BP_USD,0) ELSE COALESCE (SLIDE_IR_MIN_200BP_USD, USD_PV01 * - 200) END) AS SLIDE_IR_MIN_200BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (SLIDE_IR_MIN_300BP_USD,0) ELSE COALESCE (SLIDE_IR_MIN_300BP_USD, USD_PV01 * - 300) END) AS SLIDE_IR_MIN_300BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (SLIDE_IR_MIN_50BP_USD,0) ELSE COALESCE (SLIDE_IR_MIN_50BP_USD, USD_PV01 * - 50) END) AS SLIDE_IR_MIN_50BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (SLIDE_IR_PLS_50BP_USD,0) ELSE COALESCE (SLIDE_IR_PLS_50BP_USD, USD_PV01 * 50) END) AS SLIDE_IR_PLS_50BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (SLIDE_IR_PLS_100BP_USD,0) ELSE COALESCE (SLIDE_IR_PLS_100BP_USD, USD_PV01 * 100) END) AS SLIDE_IR_PLS_100BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (SLIDE_IR_PLS_200BP_USD,0) ELSE COALESCE (SLIDE_IR_PLS_200BP_USD, USD_PV01 * 200) END) AS SLIDE_IR_PLS_200BP_USD, SUM (CASE WHEN a.WM_BANKING_PRODUCT_SUB_GROUP = 'Swaption' THEN COALESCE (SLIDE_IR_PLS_300BP_USD,0) ELSE COALESCE (SLIDE_IR_PLS_300BP_USD, USD_PV01 * 300) END) AS SLIDE_IR_PLS_300BP_USD FROM ( SELECT a.POSITION_ID, a.COB_DATE, a.CCC_TAPS_COMPANY, a.CCC_BUSINESS_AREA, a.CCC_PRODUCT_LINE, a.CCC_DIVISION, a.CCC_STRATEGY, a.VERTICAL_SYSTEM, a.BOOK, a.MRD_RATING, a.ACCOUNT, A.WM_INV_PORTFOLIO, a.PRODUCT_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_SUB_TYPE_CODE, a.PRODUCT_TYPE_NAME, SUM (COALESCE (((USD_TOTAL_COMMIT) :: numeric(15,5)), 0)) / 1000 AS USD_TOTAL_COMMIT, SUM (COALESCE (((USD_UNFUNDED_COMMIT) :: numeric(15,5)), 0)) / 1000 AS USD_UNFUNDED_COMMIT, SUM (COALESCE (((USD_NOTIONAL) :: numeric(15,5)), 0)) / 1000 AS USD_NOTIONAL, SUM (COALESCE (((USD_EXPOSURE) :: numeric(15,5)), 0)) / 1000 AS USD_EXPOSURE, SUM (COALESCE (((USD_PROCEED) :: numeric(15,5)), 0)) / 1000 AS MV, SUM (COALESCE (((USD_PV01SPRD) :: numeric(15,5)), 0)) / 1000 AS USD_PV01SPRD, SUM (COALESCE (((USD_IR_KAPPA) :: numeric(15,5)), 0) / 10) AS USD_IR_KAPPA, SUM (COALESCE (((USD_CONVX) :: numeric(15,5)), 0) / 1000) AS USD_CONVX, SUM (COALESCE (((USD_IR_UNIFIED_PV01) :: numeric(15,5)), 0)) AS USD_PV01, SUM ((a.SLIDE_IR_PLS_100BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_100BP_USD, SUM ((a.SLIDE_IR_PLS_200BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_200BP_USD, SUM ((a.SLIDE_IR_PLS_300BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_300BP_USD, SUM ((a.SLIDE_IR_PLS_50BP_USD) :: numeric(15,5)) AS SLIDE_IR_PLS_50BP_USD, SUM ((a.SLIDE_IR_MIN_50BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_50BP_USD, SUM ((a.SLIDE_IR_MIN_100BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_100BP_USD, SUM ((a.SLIDE_IR_MIN_200BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_200BP_USD, SUM ((a.SLIDE_IR_MIN_300BP_USD) :: numeric(15,5)) AS SLIDE_IR_MIN_300BP_USD FROM cdwuser.u_dm_wm_position a WHERE A.COB_DATE IN ( '2018-02-28', '2018-02-27', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31', '2017-09-29', '2017-08-31' ) AND (A.VAR_EXCL_FL <> 'Y' OR A.BOOK IN ('MSDPB3M', 'MSDPT3M')) AND (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') OR a.WM_BANKING_PRODUCT_SUB_GROUP IN ('Cash')) GROUP BY a.POSITION_ID, a.COB_DATE, a.CCC_TAPS_COMPANY, a.CCC_BUSINESS_AREA, a.CCC_DIVISION, a.CCC_STRATEGY, a.CCC_PRODUCT_LINE, a.WM_INV_PORTFOLIO, a.VERTICAL_SYSTEM, a.BOOK, a.ACCOUNT, a.MRD_RATING, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME ) a GROUP BY a.COB_DATE, a.CCC_TAPS_COMPANY, a.account, a.CCC_STRATEGY, CASE WHEN ((CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' ) OR (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)') OR BOOK IN ('PLAFL', 'PLAPV') OR BOOK LIKE 'WM_LAL%' OR BOOK LIKE 'LAL%' or BOOK IN ('CREF_FIXED', 'CREF_FLOAT', 'CREF_RLCK') or (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' ) OR A.WM_BANKING_PRODUCT_GROUP = 'Bank Lending') THEN 'Bank Lending' ELSE a.WM_BANKING_PRODUCT_GROUP END, CASE WHEN A.BOOK IN ('RPOHJ') THEN 'Repo' WHEN BOOK IN ('VNCDB', 'VNCDP', 'BCDUT') THEN 'Brokered CD - GCM' WHEN BOOK IN ('PBCDP', 'PBCDB') THEN 'Brokered CD - PBG' WHEN (CCC_STRATEGY = 'HELD FOR INVESTMENT - (HFI)' OR CCC_DIVISION = 'HELD FOR INVESTMENT - (HFI)' )THEN 'Mortgages (HFI)' WHEN (CCC_STRATEGY = 'HELD FOR SALE - (HFS)' OR BOOK = 'CCISW' OR CCC_DIVISION = 'HELD FOR SALE - (HFS)' ) THEN 'Mortgages (HFS)' WHEN BOOK IN ('PLAFL', 'PLAPV')THEN 'PLA' WHEN BOOK LIKE 'WM_LAL%' or BOOK LIKE 'LAL%' THEN 'LAL' WHEN BOOK IN ('CREF_FIXED', 'CREF_FLOAT', 'CREF_RLCK') THEN 'CRE Financing' WHEN (CCC_STRATEGY = 'TAILORED LENDING NJV (S)' OR CCC_PRODUCT_LINE = 'TAILORED LENDING NJV (S)' )THEN 'Tailored Lending' ELSE a.WM_BANKING_PRODUCT_SUB_GROUP END, a.WM_INV_PORTFOLIO, a.MRD_RATING