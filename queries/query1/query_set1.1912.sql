SELECT a.COB_DATE, a.BOOK, a.ACCOUNT, a.PRODUCT_TYPE_CODE, a.MSPBNA_MORTGAGE_TYPE, SUM (USD_NOTIONAL) AS USD_NOTIONAL, SUM (USD_EXPOSURE) AS USD_EXPOSURE, SUM (MV) AS MV, SUM (USD_PV01SPRD) AS USD_PV01SPRD, SUM (USD_PV01) AS USD_PV01 FROM ( SELECT a.POSITION_ID, a.COB_DATE, a.CCC_DIVISION, a.CCC_TAPS_COMPANY, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.BOOK, a.ACCOUNT, a.PRODUCT_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.CURRENCY_CODE, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_SUB_TYPE_CODE, a.PRODUCT_TYPE_NAME, a.MSPBNA_MORTGAGE_TYPE, SUM (COALESCE (CAST(USD_NOTIONAL as numeric(15,5)), 0)) / 1000 AS USD_NOTIONAL, SUM (COALESCE (CAST(USD_EXPOSURE as numeric(15,5)), 0)) / 1000 AS USD_EXPOSURE, SUM (COALESCE (CAST(USD_PROCEED as numeric(15,5)), 0)) / 1000 AS MV, SUM (COALESCE (CAST(USD_PV01SPRD as numeric(15,5)), 0)) / 1000 AS USD_PV01SPRD, SUM (COALESCE (CAST(USD_IR_KAPPA as numeric(15,5)), 0) / 10) AS USD_IR_KAPPA, SUM (COALESCE (CAST(USD_CONVX as numeric(15,5)), 0) / 1000) AS USD_CONVX, SUM (COALESCE (CAST(USD_IR_UNIFIED_PV01 as numeric(15,5)), 0)) AS USD_PV01 FROM Cdwuser.u_dm_wm_position a WHERE A.COB_DATE IN ( '2018-02-28', '2018-02-27', '2018-01-31', '2017-12-29', '2017-11-30', '2017-10-31', '2017-09-29', '2017-08-31', '2013-12-31' ) AND A.CCC_TAPS_COMPANY = '6635' AND (A.VAR_EXCL_FL <> 'Y' OR A.BOOK IN ('MSDPB3M', 'MSDPT3M')) AND (A.ccc_banking_trading = 'BANKING' OR (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') OR a.CCC_business_area = 'US BANKS-LIQUIDITY') AND A.PRODUCT_TYPE_CODE = 'REPO' AND A.CCC_BUSINESS_AREA NOT IN ('NON CORE MARKETS', 'CORE MARKETS')) GROUP BY a.POSITION_ID, a.COB_DATE, a.CCC_DIVISION, a.CCC_TAPS_COMPANY, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.BOOK, a.ACCOUNT, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.CURRENCY_CODE, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME, a.MSPBNA_MORTGAGE_TYPE ) A GROUP BY a.COB_DATE, a.BOOK, a.ACCOUNT, a.PRODUCT_TYPE_CODE, a.MSPBNA_MORTGAGE_TYPE union all SELECT a.COB_DATE, a.BOOK, a.ACCOUNT, a.PRODUCT_TYPE_CODE, CASE WHEN CCC_TAPS_COMPANY = '6635' AND (CCC_STRATEGY IN ( 'HELD FOR INVESTMENT - (HFI)' ,'HELD FOR SALE - (HFS)' ,'RESI WM JV' )OR ccc_division IN ('HELD FOR INVESTMENT - (HFI)','HELD FOR SALE - (HFS)', 'FIXED INCOME DIVISION') OR CCC_STRATEGY = 'RESI WM JV' OR a.book in ( 'CRASW', 'CCISW') ) THEN ( CASE WHEN ACCOUNT = '07100TB66' THEN 'WLS WM TBA Hedge' WHEN ACCOUNT = '0710CRA19' THEN 'CRA TBA Hedge' WHEN ACCOUNT = '072005G88' THEN '10Yr Io Arm Prodn HTM' WHEN ACCOUNT = '07200FF12' THEN 'NonConf Fallout Funded' WHEN ACCOUNT = '07200FF20' THEN 'NonConf Fallout Ratelock' WHEN ACCOUNT = '07200G214' AND BOOK = 'GWM_MTGEORIG_FLOATINGSALE_PHH' THEN 'Forward Sale Floating' WHEN ACCOUNT = '07200G214' AND BOOK = 'GWM_MTGEORIG_FLOATINGPROD_PHH' THEN 'PHH Floating' WHEN ACCOUNT = '07200G230' THEN 'CRA Loans' WHEN ACCOUNT = '07200G313' THEN 'Hybrid Production-HTM' WHEN ACCOUNT = '07200WS86' THEN 'MSR Ratelock' WHEN ACCOUNT = '07200WS94' THEN 'MSR Funded' WHEN ACCOUNT = '072000M82' AND BOOK IN ( 'GWM_WLS_NONCONFORMING_MSR_SOLD_PHH' ,'GWM_MTGEORIG_SVCPROD' ) THEN 'Sold MSR' WHEN ACCOUNT = '072000M82' AND BOOK = 'WM_MTGEORIG_SVCHEDGE' THEN 'MSR TBA Hedge' WHEN ACCOUNT = '072015M98' THEN '15Yr Jumbo Fixed-HTM' WHEN ACCOUNT = '07201G338' THEN '1 Mo Arm Prodn HTM' WHEN ACCOUNT = '072030G60' THEN '30Yr Jumbo Fixed-HTM' WHEN ACCOUNT = '07203G351' THEN '3Yr Io Arm Prodn HTM' WHEN ACCOUNT = '07205G383' THEN '5Yr Io Arm Prod HTM' WHEN ACCOUNT = '07207G407' THEN '7Yr Io Arm Prod HTM' WHEN ACCOUNT = '0720PB218' AND BOOK = 'GWM_MTGEORIG_FIXEDSALE_PHH' THEN 'Forward Sale Fixed' WHEN ACCOUNT = '0720PB218' AND BOOK = 'GWM_MTGEORIG_FIXEDPROD_PHH' THEN 'PHH Fixed' WHEN ACCOUNT = '07200WS37' THEN 'NonConf Funded' WHEN ACCOUNT = '07200WS29' THEN 'NonConf Ratelock' WHEN ACCOUNT = '072005E72' THEN 'WLS ISG TBA Hedge' WHEN ACCOUNT = '083003MU4' AND BOOK = 'CCISW' THEN 'CRA Swap Hedges' ELSE 'Others' END ) END AS MSPBNA_MORTGAGE_TYPE, SUM (USD_NOTIONAL) AS USD_NOTIONAL, SUM (USD_EXPOSURE) AS USD_EXPOSURE, SUM (MV) AS MV, SUM (USD_PV01SPRD) AS USD_PV01SPRD, SUM (USD_PV01) AS USD_PV01 FROM ( SELECT a.POSITION_ID, a.COB_DATE, a.CCC_DIVISION, a.CCC_TAPS_COMPANY, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.BOOK, a.ACCOUNT, a.PRODUCT_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.CURRENCY_CODE, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_SUB_TYPE_CODE, a.PRODUCT_TYPE_NAME, a.MSPBNA_MORTGAGE_TYPE, SUM (COALESCE (CAST(USD_NOTIONAL as numeric(15,5)), 0)) / 1000 AS USD_NOTIONAL, SUM (COALESCE (CAST(USD_EXPOSURE as numeric(15,5)), 0)) / 1000 AS USD_EXPOSURE, SUM (COALESCE (CAST(USD_PROCEED as numeric(15,5)), 0)) / 1000 AS MV, SUM (COALESCE (CAST(USD_PV01SPRD as numeric(15,5)), 0)) / 1000 AS USD_PV01SPRD, SUM (COALESCE (CAST(USD_IR_KAPPA as numeric(15,5)), 0) / 10) AS USD_IR_KAPPA, SUM (COALESCE (CAST(USD_CONVX as numeric(15,5)), 0) / 1000) AS USD_CONVX, SUM (COALESCE (CAST(USD_IR_UNIFIED_PV01 as numeric(15,5)), 0)) AS USD_PV01 FROM Cdwuser.u_dm_wm_position a WHERE A.COB_DATE IN ( '2013-12-31' ) AND A.CCC_TAPS_COMPANY = '6635' AND (A.VAR_EXCL_FL <> 'Y' OR A.BOOK IN ('MSDPB3M', 'MSDPT3M')) AND (A.ccc_banking_trading = 'BANKING' OR (A.CCC_HIERARCHY_LEVEL2 IN ('WEALTH MANAGEMENT', 'GLOBAL WEALTH MANAGEMENT') OR a.CCC_business_area = 'US BANKS-LIQUIDITY') AND A.PRODUCT_TYPE_CODE = 'REPO' AND A.CCC_BUSINESS_AREA NOT IN ('NON CORE MARKETS', 'CORE MARKETS')) GROUP BY a.POSITION_ID, a.COB_DATE, a.CCC_DIVISION, a.CCC_TAPS_COMPANY, a.CCC_BUSINESS_AREA, a.CCC_STRATEGY, a.BOOK, a.ACCOUNT, a.PRODUCT_TYPE_CODE, a.PRODUCT_SUB_TYPE_CODE, a.WM_BANKING_PRODUCT_GROUP, a.WM_BANKING_PRODUCT_SUB_GROUP, a.CURRENCY_CODE, a.BANKING_PRODUCT_DESCRIPTION, a.PRODUCT_TYPE_NAME, a.MSPBNA_MORTGAGE_TYPE ) A GROUP BY a.COB_DATE, a.BOOK, a.ACCOUNT, a.PRODUCT_TYPE_CODE, CASE WHEN CCC_TAPS_COMPANY = '6635' AND (CCC_STRATEGY IN ( 'HELD FOR INVESTMENT - (HFI)' ,'HELD FOR SALE - (HFS)' ,'RESI WM JV' )OR ccc_division IN ('HELD FOR INVESTMENT - (HFI)','HELD FOR SALE - (HFS)', 'FIXED INCOME DIVISION') OR CCC_STRATEGY = 'RESI WM JV' OR a.book in ( 'CRASW', 'CCISW') ) THEN ( CASE WHEN ACCOUNT = '07100TB66' THEN 'WLS WM TBA Hedge' WHEN ACCOUNT = '0710CRA19' THEN 'CRA TBA Hedge' WHEN ACCOUNT = '072005G88' THEN '10Yr Io Arm Prodn HTM' WHEN ACCOUNT = '07200FF12' THEN 'NonConf Fallout Funded' WHEN ACCOUNT = '07200FF20' THEN 'NonConf Fallout Ratelock' WHEN ACCOUNT = '07200G214' AND BOOK = 'GWM_MTGEORIG_FLOATINGSALE_PHH' THEN 'Forward Sale Floating' WHEN ACCOUNT = '07200G214' AND BOOK = 'GWM_MTGEORIG_FLOATINGPROD_PHH' THEN 'PHH Floating' WHEN ACCOUNT = '07200G230' THEN 'CRA Loans' WHEN ACCOUNT = '07200G313' THEN 'Hybrid Production-HTM' WHEN ACCOUNT = '07200WS86' THEN 'MSR Ratelock' WHEN ACCOUNT = '07200WS94' THEN 'MSR Funded' WHEN ACCOUNT = '072000M82' AND BOOK IN ( 'GWM_WLS_NONCONFORMING_MSR_SOLD_PHH' ,'GWM_MTGEORIG_SVCPROD' ) THEN 'Sold MSR' WHEN ACCOUNT = '072000M82' AND BOOK = 'WM_MTGEORIG_SVCHEDGE' THEN 'MSR TBA Hedge' WHEN ACCOUNT = '072015M98' THEN '15Yr Jumbo Fixed-HTM' WHEN ACCOUNT = '07201G338' THEN '1 Mo Arm Prodn HTM' WHEN ACCOUNT = '072030G60' THEN '30Yr Jumbo Fixed-HTM' WHEN ACCOUNT = '07203G351' THEN '3Yr Io Arm Prodn HTM' WHEN ACCOUNT = '07205G383' THEN '5Yr Io Arm Prod HTM' WHEN ACCOUNT = '07207G407' THEN '7Yr Io Arm Prod HTM' WHEN ACCOUNT = '0720PB218' AND BOOK = 'GWM_MTGEORIG_FIXEDSALE_PHH' THEN 'Forward Sale Fixed' WHEN ACCOUNT = '0720PB218' AND BOOK = 'GWM_MTGEORIG_FIXEDPROD_PHH' THEN 'PHH Fixed' WHEN ACCOUNT = '07200WS37' THEN 'NonConf Funded' WHEN ACCOUNT = '07200WS29' THEN 'NonConf Ratelock' WHEN ACCOUNT = '072005E72' THEN 'WLS ISG TBA Hedge' WHEN ACCOUNT = '083003MU4' AND BOOK = 'CCISW' THEN 'CRA Swap Hedges' ELSE 'Others' END ) END