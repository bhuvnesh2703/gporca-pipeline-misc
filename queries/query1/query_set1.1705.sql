SELECT COB_DATE AS VARDATE, ccc_pl_reporting_region, UK_Group, CCC_BUSINESS_AREA, CCC_STRATEGY, CCC_PRODUCT_LINE, V_M050 AS MINUS50PCT, (COALESCE (V_M050, 0)) + (- 0.25 + 0.5) * (COALESCE (V_M019, 0) - COALESCE (V_M050, 0)) / (- 0.19 + 0.5) AS MINUS25PCT, V_M010 AS MINUS10PCT, V_P010 AS PLUS10PCT, (COALESCE (V_P021, 0)) + (0.25 - 0.21) * (COALESCE (V_P050, 0) - COALESCE (V_P021, 0)) / (0.5 - 0.21) AS PLUS25PCT, V_P050 AS PLUS50PCT, V_P100 AS PLUS100PCT, V_P200 AS PLUS200PCT, V_P300 AS PLUS300PCT from ( SELECT CCC_BUSINESS_AREA, ccc_pl_reporting_region, CASE WHEN LE_GROUP = 'UK' THEN 'UK Group' ELSE 'Non Uk Group' END AS UK_Group, CCC_PRODUCT_LINE, CCC_STRATEGY, COB_DATE, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_MIN_50PCT_USD , 0) ELSE COALESCE (SLIDE_PV_MIN_50PCT_USD, 0) END) AS V_M050, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_MIN_19PCT_USD , 0) ELSE COALESCE (SLIDE_PV_MIN_19PCT_USD, 0) END) AS V_M019, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_MIN_10PCT_USD , 0) ELSE COALESCE (SLIDE_PV_MIN_10PCT_USD, 0) END) AS V_M010, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_PLS_10PCT_USD , 0) ELSE COALESCE (SLIDE_PV_PLS_10PCT_USD, 0) END) AS V_P010, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_PLS_21PCT_USD , 0) ELSE COALESCE (SLIDE_PV_PLS_21PCT_USD, 0) END) AS V_P021, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_PLS_50PCT_USD , 0) ELSE COALESCE (SLIDE_PV_PLS_50PCT_USD, 0) END) AS V_P050, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_PLS_100PCT_USD , 0) ELSE COALESCE (SLIDE_PV_PLS_100PCT_USD, 0) END) AS V_P100, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_PLS_200PCT_USD , 0) ELSE COALESCE (SLIDE_PV_PLS_200PCT_USD, 0) END) AS V_P200, SUM (CASE WHEN b.PRODUCT_TYPE_CODE IN ('CDSOPTIDX', 'CRDINDEX', 'LOANINDEX', 'MUNICDX', 'CRDBSKT') THEN COALESCE (b. SLIDE_PVSPRCOMP_PLS_300PCT_USD , 0) ELSE COALESCE (SLIDE_PV_PLS_300PCT_USD, 0) END) AS V_P300 FROM CDWUSER.U_CR_MSR b WHERE (CCC_BUSINESS_AREA IN ('CREDIT-CORPORATES', 'LENDING', 'MUNICIPAL SECURITIES', 'EM CREDIT TRADING') AND CCC_STRATEGY NOT IN ('HELD FOR INVESTMENT', 'PROJECT FINANCE', 'CORPORATE LOAN STRATEGY') AND BOOK NOT IN ('PMGPB') AND upper (book) NOT LIKE '%WORKOUT%' AND COB_DATE in ('2018-02-28','2018-02-21')) GROUP BY CCC_BUSINESS_AREA, ccc_pl_reporting_region, CASE WHEN LE_GROUP = 'UK' THEN 'UK Group' ELSE 'Non Uk Group' END, CCC_PRODUCT_LINE, CCC_STRATEGY, COB_DATE )sub_qry