SELECT source_scn_name,  CASE WHEN Substr (CCAR_CURRENCY_PAIR, 1, 3) = 'USD' THEN Substr (CCAR_CURRENCY_PAIR, 4, 3) || 'USD' ELSE CCAR_CURRENCY_PAIR END AS CCAR_CURRENCY_PAIR,  SUM (PNL) AS PNL FROM  (SELECT source_scn_name, case when PRODUCT_TYPE IN ('FXBSKT') then 'Unattributed' else REPLACE (REPLACE (REPLACE (REPLACE (     REPLACE (REPLACE (REPLACE (CURRENCY_PAIR, 'CNH', 'CNY'), 'KRX', 'KRW'), 'RBX', 'RUB'),'RU1', 'RUB'), 'BRX', 'BRL'), 'UBD', 'USD'), 'BR1', 'BRL') END AS      CCAR_CURRENCY_PAIR, SUM (raw_pnl) / 1000 AS PNL      FROM DWUSER.U_RAW_SCENARIO_PNL a  where COB_DATE = '2018-02-28'     AND CCC_BUSINESS_AREA = 'FXEM MACRO TRADING' AND PRODUCT_TYPE IN ('FXOPT','FXBSKT')  AND      source_scn_name IN ('BHC2017_S1_FX_ALL',      'BHC2017_S1_FX_Spot','BHC2017_S1_FX_Vol') AND BU_RISK_SYSTEM LIKE 'FXOPT%'      GROUP BY source_scn_name, case when PRODUCT_TYPE IN ('FXBSKT') then 'Unattributed' else REPLACE (REPLACE (REPLACE (REPLACE (REPLACE      (REPLACE (REPLACE (CURRENCY_PAIR, 'CNH', 'CNY'), 'KRX', 'KRW'), 'RBX', 'RUB'), 'RU1', 'RUB'), 'BRX', 'BRL'), 'UBD', 'USD'), 'BR1', 'BRL') END) a      GROUP BY      source_scn_name,      CASE WHEN Substr (CCAR_CURRENCY_PAIR, 1, 3) = 'USD' THEN Substr (CCAR_CURRENCY_PAIR, 4, 3) || 'USD' ELSE CCAR_CURRENCY_PAIR END