SELECT COB_DATE, CCC_PRODUCT_LINE, CCC_PL_REPORTING_REGION, PARENT_LEGAL_ENTITY, CCC_TAPS_COMPANY, CASE WHEN LE_GROUP = 'UK' THEN 'UK GROUP' ELSE 'NON UKGROUP' END AS UKGROUPCLASSIFICATION, CASE WHEN PARENT_LEGAL_ENTITY='0319(G)' Then 'MSIM' WHEN PARENT_LEGAL_ENTITY='0517(G)' Then 'MSBIL' WHEN PARENT_LEGAL_ENTITY='0302(G)' Then 'MSIP' WHEN LE_GROUP = 'UK' THEN 'OTHER Legal Entitiy' ELSE 'Non UK Legal Entitiy' END AS LEGALENTITYCLASSIFICATION, CASE WHEN CCC_DIVISION = 'COMMODITIES' THEN 'FIXED INCOME DIVISION' WHEN (CCC_DIVISION = 'FID DVA' OR CCC_DIVISION = 'FIC DVA' OR CCC_STRATEGY = 'MS DVA STR NOTES IED') THEN 'DVA' WHEN (CCC_BUSINESS_AREA IN ('CPM TRADING (MPE)', 'CPM','CREDIT', 'MS CVA MNE - FID', 'MS CVA MNE - COMMOD') OR CCC_STRATEGY IN ('MS CVA MPE - DERIVATIVES', 'MS CVA MNE - DERIVATIVES','EQ XVA HEDGING')) THEN 'CVA' ELSE CCC_DIVISION END AS CCC_DIVISION, CASE WHEN CCC_DIVISION = 'COMMODITIES' THEN 'COMMODITIES' WHEN CCC_DIVISION ='NON CORE' THEN 'NON CORE' WHEN (CCC_DIVISION='INSTITUTIONAL EQUITY DIVISION' AND CCC_BUSINESS_AREA NOT IN ('CASH EQUITIES','DERIVATIVES','OTHER IED','PRIME BROKERAGE')) THEN 'OTHERS' WHEN ((CCC_DIVISION = 'FID UNDEFINED') OR (CCC_DIVISION='FIXED INCOME DIVISION' AND CCC_BUSINESS_AREA NOT IN ('CREDIT-CORPORATES','FXEM MACRO TRADING','EM CREDIT TRADING','LIQUID FLOW RATES','STRUCTURED RATES','SECURITIZED PRODUCTS GRP','COMMODITIES','NON CORE'))) THEN 'OTHERS FID' ELSE CCC_BUSINESS_AREA END AS CCC_BUSINESS_AREA, CASE WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP IN ('WTI CRUDE OIL','S&P GSCI BRENT INDEX EXCESS RETURN','S&P GSCI CRUDE OIL INDEX EXCS RETURN','LIGHT_CRUDE NEAR ALIAS','BRENT CRUDE OIL','Reformulated Gasoline Blendstock for Oxygen Blending (RBOB)','Reformulated Gasoline Blendstock for Oxygen Blending (RBOB) Futu','ICE NYH RBOB GASOLINE') THEN 'CRUDE' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP LIKE 'LIGHT_CRUDE%' THEN 'CRUDE' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP IN ('HEATING OIL','GAS OIL','NATURAL GAS','UK NATURAL GAS') THEN 'Gas' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP IN ('SILVER','GOLD','PLATINUM','PALLADIUM','S&P GSCI GOLD INDEX EXCESS RETURN','COMEX SILVER') THEN 'PRECIOUSMETAL' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_TYPE_CODE IN ('GSCI') THEN 'Index' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP IN ('COPPER','LME NICKEL','LME ZINC','HG COPPER') THEN 'BASEMETAL' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP IN ('GSIN EXCESS RET','BLOOMBERG COMMODITY IDNEX TOTAL RETU','BLOOMBERG COMMODITY INDEX','GSIC Excess Ret','GSCI EXCESS RET') THEN 'Index' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP IN ('SOYBEAN OIL') THEN 'Veg oils' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP IN ('SOYBEANS','SUGAR','COCOA','LIVE CATTLE','SOY MEAL','COFFEE','CATTLE','SUGAR 11','COFFEE C','LEAN HOGS') THEN PRODUCT_DESCRIPTION_DECOMP WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP IN ('S&P GSCI AGRICULTURAL INDEX EXCS RTN USD','SPGS Cotton ER') THEN 'Agriculture - Others' WHEN PRODUCT_TYPE_CODE IN ('COTTON','CORN','WHEAT') AND PRODUCT_DESCRIPTION_DECOMP IN ('COTTON','CORN','WHEAT') THEN 'Agriculture - Others' WHEN PRODUCT_TYPE_CODE IN ('COMM','ETF','OPTION','SWAP','GSCI','INDEX') AND PRODUCT_DESCRIPTION_DECOMP LIKE 'S&P GSCI AGRICULTURAL INDEX EXCS RTN%' THEN 'Agriculture - Others' WHEN PRODUCT_TYPE_CODE IN ('SOFT / LIVESTOCK') AND PRODUCT_TYPE_CODE_DECOMP IN ('SOFT / LIVESTOCK') THEN 'SOFT / LIVESTOCK' WHEN PRODUCT_TYPE_CODE IN ('OPTION') AND PRODUCT_DESCRIPTION_DECOMP IN ('GSLV EXCESS RET') THEN 'SOFT / LIVESTOCK' ELSE PRODUCT_TYPE_CODE END AS PRODUCT_TYPE_CODE, SUM( CASE WHEN CASH_ISSUE_TYPE = 'CMDT' AND (DOLLAR_GREEK_DECOMP IS NULL OR DOLLAR_GREEK_DECOMP = 0) THEN DOLLAR_GREEK_PARTIAL ELSE DOLLAR_GREEK_DECOMP END ) AS DOLLAR_GREEK FROM ( SELECT COB_DATE, CCC_PRODUCT_LINE, CCC_PL_REPORTING_REGION, PARENT_LEGAL_ENTITY, CCC_TAPS_COMPANY, LE_GROUP, CCC_DIVISION, CCC_BUSINESS_AREA, CCC_STRATEGY, PRODUCT_TYPE_CODE, PRODUCT_TYPE_CODE_DECOMP, PRODUCT_DESCRIPTION_DECOMP, TICKER_DECOMP, CASH_ISSUE_TYPE, SUM (a.USD_CM_DELTA_DECOMP) AS DOLLAR_GREEK_DECOMP, 0 AS DOLLAR_GREEK_PARTIAL FROM CDWUSER.U_DECOMP_MSR a WHERE CCC_BANKING_TRADING IN ('BANKING', 'TRADING') AND a.USD_CM_DELTA_DECOMP <> 0 AND COB_DATE IN ('2018-02-28','2018-02-27') AND a.CCC_DIVISION NOT IN ('MANAGED FUTURES HC & ADMIN','WM CAPITAL MARKETS') GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14 UNION SELECT COB_DATE, CCC_PRODUCT_LINE, CCC_PL_REPORTING_REGION, PARENT_LEGAL_ENTITY, CCC_TAPS_COMPANY, LE_GROUP, CCC_DIVISION, CCC_BUSINESS_AREA, CCC_STRATEGY, PRODUCT_TYPE_CODE, 'NULL' AS PRODUCT_TYPE_CODE_DECOMP, PARTIAL_DECOMP_PRODUCT_DESCRIPTION AS PRODUCT_DESCRIPTION_DECOMP, 'NULL' AS TICKER_DECOMP, CASH_ISSUE_TYPE, 0 AS DOLLAR_GREEK_DECOMP, SUM (b.USD_CM_DELTA) AS DOLLAR_GREEK_PARTIAL FROM CDWUSER.U_EXP_MSR_PARTIAL b WHERE CCC_BANKING_TRADING IN ('BANKING', 'TRADING') AND CASH_ISSUE_TYPE = 'CMDT' AND COB_DATE IN ('2018-02-28','2018-02-27') AND CCC_DIVISION NOT IN ('MANAGED FUTURES HC & ADMIN','WM CAPITAL MARKETS') GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14 ) Z GROUP BY 1,2,3,4,5,6,7,8,9,10